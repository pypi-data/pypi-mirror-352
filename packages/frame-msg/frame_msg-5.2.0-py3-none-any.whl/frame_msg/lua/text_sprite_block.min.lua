local a={}function a.parse_text_sprite_block(b,c)if string.byte(b,1)==0xFF then local d={}d.width=string.byte(b,2)<<8|string.byte(b,3)d.max_display_rows=string.byte(b,4)d.lines=string.byte(b,5)local e={}for f=0,d.lines-1 do local g={}g.x=string.byte(b,5+4*f+1)<<8|string.byte(b,5+4*f+2)g.y=string.byte(b,5+4*f+3)<<8|string.byte(b,5+4*f+4)table.insert(e,g)end;d.offsets=e;d.sprites={}d.last_sprite_index=0;d.first_sprite_index=0;return d else if c==nil then return nil end;c.last_sprite_index=c.last_sprite_index+1;if c.first_sprite_index==0 then c.first_sprite_index=1 end;if c.last_sprite_index-c.first_sprite_index+1>c.max_display_rows then c.sprites[c.first_sprite_index]=nil;c.first_sprite_index=c.first_sprite_index+1 end;local h={}h.width=string.byte(b,1)<<8|string.byte(b,2)h.height=string.byte(b,3)<<8|string.byte(b,4)h.compressed=string.byte(b,5)>0;h.bpp=string.byte(b,6)h.num_colors=string.byte(b,7)h.palette_data=string.sub(b,8,8+h.num_colors*3-1)h.pixel_data=string.sub(b,8+h.num_colors*3)c.sprites[c.last_sprite_index]=h;return c end end;return a