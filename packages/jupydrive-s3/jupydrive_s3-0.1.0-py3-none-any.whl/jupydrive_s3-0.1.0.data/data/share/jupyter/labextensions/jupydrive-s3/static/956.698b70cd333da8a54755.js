"use strict";(self.webpackChunkjupydrive_s3=self.webpackChunkjupydrive_s3||[]).push([[956],{6956:(e,t,n)=>{n.r(t),n.d(t,{AUTH_FILEBROWSER_ID:()=>A,IS3Auth:()=>M,default:()=>L});var i=n(3549),o=n(9560),s=n(6313),a=n(2826),r=n(484),c=n(1542),l=n(4918),d=n(6167),h=n(5256),u=n(7262),m=n(4602),p=n(186),g=n(1689),y=n(9191),w=n(3773);let f={name:"",path:"",last_modified:"",created:"",content:null,format:null,mimetype:"",size:0,writable:!0,type:""};const v=async(e,t,n,i,o)=>{let s=!1;const a={},r=o?g.PathExt.join(n,o):n,c=new y.ListObjectsV2Command({Bucket:t,Prefix:r+(r?"/":"")});let l=!0;for(;l;){const{Contents:r,IsTruncated:d,NextContinuationToken:h}=await e.send(c);r?r.forEach((e=>{var t;if(e.Key!==n+"/"&&e.Key!==o+"/"&&e.Key!==n+"/"+o+"/"){let s=e.Key.replace((n?n+"/":"")+(o?o+"/":""),"");const r=s!==s.split("/")[0];s=s.split("/")[0];const[c,l,d]=k.getFileType(g.PathExt.extname(g.PathExt.basename(s)),r,i);a[s]=null!==(t=a[s])&&void 0!==t?t:{name:s,path:o?g.PathExt.join(o,s):s,last_modified:e.LastModified.toISOString(),created:"",content:s.split(".")[1]?null:[],format:d,mimetype:l,size:e.Size,writable:!0,type:c}}})):(s=!0,f=await _(e,t,n,o,i)),l&&(l=d),c.input.ContinuationToken=h}return!1===s&&(f={name:o?g.PathExt.basename(o):t,path:o?o+"/":t,last_modified:"",created:"",content:Object.values(a),format:"json",mimetype:"",size:void 0,writable:!0,type:"directory"}),f},_=async(e,t,n,i,o)=>{const s=new y.GetObjectCommand({Bucket:t,Key:g.PathExt.join(n,i)}),a=await e.send(s);if(a){const e=a.LastModified.toISOString(),[t,s,r]=k.getFileType(g.PathExt.extname(g.PathExt.basename(i)),!1,o);let c;"base64"===r||"PDF"===t?(c=await a.Body.transformToByteArray(),c=btoa(c.reduce(((e,t)=>e+String.fromCharCode(t)),""))):c=await a.Body.transformToString(),f={name:g.PathExt.basename(i),path:g.PathExt.join(n,i),last_modified:e,created:"",content:c,format:r,mimetype:s,size:a.ContentLength,writable:!0,type:t}}return f},C=async(e,t,n,i,o,s,a,r,c)=>{o=g.PathExt.join(n,o);const[l,d,h]=k.getFileType(g.PathExt.extname(g.PathExt.basename(i)),r,a);let u;return c&&(s=k.formatBody(c,h,l,d)),await e.send(new y.PutObjectCommand({Bucket:t,Key:o+(""===g.PathExt.extname(i)?"/":""),Body:s,CacheControl:c?"no-cache":void 0})).then((async()=>{var n;const s=await e.send(new y.HeadObjectCommand({Bucket:t,Key:o+(""===g.PathExt.extname(i)?"/":"")}));u=null===(n=s.LastModified)||void 0===n?void 0:n.toISOString()})).catch((e=>{console.error("Failed saving or creating the S3 object: ",e)})),f={name:i,path:g.PathExt.join(o,i),last_modified:null!=u?u:(new Date).toISOString(),created:null!=u?u:(new Date).toISOString(),content:1===o.split(".").length?[]:s,format:h,mimetype:d,size:"string"==typeof s?s.length:s.size,writable:!0,type:l},f},b=async(e,t,n,i,o)=>{const s=i?g.PathExt.join(n,i)+(!0===o?"/":""):n+"/",{Contents:a}=await e.send(new y.ListObjectsV2Command({Bucket:t,Prefix:s,MaxKeys:1}));return a?Promise.resolve():Promise.reject()},x=async(e,t,n,i,o,s,a,r)=>{const c=await S(e,t,o);let l="";o=g.PathExt.join(n,o),s=g.PathExt.join(n,s),i=g.PathExt.join(s,i),o+=c?"/":"";const d=new y.ListObjectsV2Command({Bucket:t,Prefix:o});let h=!0;for(;h;){const{Contents:n,IsTruncated:s,NextContinuationToken:a}=await e.send(d);if(n){const s=n.map((n=>{l||-1===n.Key.search("/.emptyFolderPlaceholder")||(l=".emptyFolderPlaceholder");const s=n.Key.substring(o.length);return k.copyFile(e,t,s,o,i,r)}));await Promise.all(s)}h&&(h=s),d.input.ContinuationToken=a}const[u,m,p]=k.getFileType(g.PathExt.extname(g.PathExt.basename(i)),c,a);try{const n=await e.send(new y.GetObjectCommand({Bucket:null!=r?r:t,Key:i+(l||"")}));f={name:g.PathExt.basename(i),path:i,last_modified:n.LastModified.toISOString(),created:(new Date).toISOString(),content:await n.Body.transformToString(),format:p,mimetype:m,size:n.ContentLength,writable:!0,type:u}}catch(e){f={name:g.PathExt.basename(i),path:i,last_modified:(new Date).toISOString(),created:(new Date).toISOString(),content:[],format:p,mimetype:m,size:0,writable:!0,type:u}}return f};async function S(e,t,n){let i=!1;const o=new y.ListObjectsV2Command({Bucket:t,Prefix:"/"===n[n.length-1]?n:n+"/",MaxKeys:1}),{Contents:s}=await e.send(o);return s&&(i=!0),i}var k;!function(e){e.getFileType=function(e,t,n){let i=!1===t?"text":"directory",o=!1===t?"text/plain":"text/directory",s=!1===t?"text":"json";return!1===t&&n[e]&&(i=n[e].fileType,o=n[e].fileMimeTypes[0],s=n[e].fileFormat),".ipynb"===e&&(s="text"),[i,o,s]},e.deleteFile=async function(e,t,n){await e.send(new y.DeleteObjectCommand({Bucket:t,Key:n}))},e.copyFile=async function(e,t,n,i,o,s){await e.send(new y.CopyObjectCommand({Bucket:s||t,CopySource:g.PathExt.join(t,i,n),Key:g.PathExt.join(o,n)}))},e.formatBody=function(e,t,n,i){let o;if("json"===e.format)o=JSON.stringify(e.content,null,2);else if("base64"!==e.format||"base64"!==t&&"PDF"!==n)o=e.content;else{const t=atob(e.content),n=[];for(let e=0;e<t.length;e+=512){const i=t.slice(e,e+512),o=new Array(i.length);for(let e=0;e<i.length;e++)o[e]=i.charCodeAt(e);const s=new Uint8Array(o);n.push(s)}o=new Blob(n,{type:i})}return o}}(k||(k={}));let E={name:"",path:"",last_modified:"",created:"",content:null,format:null,mimetype:"",size:0,writable:!0,type:""};class T{constructor(e){var t;this._name="",this._root="",this._config="",this._isRootFormatted=!1,this._provider="",this._baseUrl="",this._region="",this._creationDate="",this._fileChanged=new m.Signal(this),this._isDisposed=!1,this._disposed=new m.Signal(this),this._registeredFileTypes={};const{config:n,name:i,root:o,secretsManager:s,token:a}=e;this._serverSettings=p.ServerConnection.makeSettings(),s&&(this._secretsManager=s),a&&(I.setToken(a),delete e.token);const r={...n};s&&a&&Object.entries(r.credentials).forEach((([e,t])=>{s.get(a,A,A+"::"+e).then((t=>{r.credentials[e]=t.value})).catch((()=>console.error("Error occurred retrieving secret: ",e)))})),this._s3Client=new y.S3Client(null!=r?r:{}),this._name=i,this._baseUrl=g.URLExt.join(null!==(t=null==n?void 0:n.endpoint)&&void 0!==t?t:"https://s3.amazonaws.com/",this._name),this._provider="S3";const c=null==n?void 0:n.region;"string"==typeof c?this._region=c:(null!=c?c:this.getRegion)().then((e=>{this._region=e})),this._root=o,this._registeredFileTypes={}}get s3Client(){return this._s3Client}set s3Client(e){this._s3Client=e}get config(){return this._config}set config(e){this._config=e,this._s3Client=new y.S3Client(e)}get baseUrl(){return this._baseUrl}set baseUrl(e){this._baseUrl=e}get name(){return this._name}set name(e){this._name=e,this._fileChanged.emit({type:"new",oldValue:null,newValue:{path:""}})}get root(){return this._root}set root(e){this.formatRoot(null!=e?e:"").then((e=>this._root=e))}get isRootFormatted(){return this._isRootFormatted}set isRootFormatted(e){this._isRootFormatted=e}get provider(){return this._provider}set provider(e){this._provider=e}get region(){return this._region}set region(e){this._region=e}get creationDate(){return this._creationDate}set creationDate(e){this._creationDate=e}get registeredFileTypes(){return this._registeredFileTypes}set registeredFileTypes(e){this._registeredFileTypes=e}get serverSettings(){return this._serverSettings}get fileChanged(){return this._fileChanged}get isDisposed(){return this._isDisposed}get disposed(){return this._disposed}dispose(){this.isDisposed||(this._secretsManager&&this._secretsManager.detachAll(I.getToken(),A),this._isDisposed=!0,this._disposed.emit(),m.Signal.clearData(this))}async getDownloadUrl(e){const t=await(async(e,t,n)=>{const i=new y.GetObjectCommand({Bucket:t,Key:n,ResponseContentDisposition:"attachment",ResponseContentType:"application/octet-stream"});return await e.send(i),await(0,w.getSignedUrl)(e,i)})(this._s3Client,this._name,e);return t}async get(e,t){var n;return e=e.replace(this._name+"/",""),this._isRootFormatted||(this.formatRoot(null!==(n=this._root)&&void 0!==n?n:"").then((e=>{this._root=e})),this._isRootFormatted=!0),E=await v(this._s3Client,this._name,this.root,this.registeredFileTypes,e),p.Contents.validateContentsModel(E),E}async newUntitled(e={}){const t=await v(this._s3Client,this._name,this._root,this.registeredFileTypes,e.path);if(void 0!==e.type){const n=this.incrementUntitledName(t,e);E=await C(this._s3Client,this._name,this._root,n,e.path?g.PathExt.join(e.path,n):n,"",this.registeredFileTypes,"directory"===e.type)}else console.warn("Type of new element is undefined");return p.Contents.validateContentsModel(E),this._fileChanged.emit({type:"new",oldValue:null,newValue:E}),E}incrementUntitledName(e,t){const n=e.content;let i="",o=0,s=0,a=0;return"notebook"===t.type&&(t.ext="ipynb"),n.forEach((e=>{void 0!==t.ext?e.name.includes("untitled")&&e.name.includes(".txt")?o+=1:e.name.includes("Untitled")&&e.name.includes(".ipynb")&&(a+=1):e.name.includes("Untitled Folder")&&(s+=1)})),"txt"===t.ext&&(i=0===o?"untitled."+t.ext:"untitled"+o+"."+t.ext),"ipynb"===t.ext?i=0===a?"Untitled."+t.ext:"Untitled"+a+"."+t.ext:"directory"===t.type&&(i=0===s?"Untitled Folder":"Untitled Folder "+s),i}async delete(e){await(async(e,t,n,i)=>{i=g.PathExt.join(n,i);const o=new y.ListObjectsV2Command({Bucket:t,Prefix:""===g.PathExt.extname(i)?i+"/":i});let s=!0;for(;s;){const{Contents:n,IsTruncated:i,NextContinuationToken:a}=await e.send(o);n&&await Promise.all(n.map((async n=>k.deleteFile(e,t,n.Key)))),s&&(s=i),o.input.ContinuationToken=a}})(this._s3Client,this._name,this._root,e),this._fileChanged.emit({type:"delete",oldValue:{path:e},newValue:{path:void 0}})}async rename(e,t,n={}){let i=g.PathExt.basename(t);const o=await S(this._s3Client,this._name,e);try{await b(this._s3Client,this._name,this._root,t,o),i=await this.incrementName(t,this._name,o)}catch(e){}finally{E=await(async(e,t,n,i,o,s,a,r)=>{var c;o=g.PathExt.join(n,o),i=g.PathExt.join(n,i),a&&(o=o.substring(0,o.length-1)),o=o.substring(0,o.lastIndexOf("/")+1)+s;const[l,d,h]=k.getFileType(g.PathExt.extname(g.PathExt.basename(s)),a,r),u=new y.ListObjectsV2Command({Bucket:t,Prefix:i});let m=!0;for(;m;){const{Contents:r,IsTruncated:p,NextContinuationToken:g}=await e.send(u);if(r){const u=await e.send(new y.GetObjectCommand({Bucket:t,Key:r[0].Key})),m=await(null===(c=u.Body)||void 0===c?void 0:c.transformToString()),p=r.map((async n=>{const s=n.Key.substring(i.length);return await k.copyFile(e,t,s,i,o),k.deleteFile(e,t,i+s)}));await Promise.all(p);let g=(new Date).toISOString();a||(g=(await e.send(new y.HeadObjectCommand({Bucket:t,Key:o}))).LastModified.toISOString()),f={name:s,path:o.replace(n,""),last_modified:g,created:"",content:m||[],format:h,mimetype:d,size:u.ContentLength,writable:!0,type:l}}m&&(m=p),u.input.ContinuationToken=g}return f})(this._s3Client,this._name,this._root,e,t,i,o,this._registeredFileTypes)}return p.Contents.validateContentsModel(E),this._fileChanged.emit({type:"rename",oldValue:{path:e},newValue:E}),E}async incrementName(e,t,n){let i="",o="";!0===n?(e="/"===e[e.length-1]?e.substring(0,e.length-1):e,o=g.PathExt.basename(e)):(o=g.PathExt.basename(e),i=g.PathExt.extname(o),o=o.split(".")[o.split(".").length-2]);const s=await(async(e,t,n,i,o)=>{let s=0;i=g.PathExt.join(n,i);const a=new y.ListObjectsV2Command({Bucket:t,Prefix:i.substring(0,i.lastIndexOf("/"))});let r=!0;for(;r;){const{Contents:t,IsTruncated:c,NextContinuationToken:l}=await e.send(a);t&&t.forEach((e=>{let t="/"===e.Key[e.Key.length-1]?e.Key.substring(0,e.Key.length-1):e.Key;t=t.replace((n?n+"/":"")+(i?i+"/":""),"").split("/")[0],t.substring(0,o.length+1).includes(o)&&(s+=1)})),r&&(r=c),a.input.ContinuationToken=l}return s})(this._s3Client,t,this._root,e,o);let a=s?o+s:o;return a=n?a+"/":a+i,a}async save(e,t={}){const n=g.PathExt.basename(e);return E=await C(this._s3Client,this._name,this._root,n,e,t.content,this._registeredFileTypes,!0,t),p.Contents.validateContentsModel(E),this._fileChanged.emit({type:"save",oldValue:null,newValue:E}),E}async incrementCopyName(e,t){const n=await S(this._s3Client,t,e),i=g.PathExt.basename(e),o=n?i+"-Copy":i.split(".")[0]+"-Copy."+i.split(".")[1],s=e.substring(0,e.lastIndexOf("/")+1)+o+(n?"/":"");return await this.incrementName(s,t,n)}async copy(e,t,n={}){const i=await this.incrementCopyName(e,this._name);return E=await x(this._s3Client,this._name,this._root,i,e,t,this._registeredFileTypes),p.Contents.validateContentsModel(E),this._fileChanged.emit({type:"new",oldValue:null,newValue:E}),E}async copyToAnotherBucket(e,t,n,i={}){const o=await this.incrementCopyName(e,n);return E=await x(this._s3Client,this._name,this._root,o,e,t,this._registeredFileTypes,n),this._fileChanged.emit({type:"new",oldValue:null,newValue:E}),p.Contents.validateContentsModel(E),E}async createCheckpoint(e){return Promise.resolve({id:"",last_modified:""})}listCheckpoints(e){return Promise.resolve([])}restoreCheckpoint(e,t){return Promise.reject("Repository is read only")}deleteCheckpoint(e,t){return Promise.reject("Read only")}async getRegion(){var e;const t=await this._s3Client.send(new y.GetBucketLocationCommand({Bucket:this._name}));return null!==(e=null==t?void 0:t.LocationConstraint)&&void 0!==e?e:""}getRegisteredFileTypes(e){const t=e.docRegistry.fileTypes();for(const e of t)0===e.extensions.length&&(this._registeredFileTypes[""]={fileType:"directory",fileFormat:"json",fileMimeTypes:["text/directory"]}),e.extensions.forEach((t=>{this._registeredFileTypes[t]||(this._registeredFileTypes[t]={fileType:e.name,fileMimeTypes:[...e.mimeTypes],fileFormat:e.fileFormat?e.fileFormat:""})}))}async formatRoot(e){if(""===e)return e;e=g.PathExt.removeSlash(g.PathExt.normalize(e));try{return await b(this._s3Client,this._name,e),e}catch(e){return console.log("Given path to root directory doesn't exist within bucket."),""}}}var I;!function(e){let t;e.setToken=function(e){t=e},e.getToken=function(){return t}}(I||(I={}));const P=new r.LabIcon({name:"jupydrive-s3:drive",svgstr:'<svg \n    xmlns="http://www.w3.org/2000/svg"\n    height="34" viewBox="0 -960 960 960"\n    width="34"\n    >\n    <path d="M260-160q-91 0-155.5-63T40-377q0-78 47-139t123-78q25-92 100-149t170-57q117 0 198.5 81.5T760-520q69 8 114.5 59.5T920-340q0 75-52.5 127.5T740-160H260Z"\n    fill = "#616161"\n    />\n</svg>'});new r.LabIcon({name:"jupydrive-s3:new-drive",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" \nxmlns:xlink="http://www.w3.org/1999/xlink" \nversion="1.1" \nx="0px" \ny="0px" \nviewBox="0 0 95 86.5" \n height="54" \n width="54"\nstyle="enable-background:new 0 0 98 98;" \nxml:space="preserve"\n>\n<path \nclass="st0" \nd="M90.87,42.866c0.003,7.796-6.343,14.141-14.141,14.141H71.07c-0.027-0.085-0.063-0.167-0.09-0.252  c-0.127-0.389-0.265-0.772-0.411-1.152c-0.077-0.199-0.153-0.399-0.235-0.596c-0.163-0.387-0.335-0.769-0.518-1.145  c-0.129-0.265-0.265-0.525-0.403-0.785c-0.078-0.147-0.159-0.291-0.241-0.436c-0.292-0.523-0.604-1.032-0.934-1.528  c-0.032-0.049-0.064-0.099-0.097-0.147c-0.612-0.903-1.284-1.755-2.012-2.557c-0.015-0.017-0.032-0.035-0.047-0.052  c-0.735-0.806-1.522-1.558-2.362-2.251c-0.044-0.037-0.09-0.072-0.134-0.107c-0.456-0.37-0.925-0.723-1.408-1.058  c-0.166-0.115-0.332-0.228-0.5-0.339c-0.225-0.148-0.451-0.297-0.681-0.436c-0.362-0.221-0.732-0.43-1.107-0.63  c-0.182-0.097-0.366-0.189-0.551-0.283c-0.366-0.184-0.737-0.359-1.114-0.524c-0.118-0.051-0.234-0.104-0.353-0.153  c-0.444-0.185-0.897-0.353-1.355-0.511c-0.122-0.042-0.245-0.084-0.368-0.124c-0.501-0.164-1.009-0.312-1.525-0.442  c-0.078-0.02-0.156-0.036-0.234-0.054c-0.494-0.118-0.994-0.221-1.499-0.306c-0.072-0.012-0.144-0.027-0.217-0.039  c-0.54-0.087-1.088-0.151-1.64-0.2c-0.109-0.01-0.218-0.017-0.329-0.025c-0.563-0.041-1.129-0.069-1.703-0.069  c-0.574,0-1.14,0.028-1.703,0.069c-0.109,0.008-0.22,0.015-0.328,0.025c-0.552,0.048-1.1,0.114-1.641,0.2  c-0.072,0.012-0.143,0.026-0.216,0.039c-0.506,0.087-1.007,0.188-1.502,0.307c-0.077,0.018-0.155,0.035-0.233,0.054  c-0.516,0.13-1.025,0.278-1.528,0.442c-0.122,0.04-0.243,0.082-0.366,0.124c-0.46,0.158-0.915,0.327-1.361,0.514  c-0.115,0.048-0.227,0.099-0.341,0.148c-0.38,0.166-0.755,0.344-1.124,0.529c-0.183,0.091-0.365,0.183-0.545,0.279  c-0.377,0.201-0.748,0.411-1.112,0.634c-0.228,0.139-0.449,0.286-0.672,0.431c-0.173,0.114-0.343,0.23-0.513,0.347  c-0.473,0.328-0.932,0.674-1.38,1.036c-0.053,0.043-0.107,0.084-0.16,0.128c-0.276,0.228-0.547,0.463-0.812,0.704  c-0.005,0.005-0.011,0.011-0.017,0.016c-0.529,0.482-1.035,0.989-1.52,1.519c-0.02,0.023-0.041,0.045-0.062,0.068  c-0.723,0.797-1.391,1.646-2,2.542c-0.039,0.057-0.076,0.116-0.115,0.173c-0.322,0.485-0.627,0.982-0.912,1.493  c-0.087,0.153-0.172,0.307-0.254,0.461c-0.136,0.254-0.269,0.509-0.395,0.77c-0.184,0.38-0.358,0.766-0.523,1.157  c-0.08,0.192-0.154,0.385-0.228,0.578c-0.151,0.389-0.292,0.783-0.422,1.181c-0.026,0.079-0.059,0.154-0.084,0.233l-5.659,0  c-7.799,0-14.143-6.345-14.143-14.144c0-7.799,6.345-14.143,14.143-14.143l3.577,0l0.17-1.249c1.055-7.77,7.773-13.63,15.626-13.63  c5.271,0,10.172,2.618,13.113,7.004l0.857,1.277l1.222-0.935c1.723-1.321,3.786-2.019,5.963-2.019c4.81,0,8.981,3.579,9.703,8.327  l0.186,1.227l5.036,0C84.526,28.723,90.87,35.067,90.87,42.866z M68.537,58.654c0.454,1.68,0.701,3.446,0.701,5.269  c-0.001,11.159-9.078,20.235-20.235,20.235c-11.156,0-20.233-9.076-20.233-20.233c0-1.829,0.248-3.599,0.705-5.286  c0.108-0.402,0.232-0.796,0.363-1.185c0.049-0.143,0.094-0.287,0.145-0.429c0.137-0.381,0.291-0.755,0.45-1.124  c0.09-0.206,0.182-0.41,0.277-0.613c0.103-0.218,0.213-0.431,0.322-0.644c0.184-0.355,0.377-0.704,0.58-1.048  c0.063-0.106,0.128-0.211,0.193-0.316c0.301-0.484,0.619-0.955,0.958-1.411c0.013-0.018,0.026-0.037,0.04-0.054  c0.57-0.76,1.192-1.478,1.86-2.15c0.035-0.037,0.074-0.073,0.109-0.109c0.387-0.384,0.793-0.751,1.21-1.104  c0.079-0.067,0.158-0.134,0.238-0.199c0.224-0.183,0.451-0.363,0.682-0.536c0.268-0.199,0.539-0.393,0.816-0.579  c0.193-0.13,0.391-0.253,0.588-0.378c0.24-0.149,0.483-0.295,0.729-0.433c0.203-0.116,0.408-0.228,0.616-0.337  c0.312-0.163,0.627-0.318,0.948-0.464c0.131-0.06,0.261-0.121,0.393-0.179c0.413-0.178,0.831-0.343,1.257-0.494  c0.103-0.037,0.207-0.07,0.31-0.105c0.463-0.156,0.93-0.301,1.406-0.422c0.007-0.002,0.013-0.003,0.02-0.004  c0.485-0.124,0.979-0.225,1.477-0.314c0.08-0.014,0.159-0.029,0.238-0.042c0.488-0.08,0.982-0.143,1.48-0.187  c0.087-0.008,0.174-0.013,0.262-0.02c0.515-0.039,1.033-0.065,1.557-0.065c0.524,0,1.041,0.026,1.557,0.065  c0.088,0.007,0.174,0.012,0.262,0.02c0.498,0.044,0.992,0.107,1.48,0.187c0.08,0.013,0.159,0.029,0.239,0.043  c0.497,0.088,0.989,0.19,1.474,0.313c0.008,0.002,0.015,0.003,0.023,0.005c0.475,0.122,0.942,0.268,1.404,0.422  c0.104,0.035,0.209,0.069,0.313,0.106c0.425,0.151,0.842,0.315,1.255,0.493c0.134,0.057,0.265,0.119,0.399,0.18  c0.318,0.145,0.631,0.3,0.94,0.46c0.212,0.11,0.421,0.225,0.628,0.343c0.243,0.137,0.482,0.28,0.719,0.428  c0.199,0.124,0.399,0.249,0.593,0.381c0.253,0.17,0.501,0.349,0.746,0.53c0.256,0.19,0.507,0.386,0.754,0.587  c0.077,0.063,0.153,0.128,0.229,0.191c0.422,0.355,0.83,0.726,1.222,1.114c0.034,0.034,0.068,0.066,0.102,0.1  c0.67,0.673,1.294,1.393,1.864,2.154c0.012,0.015,0.023,0.032,0.033,0.047c0.341,0.458,0.661,0.931,0.963,1.417  c0.065,0.105,0.13,0.21,0.193,0.317c0.203,0.34,0.394,0.687,0.577,1.041c0.112,0.217,0.223,0.432,0.327,0.654  c0.095,0.2,0.186,0.404,0.275,0.607c0.161,0.372,0.314,0.748,0.454,1.132c0.05,0.138,0.094,0.277,0.141,0.416  C68.301,57.843,68.427,58.245,68.537,58.654z M60.696,63.925c0-0.798-0.647-1.443-1.443-1.443l-8.805,0.001v-8.807  c0-0.798-0.647-1.443-1.443-1.443c-0.797,0-1.443,0.646-1.443,1.443v8.807h-8.807c-0.798,0-1.443,0.645-1.443,1.443  c0,0.798,0.646,1.443,1.443,1.443h8.807v8.806c0,0.798,0.647,1.443,1.443,1.443c0.797,0,1.443-0.646,1.443-1.443v-8.806h8.805  C60.051,65.369,60.696,64.722,60.696,63.925z"\nfill = "#616161"\n/>\n\x3c!-- <text x="0" y="113" fill="#000000" font-size="5px" font-weight="bold" font-family="\'Helvetica Neue\', Helvetica, Arial-Unicode, Arial, Sans-serif">Created by Good Father</text><text x="0" y="118" fill="#000000" font-size="5px" font-weight="bold" font-family="\'Helvetica Neue\', Helvetica, Arial-Unicode, Arial, Sans-serif">from the Noun Project</text> --\x3e\n</svg>'});var B,F=n(6685);!function(e){e.openPath="filebrowser:open-path",e.openSwitchDrive="drives:open-switch-drive-dialog",e.copyToAnotherBucket="drives:copy-to-another-bucket",e.toggleBucketSwitching="drives:toggle-bucket-switching-ui",e.toggleBrowser="filebrowser:toggle-main",e.rename="drives:rename"}(B||(B={}));const j="DriveBrowser",D="jp-FileDialog",R="jp-new-drive-title",N="jupydrive-s3:drive-name-id",M=new u.Token("jupydrive-s3:auth-file-browser"),A="jupydrive-s3:auth-file-browser",O=F.SecretsManager.sign(A,(e=>({id:"jupydrive-s3:auth-file-browser",description:"The default file browser auth/credentials provider",requires:[c.ISettingRegistry,F.ISecretsManager],provides:M,activate:(t,n,i)=>{const o=["accessKeyId","secretAccessKey"];function s(t){const n=t.get("bucket").composite,s=t.get("root").composite,a=t.get("endpoint").composite,r=t.get("region").composite;return o.forEach((n=>{const o=t.get(n).composite;i.set(e,A,A+"::"+n,{namespace:A,id:A+"::"+n,value:o})})),{name:n,root:s,config:{forcePathStyle:!0,endpoint:a,region:r,credentials:{accessKeyId:"***",secretAccessKey:"***"}},secretsManager:i,token:e}}const a=t=>{const n=document.getElementById("jp-SettingsEditor-jupydrive-s3:auth-file-browser_"+t);n?(n.type="password",i.attach(e,A,A+"::"+t,n)):setTimeout((()=>a(t)),300)};return new MutationObserver((()=>{o.forEach((e=>a(e)))})).observe(document.body,{childList:!0,subtree:!0}),Promise.all([t.restored,n.load(O.id)]).then((([n,o])=>{o.changed.connect((()=>{const n=s(o),a=new T({...n,secretsManager:i,token:e});t.serviceManager.contents.addDrive(a)}))})),{factory:async()=>{var e,t,i,o,a,r,c;return null!==(e=await(async()=>{const e=s(await n.load(O.id));return""!==e.name?e:null})())&&void 0!==e?e:{name:null!==(t="MISSING_ENV_VAR".JP_S3_BUCKET)&&void 0!==t?t:"jupyter-drives-test-bucket-1",root:null!==(i="MISSING_ENV_VAR".JP_S3_ROOT)&&void 0!==i?i:"",config:{forcePathStyle:!0,endpoint:null!==(o="MISSING_ENV_VAR".JP_S3_ENDPOINT)&&void 0!==o?o:"https://example.com/s3",region:null!==(a="MISSING_ENV_VAR".JP_S3_REGION)&&void 0!==a?a:"eu-west-1",credentials:{accessKeyId:null!==(r="MISSING_ENV_VAR".JP_S3_ACCESS_KEY_ID)&&void 0!==r?r:"abcdefghijklmnopqrstuvwxyz",secretAccessKey:null!==(c="MISSING_ENV_VAR".JP_S3_SECRET_ACCESS_KEY)&&void 0!==c?c:"SECRET123456789abcdefghijklmnopqrstuvwxyz"}}}}}}}))),V={id:"jupydrive-s3:default-file-browser",description:"The default file browser factory provider",provides:s.IDefaultFileBrowser,requires:[s.IFileBrowserFactory,M,a.IStateDB,c.ISettingRegistry],optional:[i.IRouter,i.JupyterFrontEnd.ITreeResolver,i.ILabShell],activate:async(e,t,n,i,o,s,a,c)=>{const{commands:l}=e,h=await n.factory(),u=new T({name:h.name,root:h.root,config:h.config,secretsManager:h.secretsManager,token:h.token});e.serviceManager.contents.addDrive(u),u.getRegisteredFileTypes(e);const m=t.createFileBrowser("drivebrowser",{auto:!1,restore:!1,driveName:u.name});function p(e){return e.get("bucketSwitching").composite}m.node.setAttribute("role","region"),m.node.setAttribute("aria-label","Drive Browser Section"),m.title.icon=r.folderIcon;const g=()=>{const t=e.commands.keyBindings.find((e=>e.command===B.toggleBrowser));if(t){const e=t.keys.map(d.CommandRegistry.formatKeystroke).join(", ");m.title.caption="Drive Browser ("+e+")"}else m.title.caption="Drive Browser"};return g(),e.commands.keyBindingChanged.connect((()=>{g()})),e.restored.then((()=>Promise.all([i.fetch(N),o.load(K.id)]))).then((([n,o])=>{if(n){const t=n.bucket,i=n.root;u.name=t,u.root=i,e.serviceManager.contents.addDrive(u)}o.changed.connect(p),U.addCommands(e,u,t,i,o)})),U.restoreBrowser(m,l,s,a,c),m}},K={id:"jupydrive-s3:file-browser-toolbar",description:"The toolbar for the drives file browser",requires:[s.IDefaultFileBrowser,o.IToolbarWidgetRegistry,c.ISettingRegistry,l.ITranslator,s.IFileBrowserFactory],autoStart:!0,activate:async(e,t,n,i,a)=>{n.addFactory(j,"uploaderTest",(e=>new s.Uploader({model:e.model,translator:a}))),n.addFactory(j,"fileNameSearcherTest",(e=>{const t=(0,r.FilenameSearcher)({updateFilter:(t,n)=>{e.model.setFilter((e=>t(e.name.toLowerCase())))},useFuzzyFilter:!0,placeholder:"Filter files by names",forceRefresh:!0});return t.addClass("jp-DriveBrowser-filterBox"),t})),(0,o.setToolbar)(t,(0,o.createToolbarFactory)(n,i,j,"jupydrive-s3:file-browser-toolbar",a))}},L=[O,V,K];var U;!function(e){const t=e=>{const t=document.createElement("div"),n=document.createElement("label");n.textContent="Current Drive: "+e;const i=document.createElement("label");i.textContent="Switch to another Drive",i.className=R;const o=document.createElement("input"),s=document.createElement("label");s.textContent="with root",s.className=R;const a=document.createElement("input");return t.appendChild(n),t.appendChild(i),t.appendChild(o),t.appendChild(s),t.appendChild(a),t},n=()=>{const e=document.createElement("div"),t=document.createElement("label");t.textContent="Copy to another Bucket",t.className=R;const n=document.createElement("input"),i=document.createElement("label");i.textContent="Location within the Bucket",i.className=R;const o=document.createElement("input");return e.appendChild(t),e.appendChild(n),e.appendChild(i),e.appendChild(o),e};class i extends h.Widget{constructor(){super({node:n()}),this.onAfterAttach()}get bucketInput(){return this.node.getElementsByTagName("input")[0]}get rootInput(){return this.node.getElementsByTagName("input")[1]}onAfterAttach(){this.addClass(D);const[e,t]=this.getValue();this.bucketInput.setSelectionRange(0,e.length),this.rootInput.setSelectionRange(0,t.length)}getValue(){return[this.bucketInput.value,this.rootInput.value]}}e.CopyToAnotherBucket=i;class s extends h.Widget{constructor(e){super({node:t(e)}),this.onAfterAttach()}onAfterAttach(){this.addClass(D);const e=this.bucketInput.value;this.bucketInput.setSelectionRange(0,e.length);const t=this.rootInput.value;this.rootInput.setSelectionRange(0,t.length)}get bucketInput(){return this.node.getElementsByTagName("input")[0]}get rootInput(){return this.node.getElementsByTagName("input")[1]}getValue(){return[this.bucketInput.value,this.rootInput.value]}}e.SwitchDriveHandler=s,e.addCommands=function(t,n,i,s,a){const{tracker:c}=i;t.commands.addCommand(B.openSwitchDrive,{isVisible:()=>{var e;return null!==(e=a.get("bucketSwitching").composite)&&void 0!==e&&e},execute:async()=>(0,o.showDialog)({body:new e.SwitchDriveHandler(n.name),focusNodeSelector:"input",buttons:[o.Dialog.okButton({label:"Switch Drive",ariaLabel:"Switch to another Drive"})]}).then((e=>{e.value&&(n.name=e.value[0],n.root=e.value[1],t.serviceManager.contents.addDrive(n),s.save(N,{bucket:e.value[0],root:e.value[1]}))})),icon:P.bindprops({stylesheet:"menuItem"})}),t.commands.addCommand(B.copyToAnotherBucket,{execute:async()=>(0,o.showDialog)({body:new e.CopyToAnotherBucket,focusNodeSelector:"input",buttons:[o.Dialog.okButton({label:"Copy",ariaLabel:"Copy to another Bucket"})]}).then((e=>{const t=c.currentWidget;if(t){const i=t.selectedItems().next().value.path.split(":")[1];e.value&&n.copyToAnotherBucket(i,e.value[1],e.value[0])}})),icon:P.bindprops({stylesheet:"menuItem"}),label:"Copy to another Bucket"}),t.contextMenu.addItem({command:B.copyToAnotherBucket,selector:".jp-SidePanel .jp-DirListing-content .jp-DirListing-item[data-isDir]",rank:10}),t.commands.addCommand(B.rename,{execute:e=>{const t=c.currentWidget;if(t)return t.rename()},isVisible:()=>!!c.currentWidget&&1===Array.from(c.currentWidget.selectedItems()).length,isEnabled:()=>{var e;return!!c.currentWidget&&"directory"!==(null===(e=c.currentWidget)||void 0===e?void 0:e.selectedItems().next().value.type)},icon:r.editIcon.bindprops({stylesheet:"menuItem"}),label:"Rename",mnemonic:0})},e.restoreBrowser=async function(e,t,n,i,o){const s="jp-mod-restoring";if(e.addClass(s),!n)return await e.model.restore(e.id),await e.model.refresh(),void e.removeClass(s);const a=async()=>{n.routed.disconnect(a);const r=await(null==i?void 0:i.paths);(null==r?void 0:r.file)||(null==r?void 0:r.browser)?(await e.model.restore(e.id,!1),r.file&&await t.execute(B.openPath,{path:r.file,dontShowBrowser:!0}),r.browser&&await t.execute(B.openPath,{path:r.browser,dontShowBrowser:!0})):(await e.model.restore(e.id),await e.model.refresh()),e.removeClass(s),(null==o?void 0:o.isEmpty("main"))&&t.execute("launcher:create")};n.routed.connect(a)}}(U||(U={}))}}]);