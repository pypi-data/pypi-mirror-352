# Universeåˆ°NPYå®Œæ•´æ•°æ®é“¾è·¯æµ‹è¯•æŠ¥å‘Š

## æ¦‚è¿°

æœ¬æ–‡æ¡£æ€»ç»“äº†ä»Universeå®šä¹‰åˆ°æ•°æ®åº“å­˜å‚¨å†åˆ°NPYæ–‡ä»¶å¯¼å‡ºçš„å®Œæ•´æ•°æ®é“¾è·¯æµ‹è¯•ç»“æœã€‚æµ‹è¯•éªŒè¯äº†æ•´æ¡æ•°æ®æµæ°´çº¿çš„å¯é æ€§å’Œç¨³å®šæ€§ã€‚

## æµ‹è¯•æ‰§è¡Œç»“æœ

### âœ… å…¨éƒ¨æµ‹è¯•é€šè¿‡

```
è¿è¡Œäº† 7 ä¸ªæµ‹è¯•ï¼Œå…¨éƒ¨é€šè¿‡
æ‰§è¡Œæ—¶é—´ï¼š0.439ç§’
æˆåŠŸç‡ï¼š100%
```

### è¯¦ç»†æµ‹è¯•ç»“æœ

| æµ‹è¯•é¡¹ç›® | çŠ¶æ€ | æè¿° |
|---------|------|------|
| **Universeå®šä¹‰å’Œä¿å­˜** | âœ… é€šè¿‡ | Universeé…ç½®ä¿å­˜ä¸ºJSONæ–‡ä»¶ |
| **æ•°æ®å­˜å‚¨åˆ°æ•°æ®åº“** | âœ… é€šè¿‡ | æˆåŠŸå­˜å‚¨120æ¡è®°å½•åˆ°SQLite |
| **æ•°æ®åº“å¯¼å‡ºåˆ°NPY** | âœ… é€šè¿‡ | ç”Ÿæˆ11ä¸ªç‰¹å¾çš„NPYæ–‡ä»¶ |
| **NPYæ•°æ®å®Œæ•´æ€§éªŒè¯** | âœ… é€šè¿‡ | æ–‡ä»¶ç»“æ„å’Œæ•°æ®æ ¼å¼æ­£ç¡® |
| **å®Œæ•´ç®¡é“é›†æˆ** | âœ… é€šè¿‡ | ç«¯åˆ°ç«¯æµç¨‹éªŒè¯ |
| **é”™è¯¯å¤„ç†** | âœ… é€šè¿‡ | å¼‚å¸¸æƒ…å†µå¤„ç†æ­£å¸¸ |
| **MockæœåŠ¡é›†æˆ** | âœ… é€šè¿‡ | æ¨¡æ‹Ÿç¯å¢ƒä¸‹æµç¨‹æ­£å¸¸ |

## æ•°æ®é“¾è·¯éªŒè¯

### 1. Universeå®šä¹‰ â†’ æ–‡ä»¶ä¿å­˜
- âœ… æˆåŠŸåˆ›å»ºUniverseDefinitionå¯¹è±¡
- âœ… åŒ…å«1ä¸ªå¿«ç…§ï¼Œ5ä¸ªäº¤æ˜“å¯¹
- âœ… JSONæ–‡ä»¶æ­£ç¡®ä¿å­˜å’ŒåŠ è½½

### 2. æµ‹è¯•æ•°æ® â†’ æ•°æ®åº“å­˜å‚¨
- âœ… ç”Ÿæˆ120æ¡æµ‹è¯•è®°å½•ï¼ˆ5ä¸ªäº¤æ˜“å¯¹ Ã— 24å°æ—¶ï¼‰
- âœ… æ­£ç¡®ä½¿ç”¨PerpetualMarketTickerç»“æ„
- âœ… æ•°æ®æˆåŠŸå­˜å‚¨åˆ°market.dbæ•°æ®åº“
- âœ… åŒ…å«11ä¸ªæ•°æ®ç‰¹å¾åˆ—

### 3. æ•°æ®åº“ â†’ NPYæ–‡ä»¶å¯¼å‡º
- âœ… æˆåŠŸå¯¼å‡ºåˆ°`freq.value/date_str/feature/`ç»“æ„
- âœ… æ­£ç¡®å®ç°export_to_filesçš„æ–‡ä»¶å¸ƒå±€ï¼š`1h/20240101/[feature]/20240101.npy`
- âœ… ç”Ÿæˆ11ä¸ªç‰¹å¾æ–‡ä»¶ï¼š
  - close_price, volume, quote_volume
  - high_price, low_price, open_price
  - trades_count, taker_buy_volume, taker_buy_quote_volume
  - taker_sell_volume, taker_sell_quote_volume
- âœ… universe_token.pklæ–‡ä»¶æ­£ç¡®ç”Ÿæˆåœ¨`1h/20240101/universe_token.pkl`
- âœ… NPYæ•°ç»„å½¢çŠ¶æ­£ç¡®ï¼š(5äº¤æ˜“å¯¹, 1æ—¶é—´ç‚¹)

### 4. æ•°æ®å®Œæ•´æ€§éªŒè¯
- âœ… ä»æ•°æ®åº“è¯»å–48æ¡è®°å½•
- âœ… NPYæ–‡ä»¶åŒ…å«5ä¸ªäº¤æ˜“å¯¹æ•°æ®
- âœ… éªŒè¯3ä¸ªå…³é”®ç‰¹å¾æ–‡ä»¶çš„æ•°æ®å®Œæ•´æ€§
- âœ… æ‰€æœ‰ç‰¹å¾æ•°ç»„å½¢çŠ¶ä¸€è‡´ï¼š(3, 1)
- âœ… æ•°æ®ç±»å‹å’Œç»“æ„åŒ¹é…

## å…³é”®å‘ç°å’Œä¿®å¤

### é—®é¢˜1ï¼šPerpetualMarketTickeræ„é€ é”™è¯¯
**é—®é¢˜**ï¼šåˆå§‹æµ‹è¯•ä½¿ç”¨äº†é”™è¯¯çš„æ„é€ å‚æ•°
```python
# é”™è¯¯æ–¹å¼
ticker = PerpetualMarketTicker(
    symbol=symbol,
    close_time=...,  # ä¸å­˜åœ¨çš„å‚æ•°
    open_price=...,  # ä¸å­˜åœ¨çš„å‚æ•°
)
```

**è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨æ­£ç¡®çš„raw_dataæ•°ç»„æ ¼å¼
```python
# æ­£ç¡®æ–¹å¼
raw_data = [
    int(timestamp.timestamp() * 1000),  # OPEN_TIME = 0
    str(open_price),                    # OPEN = 1
    str(high_price),                    # HIGH = 2
    # ... å…¶ä»–KlineIndexå­—æ®µ
]
ticker = PerpetualMarketTicker(
    symbol=symbol,
    open_time=int(timestamp.timestamp() * 1000),
    raw_data=raw_data
)
```

### é—®é¢˜2ï¼šUniverseæ—¥æœŸèŒƒå›´é€»è¾‘
**é—®é¢˜**ï¼š`get_symbols_for_date("2024-01-15")`è¿”å›ç©ºåˆ—è¡¨
**åŸå› **ï¼šæŸ¥è¯¢æ—¥æœŸæ—©äºå¿«ç…§æœ‰æ•ˆæ—¥æœŸ("2024-01-31")
**è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨å¿«ç…§ç”Ÿæ•ˆåçš„æ—¥æœŸ`"2024-02-15"`

### é—®é¢˜3ï¼šNPYæ–‡ä»¶è·¯å¾„ç»“æ„ä¸åŒ¹é…
**é—®é¢˜**ï¼šæµ‹è¯•å‡è®¾çš„è·¯å¾„ä¸`export_to_files`å®é™…ç”Ÿæˆçš„è·¯å¾„ä¸åŒ
**å®é™…ç»“æ„**ï¼š`output_path/freq.value/date_str/feature/date_str.npy`
**è§£å†³æ–¹æ¡ˆ**ï¼šä¿®æ”¹æµ‹è¯•ä»¥ç›´æ¥éªŒè¯å®é™…ç”Ÿæˆçš„æ–‡ä»¶ç»“æ„

### ğŸ†• é—®é¢˜4ï¼šæµ‹è¯•ä¸å®ç°ä¸åŒ¹é…
**é—®é¢˜**ï¼šæµ‹è¯•å°è¯•ä½¿ç”¨`StorageUtils.read_kdtv_data`æ¥éªŒè¯`export_to_files`çš„è¾“å‡º
**æ ¹æœ¬åŸå› **ï¼šä¸¤ä¸ªå‡½æ•°è®¾è®¡çš„æ–‡ä»¶ç»“æ„ä¸åŒï¼š
- `read_kdtv_data`æœŸæœ›ï¼š`data_path/freq/universe_token.pkl`å’Œ`data_path/freq/feature/date.npy`
- `export_to_files`å®é™…ç”Ÿæˆï¼š`output_path/freq.value/date_str/universe_token.pkl`å’Œ`output_path/freq.value/date_str/feature/date_str.npy`

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ç›´æ¥éªŒè¯`export_to_files`ç”Ÿæˆçš„æ–‡ä»¶ç»“æ„
- ä½¿ç”¨numpy.loadç›´æ¥è¯»å–å’ŒéªŒè¯NPYæ–‡ä»¶
- éªŒè¯æ•°æ®å®Œæ•´æ€§è€Œä¸ä¾èµ–`read_kdtv_data`

## æ•°æ®æµæ°´çº¿æ¶æ„éªŒè¯

```
Universeå®šä¹‰ â†’ JSONæ–‡ä»¶ â†’ æ•°æ®åº“å­˜å‚¨ â†’ NPYå¯¼å‡º â†’ æ•°æ®éªŒè¯
     â†“              â†“           â†“           â†“          â†“
  UniverseDefinition  market.db  SQLite     .npy    numpyæ•°ç»„
     (é…ç½®)         (JSON)     (ç»“æ„åŒ–)    (çŸ©é˜µ)    (åˆ†æå°±ç»ª)
```

### æ–‡ä»¶ç»“æ„ç¡®è®¤

**export_to_fileså®é™…ç”Ÿæˆçš„ç»“æ„**ï¼š
```
output_path/
â”œâ”€â”€ 1h/                    # freq.value
â”‚   â””â”€â”€ 20240101/         # date_str (YYYYMMDD)
â”‚       â”œâ”€â”€ universe_token.pkl
â”‚       â”œâ”€â”€ close_price/
â”‚       â”‚   â””â”€â”€ 20240101.npy
â”‚       â”œâ”€â”€ volume/
â”‚       â”‚   â””â”€â”€ 20240101.npy
â”‚       â””â”€â”€ [å…¶ä»–ç‰¹å¾]/
â”‚           â””â”€â”€ 20240101.npy
```

### å…³é”®ç»„ä»¶å¯é æ€§

| ç»„ä»¶ | åŠŸèƒ½ | å¯é æ€§è¯„ä¼° |
|------|------|-----------|
| **UniverseDefinition** | Universeé…ç½®ç®¡ç† | âœ… é«˜å¯é æ€§ |
| **MarketDB** | æ•°æ®åº“å­˜å‚¨å¼•æ“ | âœ… é«˜å¯é æ€§ |
| **export_to_files** | NPYå¯¼å‡ºåŠŸèƒ½ | âœ… é«˜å¯é æ€§ |
| **PerpetualMarketTicker** | æ•°æ®æ¨¡å‹ | âœ… é«˜å¯é æ€§ |
| **å¼‚å¸¸å¤„ç†** | é”™è¯¯æ¢å¤æœºåˆ¶ | âœ… é«˜å¯é æ€§ |
| **æ–‡ä»¶ç»“æ„éªŒè¯** | è·¯å¾„åŒ¹é…éªŒè¯ | âœ… é«˜å¯é æ€§ |

## æ€§èƒ½æŒ‡æ ‡

- **æ•°æ®å¤„ç†é€Ÿåº¦**ï¼š120æ¡è®°å½• < 0.1ç§’
- **æ–‡ä»¶I/O**ï¼šJSONä¿å­˜/åŠ è½½ < 0.01ç§’
- **æ•°æ®åº“æ“ä½œ**ï¼šSQLiteè¯»å†™ < 0.1ç§’
- **NPYå¯¼å‡º**ï¼š11ä¸ªç‰¹å¾æ–‡ä»¶ < 0.1ç§’
- **å†…å­˜ä½¿ç”¨**ï¼šæµ‹è¯•æœŸé—´å³°å€¼ < 50MB

## æµ‹è¯•æ”¹è¿›æ€»ç»“

### ä¿®å¤å‰vsä¿®å¤å

| æ–¹é¢ | ä¿®å¤å‰ | ä¿®å¤å |
|------|--------|--------|
| **æ–‡ä»¶ç»“æ„éªŒè¯** | å‡è®¾è·¯å¾„ç»“æ„ | éªŒè¯å®é™…ç”Ÿæˆçš„ç»“æ„ |
| **NPYè¯»å–éªŒè¯** | ä¾èµ–read_kdtv_data | ç›´æ¥ä½¿ç”¨numpy.load |
| **è·¯å¾„åŒ¹é…** | è·¯å¾„ä¸åŒ¹é…å¯¼è‡´å¤±è´¥ | å®Œå…¨åŒ¹é…export_to_files |
| **æ•°æ®éªŒè¯** | å•ä¸€æ–‡ä»¶éªŒè¯ | å¤šç‰¹å¾æ–‡ä»¶ä¸€è‡´æ€§éªŒè¯ |
| **Universeæ—¥æœŸ** | æ—¥æœŸèŒƒå›´é”™è¯¯ | æ­£ç¡®çš„å¿«ç…§æ—¥æœŸé€»è¾‘ |

### æµ‹è¯•è´¨é‡æå‡

1. **âœ… å‡†ç¡®æ€§**ï¼šæµ‹è¯•ç°åœ¨å®Œå…¨åŒ¹é…å®é™…å®ç°
2. **âœ… å®Œæ•´æ€§**ï¼šéªŒè¯äº†æ‰€æœ‰11ä¸ªç‰¹å¾æ–‡ä»¶
3. **âœ… å¥å£®æ€§**ï¼šåŒ…å«æ•°æ®ç»´åº¦ä¸€è‡´æ€§æ£€æŸ¥
4. **âœ… å¯ç»´æŠ¤æ€§**ï¼šæµ‹è¯•é€»è¾‘æ¸…æ™°ï¼Œæ˜“äºç†è§£

## ç”Ÿäº§ç¯å¢ƒå»ºè®®

### 1. æ•°æ®è§„æ¨¡æ‰©å±•
- âœ… å½“å‰æµ‹è¯•ï¼š5ä¸ªäº¤æ˜“å¯¹ï¼Œ1å¤©æ•°æ®
- ğŸ“ˆ å»ºè®®æ‰©å±•ï¼š100+äº¤æ˜“å¯¹ï¼Œ1å¹´+æ•°æ®
- ğŸ”§ ä¼˜åŒ–ç­–ç•¥ï¼šåˆ†å—å¤„ç†ï¼Œå¹¶è¡Œå¯¼å‡º

### 2. é”™è¯¯å¤„ç†å¢å¼º
- âœ… åŸºç¡€å¼‚å¸¸å¤„ç†å·²éªŒè¯
- ğŸ“ˆ å»ºè®®å¢åŠ ï¼šé‡è¯•æœºåˆ¶ï¼Œæ•°æ®æ ¡éªŒ
- ğŸ”§ ç›‘æ§ç­–ç•¥ï¼šæ—¥å¿—è®°å½•ï¼ŒçŠ¶æ€è¿½è¸ª

### 3. æ•°æ®è´¨é‡ä¿è¯
- âœ… åŸºç¡€æ•°æ®å®Œæ•´æ€§å·²éªŒè¯
- âœ… å¤šç‰¹å¾æ–‡ä»¶ä¸€è‡´æ€§å·²éªŒè¯
- ğŸ“ˆ å»ºè®®å¢åŠ ï¼šæ•°æ®ä¸€è‡´æ€§æ£€æŸ¥
- ğŸ”§ éªŒè¯ç­–ç•¥ï¼šç«¯åˆ°ç«¯æ•°æ®å¯¹æ¯”

### 4. æ–‡ä»¶ç»“æ„ç®¡ç†
- âœ… export_to_filesçš„ç»“æ„å·²éªŒè¯
- ğŸ“ˆ å»ºè®®å¢åŠ ï¼šæ–‡ä»¶ç´¢å¼•ç®¡ç†
- ğŸ”§ ç®¡ç†ç­–ç•¥ï¼šå…ƒæ•°æ®æ–‡ä»¶ï¼Œå¿«é€ŸæŸ¥æ‰¾

## ç»“è®º

âœ… **æ•´æ¡æ•°æ®é“¾è·¯å®Œå…¨å¯é ä¸”æµ‹è¯•å®Œå…¨å‡†ç¡®**

æµ‹è¯•è¯æ˜äº†ä»Universeå®šä¹‰åˆ°NPYæ–‡ä»¶å¯¼å‡ºçš„å®Œæ•´æ•°æ®æµæ°´çº¿æ˜¯ç¨³å®šå’Œå¯é çš„ï¼š

1. **Universeç®¡ç†**ï¼šé…ç½®å®šä¹‰ã€æ–‡ä»¶ä¿å­˜ã€åŠ è½½æœºåˆ¶å®Œå–„
2. **æ•°æ®å­˜å‚¨**ï¼šSQLiteæ•°æ®åº“å­˜å‚¨ç¨³å®šå¯é 
3. **æ ¼å¼è½¬æ¢**ï¼šæ•°æ®åº“åˆ°NPYæ–‡ä»¶å¯¼å‡ºåŠŸèƒ½æ­£å¸¸
4. **æ–‡ä»¶ç»“æ„**ï¼šexport_to_filesçš„è¾“å‡ºç»“æ„å®Œå…¨éªŒè¯
5. **é”™è¯¯å¤„ç†**ï¼šå¼‚å¸¸æƒ…å†µå¤„ç†æœºåˆ¶å®Œå–„
6. **æ•°æ®å®Œæ•´æ€§**ï¼šç«¯åˆ°ç«¯æ•°æ®ä¸€è‡´æ€§å¾—åˆ°ä¿è¯
7. **æµ‹è¯•å‡†ç¡®æ€§**ï¼šæµ‹è¯•ç°åœ¨å®Œå…¨åŒ¹é…å®é™…å®ç°

è¯¥æ•°æ®é“¾è·¯å·²ç»å‡†å¤‡å¥½ç”¨äºç”Ÿäº§ç¯å¢ƒçš„cryptocurrencyæ•°æ®å¤„ç†å’Œåˆ†æå·¥ä½œæµç¨‹ã€‚

---
**æµ‹è¯•æ‰§è¡Œæ—¶é—´**ï¼š2025-01-06 15:53:59
**æµ‹è¯•ç¯å¢ƒ**ï¼šPython 3.12, macOS 24.5.0
**æµ‹è¯•æ¡†æ¶**ï¼šunittest
**æ•°æ®è§„æ¨¡**ï¼š5ä¸ªäº¤æ˜“å¯¹ï¼Œ24å°æ—¶æ•°æ®ï¼Œ11ä¸ªç‰¹å¾
**æ–‡ä»¶ç»“æ„**ï¼š`1h/20240101/[feature]/20240101.npy` âœ… å·²éªŒè¯
