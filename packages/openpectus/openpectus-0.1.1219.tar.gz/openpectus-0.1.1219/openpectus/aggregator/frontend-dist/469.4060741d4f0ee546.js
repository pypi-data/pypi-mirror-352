"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[469],{6670:(de,Y,l)=>{de.exports=l.p+"25dd2e6f4f6bb57b.wasm"},96469:(de,Y,l)=>{l.r(Y),l.d(Y,{ITextMateTokenizationService:()=>F.S,default:()=>Ct});var w=l(10467),Ce=l(82407),F=l(46343),be=l(48952),p=l(38035),Le=l(48792),Z=l(37106),R=l(67197),we=l(70447),_=l(52814),K=l(2744),_e=l(48738),xe=l(88411),ze=(l(2726),l(97119)),X=l(26986),Me=l(28323),q=l(53899),le=l(93319),T=l(88206),I=l(86714),ee=l(86234),Ee=l(32412),f=l(25501),te=l(81856),ge=l(99396),ue=l(98039),Ie=l(25552),ne=l(65178),Pe=l(8527),Ae=l(76922),he=l(71846),Ne=l(44392),De=l(66205);class je extends _.jG{constructor(r,e,t,o,i,n,s){super(),this._grammar=r,this._initialState=e,this._containsEmbeddedLanguages=t,this._createBackgroundTokenizer=o,this._backgroundTokenizerShouldOnlyVerifyTokens=i,this._reportTokenizationTime=n,this._reportSlowTokenization=s,this._seenLanguages=[],this._onDidEncounterLanguage=this._register(new _e.vl),this.onDidEncounterLanguage=this._onDidEncounterLanguage.event}get backgroundTokenizerShouldOnlyVerifyTokens(){return this._backgroundTokenizerShouldOnlyVerifyTokens()}getInitialState(){return this._initialState}tokenize(r,e,t){throw new Error("Not supported!")}createBackgroundTokenizer(r,e){if(this._createBackgroundTokenizer)return this._createBackgroundTokenizer(r,e)}tokenizeEncoded(r,e,t){const o=1e4*Math.random()<1,i=this._reportSlowTokenization||o,n=i?new De.W(!0):void 0,s=this._grammar.tokenizeLine2(r,t,500);if(i){const c=n.elapsed();(o||c>32)&&this._reportTokenizationTime(c,r.length,o)}if(s.stoppedEarly)return console.warn(`Time limit reached when tokenizing line: ${r.substring(0,100)}`),new I.rY(s.tokens,t);if(this._containsEmbeddedLanguages){const c=this._seenLanguages,a=s.tokens;for(let g=0,m=a.length>>>1;g<m;g++){const L=T.xn.getLanguageId(a[1+(g<<1)]);c[L]||(c[L]=!0,this._onDidEncounterLanguage.fire(L))}}let d;return d=t.equals(s.ruleStack)?t:s.ruleStack,new I.rY(s.tokens,d)}}var Oe=l(420);class Fe extends _.jG{get backgroundTokenizerShouldOnlyVerifyTokens(){return this._actual.backgroundTokenizerShouldOnlyVerifyTokens}constructor(r,e,t,o){super(),this._encodedLanguageId=r,this._actual=e,this._maxTokenizationLineLength=o,this._register((0,X.wp)(this._maxTokenizationLineLength)),this._register(t)}getInitialState(){return this._actual.getInitialState()}tokenize(r,e,t){throw new Error("Not supported!")}tokenizeEncoded(r,e,t){return r.length>=this._maxTokenizationLineLength.get()?(0,Oe.Lh)(this._encodedLanguageId,t):this._actual.tokenizeEncoded(r,e,t)}createBackgroundTokenizer(r,e){if(this._actual.createBackgroundTokenizer)return this._actual.createBackgroundTokenizer(r,e)}}var Re=l(48408);let Be=(()=>{class h{static{this.CHANNEL_NAME="textMateWorkerHost"}static getChannel(e){return e.getChannel(h.CHANNEL_NAME)}static setChannel(e,t){e.setChannel(h.CHANNEL_NAME,t)}}return h})();var Ge=l(6934),Ve=l(17851),oe=l(97653),$e=l(41566),fe=l(54600),Qe=l(29863);class We{constructor(r){this.edits=r.slice().sort((0,Z.VE)(e=>e.offset,Z.U9))}applyToArray(r){for(let e=this.edits.length-1;e>=0;e--){const t=this.edits[e];r.splice(t.offset,t.length,...new Array(t.newLength))}}}class He{constructor(r,e,t){this.offset=r,this.length=e,this.newLength=t}toString(){return`[${this.offset}, +${this.length}) -> +${this.newLength}}`}}class B{static fromMany(r){const e=r.map(t=>new B(t));return new Ue(e)}constructor(r){this.transformation=r,this.idx=0,this.offset=0}transform(r){let e=this.transformation.edits[this.idx];for(;e&&e.offset+e.length<=r;)this.offset+=e.newLength-e.length,this.idx++,e=this.transformation.edits[this.idx];if(!(e&&e.offset<=r))return r+this.offset}}class Ue{constructor(r){this.transformers=r}transform(r){for(const e of this.transformers){const t=e.transform(r);if(void 0===t)return;r=t}return r}}let Je=(()=>{class h extends _.jG{static{this._id=0}constructor(e,t,o,i,n,s){super(),this._model=e,this._worker=t,this._languageIdCodec=o,this._backgroundTokenizationStore=i,this._configurationService=n,this._maxTokenizationLineLength=s,this.controllerId=h._id++,this._pendingChanges=[],this._states=new $e.CQ,this._loggingEnabled=(0,Qe.V)("editor.experimental.asyncTokenizationLogging",!1,this._configurationService),this._register((0,X.wp)(this._loggingEnabled)),this._register(this._model.onDidChangeContent(a=>{this._shouldLog&&console.log("model change",{fileName:this._model.uri.fsPath.split("\\").pop(),changes:ie(a.changes)}),this._worker.$acceptModelChanged(this.controllerId,a),this._pendingChanges.push(a)})),this._register(this._model.onDidChangeLanguage(a=>{const g=this._model.getLanguageId(),m=this._languageIdCodec.encodeLanguageId(g);this._worker.$acceptModelLanguageChanged(this.controllerId,g,m)}));const d=this._model.getLanguageId(),c=this._languageIdCodec.encodeLanguageId(d);this._worker.$acceptNewModel({uri:this._model.uri,versionId:this._model.getVersionId(),lines:this._model.getLinesContent(),EOL:this._model.getEOL(),languageId:d,encodedLanguageId:c,maxTokenizationLineLength:this._maxTokenizationLineLength.get(),controllerId:this.controllerId}),this._register((0,xe.fm)(a=>{const g=this._maxTokenizationLineLength.read(a);this._worker.$acceptMaxTokenizationLineLength(this.controllerId,g)}))}dispose(){super.dispose(),this._worker.$acceptRemovedModel(this.controllerId)}requestTokens(e,t){this._worker.$retokenize(this.controllerId,e,t)}setTokensAndStates(e,t,o,i){var n=this;return(0,w.A)(function*(){if(n.controllerId!==e)return;let s=fe.Z.deserialize(new Uint8Array(o));if(n._shouldLog&&console.log("received background tokenization result",{fileName:n._model.uri.fsPath.split("\\").pop(),updatedTokenLines:s.map(c=>c.getLineRange()).join(" & "),updatedStateLines:i.map(c=>new Ve.M(c.startLineNumber,c.startLineNumber+c.stateDeltas.length).toString()).join(" & ")}),n._shouldLog){const c=n._pendingChanges.filter(a=>a.versionId<=t).map(a=>a.changes).map(a=>ie(a)).join(" then ");console.log("Applying changes to local states",c)}for(;n._pendingChanges.length>0&&n._pendingChanges[0].versionId<=t;){const c=n._pendingChanges.shift();n._states.acceptChanges(c.changes)}if(n._pendingChanges.length>0){if(n._shouldLog){const g=n._pendingChanges.map(m=>m.changes).map(m=>ie(m)).join(" then ");console.log("Considering non-processed changes",g)}const c=B.fromMany(n._pendingChanges.map(g=>me(g.changes))),a=new fe.Z;for(const g of s)for(let m=g.startLineNumber;m<=g.endLineNumber;m++)void 0!==c.transform(m-1)&&a.add(m,g.getLineTokens(m));s=a.finalize();for(const g of n._pendingChanges)for(const m of g.changes)for(let k=0;k<s.length;k++)s[k].applyEdit(m.range,m.text)}const d=B.fromMany(n._pendingChanges.map(c=>me(c.changes)));if(!n._applyStateStackDiffFn||!n._initialState){const{applyStateStackDiff:c,INITIAL:a}=yield l.e(704).then(l.t.bind(l,50704,19)).then(g=>g.default??g);n._applyStateStackDiffFn=c,n._initialState=a}for(const c of i){let a=c.startLineNumber<=1?n._initialState:n._states.getEndState(c.startLineNumber-1);for(let g=0;g<c.stateDeltas.length;g++){const m=c.stateDeltas[g];let k;m?(k=n._applyStateStackDiffFn(a,m),n._states.setEndState(c.startLineNumber+g,k)):k=n._states.getEndState(c.startLineNumber+g);const L=d.transform(c.startLineNumber+g-1);void 0!==L&&n._backgroundTokenizationStore.setEndState(L+1,k),c.startLineNumber+g>=n._model.getLineCount()-1&&n._backgroundTokenizationStore.backgroundTokenizationFinished(),a=k}}n._backgroundTokenizationStore.setTokens(s)})()}get _shouldLog(){return this._loggingEnabled.get()}}return h})();function me(h){return new We(h.map(r=>new He(r.range.startLineNumber-1,r.range.endLineNumber-r.range.startLineNumber+1,(0,Ge.W)(r.text)[0]+1)))}function ie(h){return h.map(r=>oe.Q.lift(r.range).toString()+" => "+r.text).join(" & ")}var G,Ye=l(35650);let re=class{static{G=this}static{this._reportedMismatchingTokens=!1}constructor(e,t,o,i,n,s,d){this._reportTokenizationTime=e,this._shouldTokenizeAsync=t,this._extensionResourceLoaderService=o,this._configurationService=i,this._languageService=n,this._notificationService=s,this._telemetryService=d,this._workerProxyPromise=null,this._worker=null,this._workerProxy=null,this._workerTokenizerControllers=new Map,this._currentTheme=null,this._currentTokenColorMap=null,this._grammarDefinitions=[]}dispose(){this._disposeWorker()}createBackgroundTokenizer(e,t,o){var i=this;if(!this._shouldTokenizeAsync()||e.isTooLargeForSyncing())return;const n=new _.Cm,s=this._getWorkerProxy().then(d=>{if(n.isDisposed||!d)return;const c={controller:void 0,worker:this._worker};return n.add(function Ze(h,r){const e=new _.Cm,t=e.add(new _.Cm);function o(){h.isAttachedToEditor()?t.add(r()):t.clear()}return o(),e.add(h.onDidChangeAttached(()=>{o()})),e}(e,()=>{const a=new Je(e,d,this._languageService.languageIdCodec,t,this._configurationService,o);return c.controller=a,this._workerTokenizerControllers.set(a.controllerId,a),(0,_.s)(()=>{c.controller=void 0,this._workerTokenizerControllers.delete(a.controllerId),a.dispose()})})),c});return{dispose(){n.dispose()},requestTokens:(d=(0,w.A)(function*(c,a){const g=yield s;g?.controller&&g.worker===i._worker&&g.controller.requestTokens(c,a)}),function(a,g){return d.apply(this,arguments)}),reportMismatchingTokens:d=>{G._reportedMismatchingTokens||(G._reportedMismatchingTokens=!0,this._notificationService.error({message:"Async Tokenization Token Mismatch in line "+d,name:"Async Tokenization Token Mismatch"}),this._telemetryService.publicLog2("asyncTokenizationMismatchingTokens",{}))}};var d}setGrammarDefinitions(e){this._grammarDefinitions=e,this._disposeWorker()}acceptTheme(e,t){this._currentTheme=e,this._currentTokenColorMap=t,this._currentTheme&&this._currentTokenColorMap&&this._workerProxy&&this._workerProxy.$acceptTheme(this._currentTheme,this._currentTokenColorMap)}_getWorkerProxy(){return this._workerProxyPromise||(this._workerProxyPromise=this._createWorkerProxy()),this._workerProxyPromise}_createWorkerProxy(){var e=this;return(0,w.A)(function*(){const t={grammarDefinitions:e._grammarDefinitions,onigurumaWASMUri:new URL(l(6670),l.b).href},o=e._worker=(0,Ye.V3)("vs/workbench/services/textMate/browser/backgroundTokenization/worker/textMateTokenizationWorker.worker","TextMateWorker");return Be.setChannel(o,{$readFile:(i=(0,w.A)(function*(n){const s=Re.rz.revive(n);return e._extensionResourceLoaderService.readExtensionResource(s)}),function(s){return i.apply(this,arguments)}),$setTokensAndStates:function(){var i=(0,w.A)(function*(n,s,d,c){const a=e._workerTokenizerControllers.get(n);a&&a.setTokensAndStates(n,s,d,c)});return function(s,d,c,a){return i.apply(this,arguments)}}(),$reportTokenizationTime:(i,n,s,d,c)=>{e._reportTokenizationTime(i,n,s,d,c)}}),yield o.proxy.$init(t),e._worker!==o?null:(e._workerProxy=o.proxy,e._currentTheme&&e._currentTokenColorMap&&e._workerProxy.$acceptTheme(e._currentTheme,e._currentTokenColorMap),o.proxy);var i})()}_disposeWorker(){for(const e of this._workerTokenizerControllers.values())e.dispose();this._workerTokenizerControllers.clear(),this._worker&&(this._worker.dispose(),this._worker=null),this._workerProxy=null,this._workerProxyPromise=null}};re=G=(0,p.C)([(0,p.Q)(2,ge.j),(0,p.Q)(3,te.p),(0,p.Q)(4,ee.L),(0,p.Q)(5,ne.O),(0,p.Q)(6,he.k)],re);class Ke{constructor(){this._scopeNameToLanguageRegistration=Object.create(null)}reset(){this._scopeNameToLanguageRegistration=Object.create(null)}register(r){this._scopeNameToLanguageRegistration[r.scopeName]=r}getGrammarDefinition(r){return this._scopeNameToLanguageRegistration[r]||null}}const V="No TM Grammar registered for this language.";class Xe extends _.jG{constructor(r,e,t,o){var i,n;super(),i=this,this._host=r,this._initialState=t.INITIAL,this._scopeRegistry=new Ke,this._injections={},this._injectedEmbeddedLanguages={},this._languageToScope=new Map,this._grammarRegistry=this._register(new t.Registry({onigLib:o,loadGrammar:(n=(0,w.A)(function*(s){const d=i._scopeRegistry.getGrammarDefinition(s);if(!d)return i._host.logTrace(`No grammar found for scope ${s}`),null;const c=d.location;try{const a=yield i._host.readFile(c);return t.parseRawGrammar(a,c.path)}catch(a){return i._host.logError(`Unable to load and parse grammar for scope ${s} from ${c}`,a),null}}),function(d){return n.apply(this,arguments)}),getInjections:n=>{const s=n.split(".");let d=[];for(let c=1;c<=s.length;c++){const a=s.slice(0,c).join(".");d=[...d,...this._injections[a]||[]]}return d}}));for(const n of e){if(this._scopeRegistry.register(n),n.injectTo){for(const s of n.injectTo){let d=this._injections[s];d||(this._injections[s]=d=[]),d.push(n.scopeName)}if(n.embeddedLanguages)for(const s of n.injectTo){let d=this._injectedEmbeddedLanguages[s];d||(this._injectedEmbeddedLanguages[s]=d=[]),d.push(n.embeddedLanguages)}}n.language&&this._languageToScope.set(n.language,n.scopeName)}}has(r){return this._languageToScope.has(r)}setTheme(r,e){this._grammarRegistry.setTheme(r,e)}getColorMap(){return this._grammarRegistry.getColorMap()}createGrammar(r,e){var t=this;return(0,w.A)(function*(){const o=t._languageToScope.get(r);if("string"!=typeof o)throw new Error(V);const i=t._scopeRegistry.getGrammarDefinition(o);if(!i)throw new Error(V);const n=i.embeddedLanguages;if(t._injectedEmbeddedLanguages[o]){const c=t._injectedEmbeddedLanguages[o];for(const a of c)for(const g of Object.keys(a))n[g]=a[g]}const s=Object.keys(n).length>0;let d;try{d=yield t._grammarRegistry.loadGrammarWithConfiguration(o,e,{embeddedLanguages:n,tokenTypes:i.tokenTypes,balancedBracketSelectors:i.balancedBracketSelectors,unbalancedBracketSelectors:i.unbalancedBracketSelectors})}catch(c){throw c.message&&c.message.startsWith("No grammar provided for")?new Error(V):c}return{languageId:r,grammar:d,initialState:t._initialState,containsEmbeddedLanguages:s,sourceExtensionId:i.sourceExtensionId}})()}}var $=l(98604),qe=l(33561);const M=$.g1.registerExtensionPoint({extensionPoint:"grammars",deps:[qe.b],jsonSchema:{description:(0,f.kg)(11990,"Contributes textmate tokenizers."),type:"array",defaultSnippets:[{body:[{language:"${1:id}",scopeName:"source.${2:id}",path:"./syntaxes/${3:id}.tmLanguage."}]}],items:{type:"object",defaultSnippets:[{body:{language:"${1:id}",scopeName:"source.${2:id}",path:"./syntaxes/${3:id}.tmLanguage."}}],properties:{language:{description:(0,f.kg)(11991,"Language identifier for which this syntax is contributed to."),type:"string"},scopeName:{description:(0,f.kg)(11992,"Textmate scope name used by the tmLanguage file."),type:"string"},path:{description:(0,f.kg)(11993,"Path of the tmLanguage file. The path is relative to the extension folder and typically starts with './syntaxes/'."),type:"string"},embeddedLanguages:{description:(0,f.kg)(11994,"A map of scope name to language id if this grammar contains embedded languages."),type:"object"},tokenTypes:{description:(0,f.kg)(11995,"A map of scope name to token types."),type:"object",additionalProperties:{enum:["string","comment","other"]}},injectTo:{description:(0,f.kg)(11996,"List of language scope names to which this grammar is injected to."),type:"array",items:{type:"string"}},balancedBracketScopes:{description:(0,f.kg)(11997,"Defines which scope names contain balanced brackets."),type:"array",items:{type:"string"},default:["*"]},unbalancedBracketScopes:{description:(0,f.kg)(11998,"Defines which scope names do not contain balanced brackets."),type:"array",items:{type:"string"},default:[]}},required:["scopeName","path"]}}});var A,pe=l(78017);let se=class extends _.jG{static{A=this}static{this.reportTokenizationTimeCounter={sync:0,async:0}}constructor(e,t,o,i,n,s,d,c,a,g){super(),this._languageService=e,this._themeService=t,this._extensionResourceLoaderService=o,this._notificationService=i,this._logService=n,this._configurationService=s,this._progressService=d,this._environmentService=c,this._instantiationService=a,this._telemetryService=g,this._createdModes=[],this._encounteredLanguages=[],this._debugMode=!1,this._debugModePrintFunc=()=>{},this._grammarDefinitions=null,this._grammarFactory=null,this._tokenizersRegistrations=new _.Cm,this._currentTheme=null,this._currentTokenColorMap=null,this._threadedBackgroundTokenizerFactory=this._instantiationService.createInstance(re,(m,k,L,x,b)=>this._reportTokenizationTime(m,k,L,x,!0,b),()=>this.getAsyncTokenizationEnabled()),this._vscodeOniguruma=null,this._styleElement=(0,Le.li)(),this._styleElement.className="vscode-tokens-styles",M.setHandler(m=>this._handleGrammarsExtPoint(m)),this._updateTheme(this._themeService.getColorTheme(),!0),this._register(this._themeService.onDidColorThemeChange(()=>{this._updateTheme(this._themeService.getColorTheme(),!1)})),this._register(this._languageService.onDidRequestRichLanguageFeatures(m=>{this._createdModes.push(m)}))}getAsyncTokenizationEnabled(){return!!this._configurationService.getValue("editor.experimental.asyncTokenization")}getAsyncTokenizationVerification(){return!!this._configurationService.getValue("editor.experimental.asyncTokenizationVerification")}_handleGrammarsExtPoint(e){this._grammarDefinitions=null,this._grammarFactory&&(this._grammarFactory.dispose(),this._grammarFactory=null),this._tokenizersRegistrations.clear(),this._grammarDefinitions=[];for(const t of e){const o=t.value;for(const i of o){const n=this._validateGrammarDefinition(t,i);if(n&&(this._grammarDefinitions.push(n),n.language)){const s=new I.v_(()=>this._createTokenizationSupport(n.language));this._tokenizersRegistrations.add(s),this._tokenizersRegistrations.add(I.dG.registerFactory(n.language,s))}}}this._threadedBackgroundTokenizerFactory.setGrammarDefinitions(this._grammarDefinitions);for(const t of this._createdModes)I.dG.getOrCreate(t)}_validateGrammarDefinition(e,t){if(!function nt(h,r,e,t){if(r.language&&("string"!=typeof r.language||!t.isRegisteredLanguageId(r.language)))return e.error((0,f.kg)(11983,"Unknown language in `contributes.{0}.language`. Provided value: {1}",M.name,String(r.language))),!1;if(!r.scopeName||"string"!=typeof r.scopeName)return e.error((0,f.kg)(11984,"Expected string in `contributes.{0}.scopeName`. Provided value: {1}",M.name,String(r.scopeName))),!1;if(!r.path||"string"!=typeof r.path)return e.error((0,f.kg)(11985,"Expected string in `contributes.{0}.path`. Provided value: {1}",M.name,String(r.path))),!1;if(r.injectTo&&(!Array.isArray(r.injectTo)||r.injectTo.some(i=>"string"!=typeof i)))return e.error((0,f.kg)(11986,"Invalid value in `contributes.{0}.injectTo`. Must be an array of language scope names. Provided value: {1}",M.name,JSON.stringify(r.injectTo))),!1;if(r.embeddedLanguages&&!(0,le.Gv)(r.embeddedLanguages))return e.error((0,f.kg)(11987,"Invalid value in `contributes.{0}.embeddedLanguages`. Must be an object map from scope name to language. Provided value: {1}",M.name,JSON.stringify(r.embeddedLanguages))),!1;if(r.tokenTypes&&!(0,le.Gv)(r.tokenTypes))return e.error((0,f.kg)(11988,"Invalid value in `contributes.{0}.tokenTypes`. Must be an object map from scope name to token type. Provided value: {1}",M.name,JSON.stringify(r.tokenTypes))),!1;const o=(0,q.uJ)(h,r.path);return(0,q._1)(o,h)||e.warn((0,f.kg)(11989,"Expected `contributes.{0}.path` ({1}) to be included inside extension's folder ({2}). This might make the extension non-portable.",M.name,o.path,h.path)),!0}(e.description.extensionLocation,t,e.collector,this._languageService))return null;const o=(0,q.uJ)(e.description.extensionLocation,t.path),i=Object.create(null);if(t.embeddedLanguages){const c=Object.keys(t.embeddedLanguages);for(let a=0,g=c.length;a<g;a++){const m=c[a],k=t.embeddedLanguages[m];"string"==typeof k&&this._languageService.isRegisteredLanguageId(k)&&(i[m]=this._languageService.languageIdCodec.encodeLanguageId(k))}}const n=Object.create(null);if(t.tokenTypes){const c=Object.keys(t.tokenTypes);for(const a of c)switch(t.tokenTypes[a]){case"string":n[a]=T.Vy.String;break;case"other":n[a]=T.Vy.Other;break;case"comment":n[a]=T.Vy.Comment}}function d(c,a){return Array.isArray(c)&&c.every(g=>"string"==typeof g)?c:a}return{location:o,language:t.language&&this._languageService.isRegisteredLanguageId(t.language)?t.language:void 0,scopeName:t.scopeName,embeddedLanguages:i,tokenTypes:n,injectTo:t.injectTo,balancedBracketSelectors:d(t.balancedBracketScopes,["*"]),unbalancedBracketSelectors:d(t.unbalancedBracketScopes,[]),sourceExtensionId:e.description.id}}startDebugMode(e,t){this._debugMode?this._notificationService.error((0,f.kg)(11979,"Already Logging.")):(this._debugModePrintFunc=e,this._debugMode=!0,this._debugMode&&this._progressService.withProgress({location:Pe.Nq.Notification,buttons:[(0,f.kg)(11980,"Stop")]},o=>(o.report({message:(0,f.kg)(11981,"Preparing to log TM Grammar parsing. Press Stop when finished.")}),this._getVSCodeOniguruma().then(i=>(i.setDefaultDebugCall(!0),o.report({message:(0,f.kg)(11982,"Now logging TM Grammar parsing. Press Stop when finished.")}),new Promise((n,s)=>{})))),o=>{this._getVSCodeOniguruma().then(i=>{this._debugModePrintFunc=()=>{},this._debugMode=!1,i.setDefaultDebugCall(!1),t()})}))}_canCreateGrammarFactory(){return!!this._grammarDefinitions}_getOrCreateGrammarFactory(){var e=this;return(0,w.A)(function*(){if(e._grammarFactory)return e._grammarFactory;const[t,o]=yield Promise.all([l.e(704).then(l.t.bind(l,50704,19)).then(n=>n.default??n),e._getVSCodeOniguruma()]),i=Promise.resolve({createOnigScanner:n=>o.createOnigScanner(n),createOnigString:n=>o.createOnigString(n)});return e._grammarFactory||(e._grammarFactory=new Xe({logTrace:n=>e._logService.trace(n),logError:(n,s)=>e._logService.error(n,s),readFile:n=>e._extensionResourceLoaderService.readExtensionResource(n)},e._grammarDefinitions||[],t,i),e._updateTheme(e._themeService.getColorTheme(),!0)),e._grammarFactory})()}_createTokenizationSupport(e){var t=this;return(0,w.A)(function*(){if(!t._languageService.isRegisteredLanguageId(e)||!t._canCreateGrammarFactory())return null;try{const o=yield t._getOrCreateGrammarFactory();if(!o.has(e))return null;const i=t._languageService.languageIdCodec.encodeLanguageId(e),n=yield o.createGrammar(e,i);if(!n.grammar)return null;const s=function ot(h,r,e,t){return(0,X.y0)(o=>t.onDidChangeConfiguration(i=>{i.affectsConfiguration(h,{overrideIdentifier:r})&&o(i)}),()=>t.getValue(h,{overrideIdentifier:r})??e)}("editor.maxTokenizationLineLength",e,-1,t._configurationService),d=new je(n.grammar,n.initialState,n.containsEmbeddedLanguages,(a,g)=>t._threadedBackgroundTokenizerFactory.createBackgroundTokenizer(a,g,s),()=>t.getAsyncTokenizationVerification(),(a,g,m)=>{t._reportTokenizationTime(a,e,n.sourceExtensionId,g,!1,m)},!0),c=d.onDidEncounterLanguage(a=>{if(!t._encounteredLanguages[a]){const g=t._languageService.languageIdCodec.decodeLanguageId(a);t._encounteredLanguages[a]=!0,t._languageService.requestBasicLanguageFeatures(g)}});return new Fe(i,d,c,s)}catch(o){return o.message&&o.message===V||(0,we.dz)(o),null}})()}_updateTheme(e,t){if(!t&&this._currentTheme&&this._currentTokenColorMap&&function tt(h,r){if(!r||!h||r.length!==h.length)return!1;for(let e=r.length-1;e>=0;e--){const t=r[e],o=h[e];if(t.scope!==o.scope)return!1;const i=t.settings,n=o.settings;if(i&&n){if(i.fontStyle!==n.fontStyle||i.foreground!==n.foreground||i.background!==n.background)return!1}else if(!i||!n)return!1}return!0}(this._currentTheme.settings,e.tokenColors)&&(0,Z.aI)(this._currentTokenColorMap,e.tokenColorMap))return;this._currentTheme={name:e.label,settings:e.tokenColors},this._currentTokenColorMap=e.tokenColorMap,this._grammarFactory?.setTheme(this._currentTheme,this._currentTokenColorMap);const o=function et(h){const r=[null];for(let e=1,t=h.length;e<t;e++)r[e]=R.Q1.fromHex(h[e]);return r}(this._currentTokenColorMap),i=(0,Ee.nh)(o);this._styleElement.textContent=i,I.dG.setColorMap(o),this._currentTheme&&this._currentTokenColorMap&&this._threadedBackgroundTokenizerFactory.acceptTheme(this._currentTheme,this._currentTokenColorMap)}createTokenizer(e){var t=this;return(0,w.A)(function*(){if(!t._languageService.isRegisteredLanguageId(e))return null;const o=yield t._getOrCreateGrammarFactory();if(!o.has(e))return null;const i=t._languageService.languageIdCodec.encodeLanguageId(e),{grammar:n}=yield o.createGrammar(e,i);return n})()}_getVSCodeOniguruma(){var e=this;return this._vscodeOniguruma||(this._vscodeOniguruma=(0,w.A)(function*(){const[t,o]=yield Promise.all([l.e(577).then(l.t.bind(l,15577,19)).then(i=>i.default??i),e._loadVSCodeOnigurumaWASM()]);return yield t.loadWASM({data:o,print:i=>{e._debugModePrintFunc(i)}}),t})()),this._vscodeOniguruma}_loadVSCodeOnigurumaWASM(){return(0,w.A)(function*(){return Me.HZ?yield(yield fetch(new URL(l(6670),l.b).href)).arrayBuffer():yield fetch(K.zl.asBrowserUri(`${K.dy}/vscode-oniguruma/release/onig.wasm`).toString(!0))})()}_reportTokenizationTime(e,t,o,i,n,s){const d=n?"async":"sync";A.reportTokenizationTimeCounter[d]>50||(0===A.reportTokenizationTimeCounter[d]&&setTimeout(()=>{A.reportTokenizationTimeCounter[d]=0},36e5),A.reportTokenizationTimeCounter[d]++,this._telemetryService.publicLog2("editor.tokenizedLine",{timeMs:e,languageId:t,lineLength:i,fromWorker:n,sourceExtensionId:o,isRandomSample:s,tokenizationSetting:this.getAsyncTokenizationEnabled()?this.getAsyncTokenizationVerification()?2:1:0}))}};se=A=(0,p.C)([(0,p.Q)(0,ee.L),(0,p.Q)(1,pe.t),(0,p.Q)(2,ge.j),(0,p.Q)(3,ne.O),(0,p.Q)(4,Ie.r),(0,p.Q)(5,te.p),(0,p.Q)(6,Ae.G),(0,p.Q)(7,Ne.P),(0,p.Q)(8,ue._Y),(0,p.Q)(9,he.k)],se);var it=l(63630),rt=l(25207),st=l(31360),at=l(97026),P=l(85195),ke=l(29647);const E=(0,P.FZ)(),ct=$.g1.registerExtensionPoint({extensionPoint:"semanticTokenTypes",jsonSchema:{description:(0,f.kg)(12186,"Contributes semantic token types."),type:"array",items:{type:"object",properties:{id:{type:"string",description:(0,f.kg)(12187,"The identifier of the semantic token type"),pattern:P.GE,patternErrorMessage:(0,f.kg)(12188,"Identifiers should be in the form letterOrDigit[_-letterOrDigit]*")},superType:{type:"string",description:(0,f.kg)(12189,"The super type of the semantic token type"),pattern:P.GE,patternErrorMessage:(0,f.kg)(12190,"Super types should be in the form letterOrDigit[_-letterOrDigit]*")},description:{type:"string",description:(0,f.kg)(12191,"The description of the semantic token type")}}}}}),dt=$.g1.registerExtensionPoint({extensionPoint:"semanticTokenModifiers",jsonSchema:{description:(0,f.kg)(12192,"Contributes semantic token modifiers."),type:"array",items:{type:"object",properties:{id:{type:"string",description:(0,f.kg)(12193,"The identifier of the semantic token modifier"),pattern:P.GE,patternErrorMessage:(0,f.kg)(12194,"Identifiers should be in the form letterOrDigit[_-letterOrDigit]*")},description:{type:"string",description:(0,f.kg)(12195,"The description of the semantic token modifier")}}}}}),lt=$.g1.registerExtensionPoint({extensionPoint:"semanticTokenScopes",jsonSchema:{description:(0,f.kg)(12196,"Contributes semantic token scope maps."),type:"array",items:{type:"object",properties:{language:{description:(0,f.kg)(12197,"Lists the languge for which the defaults are."),type:"string"},scopes:{description:(0,f.kg)(12198,"Maps a semantic token (described by semantic token selector) to one or more textMate scopes used to represent that token."),type:"object",additionalProperties:{type:"array",items:{type:"string"}}}}}}});class gt{constructor(){function r(e,t,o){if("string"!=typeof e.id||0===e.id.length)return o.error((0,f.kg)(12199,"'configuration.{0}.id' must be defined and can not be empty",t)),!1;if(!e.id.match(P.GE))return o.error((0,f.kg)(12200,"'configuration.{0}.id' must follow the pattern letterOrDigit[-_letterOrDigit]*",t)),!1;const i=e.superType;return i&&!i.match(P.GE)?(o.error((0,f.kg)(12201,"'configuration.{0}.superType' must follow the pattern letterOrDigit[-_letterOrDigit]*",t)),!1):"string"==typeof e.description&&0!==e.id.length||(o.error((0,f.kg)(12202,"'configuration.{0}.description' must be defined and can not be empty",t)),!1)}ct.setHandler((e,t)=>{for(const o of t.added){const i=o.value,n=o.collector;if(!i||!Array.isArray(i))return void n.error((0,f.kg)(12203,"'configuration.semanticTokenType' must be an array"));for(const s of i)r(s,"semanticTokenType",n)&&E.registerTokenType(s.id,s.description,s.superType)}for(const o of t.removed){const i=o.value;for(const n of i)E.deregisterTokenType(n.id)}}),dt.setHandler((e,t)=>{for(const o of t.added){const i=o.value,n=o.collector;if(!i||!Array.isArray(i))return void n.error((0,f.kg)(12204,"'configuration.semanticTokenModifier' must be an array"));for(const s of i)r(s,"semanticTokenModifier",n)&&E.registerTokenModifier(s.id,s.description)}for(const o of t.removed){const i=o.value;for(const n of i)E.deregisterTokenModifier(n.id)}}),lt.setHandler((e,t)=>{for(const o of t.added){const i=o.value,n=o.collector;if(!i||!Array.isArray(i))return void n.error((0,f.kg)(12205,"'configuration.semanticTokenScopes' must be an array"));for(const s of i)if(s.language&&"string"!=typeof s.language)n.error((0,f.kg)(12206,"'configuration.semanticTokenScopes.language' must be a string"));else if(s.scopes&&"object"==typeof s.scopes)for(const d in s.scopes){const c=s.scopes[d];if(Array.isArray(c)&&!c.some(a=>"string"!=typeof a))try{const a=E.parseTokenSelector(d,s.language);E.registerTokenStyleDefault(a,{scopesToProbe:c.map(g=>g.split(" "))})}catch{n.error((0,f.kg)(12209,"configuration.semanticTokenScopes.scopes': Problems parsing selector {0}.",d))}else n.error((0,f.kg)(12208,"'configuration.semanticTokenScopes.scopes' values must be an array of strings"))}else n.error((0,f.kg)(12207,"'configuration.semanticTokenScopes.scopes' must be defined as an object"))}for(const o of t.removed){const i=o.value;for(const n of i)for(const s in n.scopes){const d=n.scopes[s];try{const c=E.parseTokenSelector(s,n.language);E.registerTokenStyleDefault(c,{scopesToProbe:d.map(a=>a.split(" "))})}catch{}}}})}}let Q=class{static{this.ID="workbench.contrib.tokenClassificationExtensionPoint"}constructor(r){this.instantiationService=r,this.instantiationService.createInstance(gt)}};Q=(0,p.C)([(0,p.Q)(0,ue._Y)],Q),(0,ke.tr)(Q.ID,Q,ke.lw.BlockStartup),(0,l(1769).A)(".token-inspect-widget{border:1px solid var(--vscode-editorHoverWidget-border);padding:10px;user-select:text;-webkit-user-select:text;z-index:50}.hc-black .tokens-inspect-widget,.hc-light .tokens-inspect-widget{border-width:2px}.monaco-editor .token-inspect-widget{background-color:var(--vscode-editorHoverWidget-background)}.monaco-editor .token-inspect-widget .tiw-metadata-separator{background-color:var(--vscode-editorHoverWidget-border)}.tiw-token{font-family:var(--monaco-monospace-font)}.tiw-metadata-separator{border:0;height:1px}.tiw-token-length{float:right;font-size:60%;font-weight:400}.tiw-metadata-table{width:100%}.tiw-metadata-value{font-family:var(--monaco-monospace-font);word-break:break-word}.tiw-metadata-values{list-style:none;margin-right:-10px;max-height:300px;overflow-y:auto;padding-left:0}.tiw-metadata-values>.tiw-metadata-value{margin-right:10px}.tiw-metadata-key{min-width:150px;padding-right:10px;vertical-align:top;white-space:nowrap;width:1px}.tiw-metadata-semantic{font-style:italic}.tiw-metadata-scopes{line-height:normal}.tiw-theme-selector{font-family:var(--monaco-monospace-font)}",{});var y=l(64613),ye=l(3061),ft=l(13211),Te=l(21030),W=l(93034);function pt(h,r,e,t){let o=null;for(let i=h.tokenColors.length-1;i>=0;i--){const n=h.tokenColors[i];if(t&&!n.settings.foreground)continue;let s;if("string"==typeof n.scope)s=n.scope.split(/,/).map(d=>d.trim());else{if(!Array.isArray(n.scope))continue;s=n.scope}for(let d=0,c=s.length;d<c;d++){const g=new H(s[d],n.settings);g.matches(r,e)&&g.isMoreSpecific(o)&&(o=g)}}return o}class H{constructor(r,e){this.rawSelector=r,this.settings=e;const t=this.rawSelector.split(/ /);this.scope=t[t.length-1],this.parentScopes=t.slice(0,t.length-1)}matches(r,e){return H._matches(this.scope,this.parentScopes,r,e)}static _cmp(r,e){if(null===r&&null===e)return 0;if(null===r)return-1;if(null===e)return 1;if(r.scope.length!==e.scope.length)return r.scope.length-e.scope.length;const t=r.parentScopes.length,o=e.parentScopes.length;if(t!==o)return t-o;for(let i=0;i<t;i++){const n=r.parentScopes[i].length,s=e.parentScopes[i].length;if(n!==s)return n-s}return 0}isMoreSpecific(r){return H._cmp(this,r)>0}static _matchesOne(r,e){const t=r+".";return r===e||e.substring(0,t.length)===t}static _matches(r,e,t,o){if(!this._matchesOne(r,t))return!1;let i=e.length-1,n=o.length-1;for(;i>=0&&n>=0;)this._matchesOne(e[i],o[n])&&i--,n--;return-1===i}}var ae,kt=l(15993),yt=l(85406),Tt=l(91168);const u=y.$;let N=class extends _.jG{static{ae=this}static{this.ID="editor.contrib.inspectEditorTokens"}static get(e){return e.getContribution(ae.ID)}constructor(e,t,o,i,n,s,d,c){super(),this._editor=e,this._textMateService=t,this._treeSitterService=o,this._themeService=n,this._languageService=i,this._notificationService=s,this._configurationService=d,this._languageFeaturesService=c,this._widget=null,this._register(this._editor.onDidChangeModel(a=>this.stop())),this._register(this._editor.onDidChangeModelLanguage(a=>this.stop())),this._register(this._editor.onKeyUp(a=>a.keyCode===ft.DD.Escape&&this.stop()))}dispose(){this.stop(),super.dispose()}launch(){this._widget||this._editor.hasModel()&&this._editor.getModel().uri.scheme!==K.ny.vscodeNotebookCell&&(this._widget=new St(this._editor,this._textMateService,this._treeSitterService,this._languageService,this._themeService,this._notificationService,this._configurationService,this._languageFeaturesService))}stop(){this._widget&&(this._widget.dispose(),this._widget=null)}toggle(){this._widget?this.stop():this.launch()}};function ve(h){h.length>40&&(h=h.substr(0,20)+"\u2026"+h.substr(h.length-20));let r="";for(let e=0,t=h.length;e<t;e++){const o=h.charCodeAt(e);switch(o){case ye.s.Tab:r+="\u2192";break;case ye.s.Space:r+="\xb7";break;default:r+=String.fromCharCode(o)}}return r}N=ae=(0,p.C)([(0,p.Q)(1,F.S),(0,p.Q)(2,Tt.j),(0,p.Q)(3,ee.L),(0,p.Q)(4,pe.t),(0,p.Q)(5,ne.O),(0,p.Q)(6,te.p),(0,p.Q)(7,yt.u)],N);let St=(()=>{class h extends _.jG{static{this._ID="editor.contrib.inspectEditorTokensWidget"}constructor(e,t,o,i,n,s,d,c){super(),this.allowEditorOverflow=!0,this._isDisposed=!1,this._editor=e,this._languageService=i,this._themeService=n,this._textMateService=t,this._treeSitterService=o,this._notificationService=s,this._configurationService=d,this._languageFeaturesService=c,this._model=this._editor.getModel(),this._domNode=document.createElement("div"),this._domNode.className="token-inspect-widget",this._currentRequestCancellationTokenSource=new ze.Qi,this._beginCompute(this._editor.getPosition()),this._register(this._editor.onDidChangeCursorPosition(a=>this._beginCompute(this._editor.getPosition()))),this._register(n.onDidColorThemeChange(a=>this._beginCompute(this._editor.getPosition()))),this._register(d.onDidChangeConfiguration(a=>a.affectsConfiguration("editor.semanticHighlighting.enabled")&&this._beginCompute(this._editor.getPosition()))),this._editor.addContentWidget(this)}dispose(){this._isDisposed=!0,this._editor.removeContentWidget(this),this._currentRequestCancellationTokenSource.cancel(),super.dispose()}getId(){return h._ID}_beginCompute(e){const t=this._textMateService.createTokenizer(this._model.getLanguageId()),o=this._computeSemanticTokens(e),i=this._treeSitterService.getParseResult(this._model);(0,y.w_)(this._domNode),this._domNode.appendChild(document.createTextNode((0,f.kg)(4837,"Loading..."))),Promise.all([t,o]).then(([n,s])=>{this._isDisposed||(this._compute(n,s,i?.tree,e),this._domNode.style.maxWidth=`${Math.max(.66*this._editor.getLayoutInfo().width,500)}px`,this._editor.layoutContentWidget(this))},n=>{this._notificationService.warn(n),setTimeout(()=>{N.get(this._editor)?.stop()})})}_isSemanticColoringEnabled(){const e=this._configurationService.getValue(kt.r,{overrideIdentifier:this._model.getLanguageId(),resource:this._model.uri})?.enabled;return"boolean"==typeof e?e:this._themeService.getColorTheme().semanticHighlighting}_compute(e,t,o,i){const n=e&&this._getTokensAtPosition(e,i),s=t&&this._getSemanticTokenAtPosition(t,i),d=o&&this._getTreeSitterTokenAtPosition(o,i);if(!n&&!s&&!d)return void(0,y.Ln)(this._domNode,"No grammar or semantic tokens available.");const c=n?.metadata,a=s?.metadata,g=s&&ve(this._model.getValueInRange(s.range)),m=n&&ve(this._model.getLineContent(i.lineNumber).substring(n.token.startIndex,n.token.endIndex)),k=g||m||"";if((0,y.Ln)(this._domNode,u("h2.tiw-token",void 0,k,u("span.tiw-token-length",void 0,`${k.length} ${1===k.length?"char":"chars"}`))),(0,y.BC)(this._domNode,u("hr.tiw-metadata-separator",{style:"clear:both"})),(0,y.BC)(this._domNode,u("table.tiw-metadata-table",void 0,u("tbody",void 0,u("tr",void 0,u("td.tiw-metadata-key",void 0,"language"),u("td.tiw-metadata-value",void 0,c?.languageId||"")),u("tr",void 0,u("td.tiw-metadata-key",void 0,"standard token type"),u("td.tiw-metadata-value",void 0,this._tokenTypeToString(c?.tokenType||T.Vy.Other))),...this._formatMetadata(a,c)))),s){(0,y.BC)(this._domNode,u("hr.tiw-metadata-separator"));const L=(0,y.BC)(this._domNode,u("table.tiw-metadata-table",void 0)),x=(0,y.BC)(L,u("tbody",void 0,u("tr",void 0,u("td.tiw-metadata-key",void 0,"semantic token type"),u("td.tiw-metadata-value",void 0,s.type))));if(s.modifiers.length&&(0,y.BC)(x,u("tr",void 0,u("td.tiw-metadata-key",void 0,"modifiers"),u("td.tiw-metadata-value",void 0,s.modifiers.join(" ")))),s.metadata){const b=["foreground","bold","italic","underline","strikethrough"],S={},z=new Array;for(const v of b)if(void 0!==s.metadata[v]){const U=this._renderTokenStyleDefinition(s.definitions[v],v),D=U.map(J=>(0,y.sb)(J)?J.outerHTML:J).join();let O=S[D];O||(S[D]=O=[],z.push([U,D])),O.push(v)}for(const[v,C]of z)(0,y.BC)(x,u("tr",void 0,u("td.tiw-metadata-key",void 0,S[C].join(", ")),u("td.tiw-metadata-value",void 0,...v)))}}if(n){const L=this._themeService.getColorTheme();(0,y.BC)(this._domNode,u("hr.tiw-metadata-separator"));const x=(0,y.BC)(this._domNode,u("table.tiw-metadata-table")),b=(0,y.BC)(x,u("tbody"));m&&m!==k&&(0,y.BC)(b,u("tr",void 0,u("td.tiw-metadata-key",void 0,"textmate token"),u("td.tiw-metadata-value",void 0,`${m} (${m.length})`)));const S=new Array;for(let C=n.token.scopes.length-1;C>=0;C--)S.push(n.token.scopes[C]),C>0&&S.push(u("br"));(0,y.BC)(b,u("tr",void 0,u("td.tiw-metadata-key",void 0,"textmate scopes"),u("td.tiw-metadata-value.tiw-metadata-scopes",void 0,...S)));const z=function mt(h,r,e=!0){for(let t=r.length-1;t>=0;t--){const o=r.slice(0,t),n=pt(h,r[t],o,e);if(n)return n}return null}(L,n.token.scopes,!1),v=s?.metadata?.foreground;if(z){if(v!==n.metadata.foreground){let C=u("code.tiw-theme-selector",void 0,z.rawSelector,u("br"),JSON.stringify(z.settings,null,"\t"));v&&(C=u("s",void 0,C)),(0,y.BC)(b,u("tr",void 0,u("td.tiw-metadata-key",void 0,"foreground"),u("td.tiw-metadata-value",void 0,C)))}}else v||(0,y.BC)(b,u("tr",void 0,u("td.tiw-metadata-key",void 0,"foreground"),u("td.tiw-metadata-value",void 0,"No theme selector")))}if(d){(0,y.BC)(this._domNode,u("hr.tiw-metadata-separator"));const L=(0,y.BC)(this._domNode,u("table.tiw-metadata-table")),x=(0,y.BC)(L,u("tbody"));(0,y.BC)(x,u("tr",void 0,u("td.tiw-metadata-key",void 0,`tree-sitter token ${d.id}`),u("td.tiw-metadata-value",void 0,`${d.text}`)));const b=new Array;let S=d;for(;S.parent;)b.push(S.type),S=S.parent,S&&b.push(u("br"));(0,y.BC)(x,u("tr",void 0,u("td.tiw-metadata-key",void 0,"tree-sitter scopes"),u("td.tiw-metadata-value.tiw-metadata-scopes",void 0,...b)));const v=I.OB.get(this._model.getLanguageId())?.captureAtPosition(i.lineNumber,i.column,this._model);v&&v.length>0&&(0,y.BC)(x,u("tr",void 0,u("td.tiw-metadata-key",void 0,"foreground"),u("td.tiw-metadata-value",void 0,v[v.length-1].name)))}}_formatMetadata(e,t){const o=new Array;function i(a){const g=e?.[a]||t?.[a];if(void 0!==g){const m=e?.[a]?"tiw-metadata-semantic":"";o.push(u("tr",void 0,u("td.tiw-metadata-key",void 0,a),u(`td.tiw-metadata-value.${m}`,void 0,g)))}return g}const n=i("foreground"),s=i("background");if(n&&s){const a=R.Q1.fromHex(s),g=R.Q1.fromHex(n);a.isOpaque()?o.push(u("tr",void 0,u("td.tiw-metadata-key",void 0,"contrast ratio"),u("td.tiw-metadata-value",void 0,a.getContrastRatio(g.makeOpaque(a)).toFixed(2)))):o.push(u("tr",void 0,u("td.tiw-metadata-key",void 0,"Contrast ratio cannot be precise for background colors that use transparency"),u("td.tiw-metadata-value")))}const d=new Array;function c(a){let g;e&&e[a]?g=u("span.tiw-metadata-semantic",void 0,a):t&&t[a]&&(g=a),g&&(d.length&&d.push(" "),d.push(g))}return c("bold"),c("italic"),c("underline"),c("strikethrough"),d.length&&o.push(u("tr",void 0,u("td.tiw-metadata-key",void 0,"font style"),u("td.tiw-metadata-value",void 0,...d))),o}_decodeMetadata(e){const t=this._themeService.getColorTheme().tokenColorMap,o=T.xn.getLanguageId(e),i=T.xn.getTokenType(e),n=T.xn.getFontStyle(e),s=T.xn.getForeground(e),d=T.xn.getBackground(e);return{languageId:this._languageService.languageIdCodec.decodeLanguageId(o),tokenType:i,bold:!!(n&T.zz.Bold)||void 0,italic:!!(n&T.zz.Italic)||void 0,underline:!!(n&T.zz.Underline)||void 0,strikethrough:!!(n&T.zz.Strikethrough)||void 0,foreground:t[s],background:t[d]}}_tokenTypeToString(e){switch(e){case T.Vy.Other:return"Other";case T.Vy.Comment:return"Comment";case T.Vy.String:return"String";case T.Vy.RegEx:return"RegEx";default:return"??"}}_getTokensAtPosition(e,t){const o=t.lineNumber,i=this._getStateBeforeLine(e,o),n=e.tokenizeLine(this._model.getLineContent(o),i),s=e.tokenizeLine2(this._model.getLineContent(o),i);let d=0;for(let a=n.tokens.length-1;a>=0;a--)if(t.column-1>=n.tokens[a].startIndex){d=a;break}let c=0;for(let a=s.tokens.length>>>1;a>=0;a--)if(t.column-1>=s.tokens[a<<1]){c=a;break}return{token:n.tokens[d],metadata:this._decodeMetadata(s.tokens[1+(c<<1)])}}_getStateBeforeLine(e,t){let o=null;for(let i=1;i<t;i++)o=e.tokenizeLine(this._model.getLineContent(i),o).ruleStack;return o}isSemanticTokens(e){return e&&e.data}_computeSemanticTokens(e){var t=this;return(0,w.A)(function*(){if(!t._isSemanticColoringEnabled())return null;const o=t._languageFeaturesService.documentSemanticTokensProvider.ordered(t._model);if(o.length){const n=o[0],s=yield Promise.resolve(n.provideDocumentSemanticTokens(t._model,null,t._currentRequestCancellationTokenSource.token));if(t.isSemanticTokens(s))return{tokens:s,legend:n.getLegend()}}const i=t._languageFeaturesService.documentRangeSemanticTokensProvider.ordered(t._model);if(i.length){const n=i[0],s=e.lineNumber,d=new oe.Q(s,1,s,t._model.getLineMaxColumn(s)),c=yield Promise.resolve(n.provideDocumentRangeSemanticTokens(t._model,d,t._currentRequestCancellationTokenSource.token));if(t.isSemanticTokens(c))return{tokens:c,legend:n.getLegend()}}return null})()}_getSemanticTokenAtPosition(e,t){const o=e.tokens.data,i=this._model.getLanguageId();let n=0,s=0;const d=t.lineNumber-1,c=t.column-1;for(let a=0;a<o.length;a+=5){const g=o[a],m=o[a+1],k=o[a+2],b=n+g,S=0===g?s+m:m;if(d===b&&S<=c&&c<S+k){const z=e.legend.tokenTypes[o[a+3]]||"not in legend (ignored)",v=[];let C=o[a+4];for(let ce=0;C>0&&ce<e.legend.tokenModifiers.length;ce++)1&C&&v.push(e.legend.tokenModifiers[ce]),C>>=1;C>0&&v.push("not in legend (ignored)");const U=new oe.Q(b+1,S+1,b+1,S+1+k),D={},O=this._themeService.getColorTheme().tokenColorMap,j=this._themeService.getColorTheme().getTokenStyleMetadata(z,v,i,!0,D);let Se;return j&&(Se={languageId:void 0,tokenType:T.Vy.Other,bold:j?.bold,italic:j?.italic,underline:j?.underline,strikethrough:j?.strikethrough,foreground:O[j?.foreground||T.b1.None],background:void 0}),{type:z,modifiers:v,range:U,metadata:Se,definitions:D}}n=b,s=S}return null}_walkTreeforPosition(e,t){const o=this._model.getOffsetAt(t);e.gotoFirstChild();let i=!1,n=null;do{e.currentNode.startIndex<=o&&o<e.currentNode.endIndex?(i=!0,n=e.currentNode):i=!1}while(i?e.gotoFirstChild():e.gotoNextSibling());return n}_getTreeSitterTokenAtPosition(e,t){const o=e.walk();return this._walkTreeforPosition(o,t)}_renderTokenStyleDefinition(e,t){const o=new Array;if(void 0===e)return o;const i=this._themeService.getColorTheme();if(Array.isArray(e)){const n={};i.resolveScopes(e,n);const s=n[t];if(s&&n.scope){const d=u("ul.tiw-metadata-values"),c=Array.isArray(s.scope)?s.scope:[String(s.scope)];for(const a of c)d.appendChild(u("li.tiw-metadata-value.tiw-metadata-scopes",void 0,a));return o.push(n.scope.join(" "),d,u("code.tiw-theme-selector",void 0,JSON.stringify(s.settings,null,"\t"))),o}return o}if(P.yS.is(e)){const n=i.getTokenStylingRuleScope(e);return"setting"===n?(o.push(`User settings: ${e.selector.id} - ${this._renderStyleProperty(e.style,t)}`),o):("theme"===n&&o.push(`Color theme: ${e.selector.id} - ${this._renderStyleProperty(e.style,t)}`),o)}{const n=i.resolveTokenStyleValue(e);return o.push(`Default: ${n?this._renderStyleProperty(n,t):""}`),o}}_renderStyleProperty(e,t){return"foreground"===t?e.foreground?R.Q1.Format.CSS.formatHexA(e.foreground,!0):"":void 0!==e[t]?String(e[t]):""}getDomNode(){return this._domNode}getPosition(){return{position:this._editor.getPosition(),preference:[Te.Qj.BELOW,Te.Qj.ABOVE]}}}return h})();function Ct(){return{...(0,st.Ay)(),[F.S.toString()]:new be.d(se,[],!1)}}(0,W.HW)(N.ID,N,W.Hk.Lazy),(0,W.Fl)(class vt extends W.ks{constructor(){super({id:"editor.action.inspectTMScopes",label:(0,f.aS)(4836,"Developer: Inspect Editor Tokens and Scopes"),precondition:void 0})}run(r,e){N.get(e)?.toggle()}}),(0,at.GP)(function(){var h=(0,w.A)(function*(r){r.get(rt.f).when(it.k2.Ready).then(()=>{Ce.QE.get(F.S)})});return function(r){return h.apply(this,arguments)}}())}}]);