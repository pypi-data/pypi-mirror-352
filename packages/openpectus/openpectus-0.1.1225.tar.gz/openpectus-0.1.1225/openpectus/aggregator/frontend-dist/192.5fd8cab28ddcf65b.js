"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[192],{27895:(Q,V,r)=>{r.d(V,{x:()=>$});var U,D=r(10467),_=r(38035),R=r(98039),v=r(51627),B=r(38743),x=r(47513),g=r(70976),W=r(96459),K=r(18438),G=r(48738),I=r(48408),N=r(53899),M=r(5475),C=r(46341),A=r(84169),m=r(36376),S=r(19657),s=r(81856),l=r(52814),u=r(37106),f=r(21030),z=(r(79758),r(93319)),p=r(75864),L=r(57430),E=r(88039),P=r(51890);let Y=class extends l.jG{static{U=this}static{this.STORAGE_KEY="editors.mru"}get count(){return this.mostRecentEditorsMap.size}get editors(){return[...this.mostRecentEditorsMap.values()]}hasEditor(e){return this.editorsPerResourceCounter.get(e.resource)?.has(this.toIdentifier(e))??!1}hasEditors(e){return this.editorsPerResourceCounter.has(e)}toIdentifier(e,o){return"string"!=typeof e?this.toIdentifier(e.typeId,e.editorId):o?`${e}/${o}`:e}constructor(e,o,t){super(),this.editorGroupService=o,this.storageService=t,this.keyMap=new Map,this.mostRecentEditorsMap=new g.I4,this.editorsPerResourceCounter=new g.fT,this._onDidMostRecentlyActiveEditorsChange=this._register(new G.vl),this.onDidMostRecentlyActiveEditorsChange=this._onDidMostRecentlyActiveEditorsChange.event,this.editorGroupsContainer=e??o,this.isScoped=!!e,this.registerListeners(),this.loadState()}registerListeners(){this._register(this.editorGroupsContainer.onDidAddGroup(e=>this.onGroupAdded(e))),this._register(this.editorGroupService.onDidChangeEditorPartOptions(e=>this.onDidChangeEditorPartOptions(e))),this._register(this.storageService.onWillSaveState(()=>this.saveState()))}onGroupAdded(e){const o=e.getEditors(v.bS.MOST_RECENTLY_ACTIVE);for(let t=o.length-1;t>=0;t--)this.addMostRecentEditor(e,o[t],!1,!0);this.editorGroupsContainer.activeGroup===e&&e.activeEditor&&this.addMostRecentEditor(e,e.activeEditor,!0,!1),this.registerGroupListeners(e)}registerGroupListeners(e){const o=new l.Cm;o.add(e.onDidModelChange(t=>{switch(t.kind){case v.LO.GROUP_ACTIVE:this.editorGroupsContainer.activeGroup===e&&e.activeEditor&&this.addMostRecentEditor(e,e.activeEditor,!0,!1);break;case v.LO.EDITOR_OPEN:t.editor&&(this.addMostRecentEditor(e,t.editor,!1,!0),this.ensureOpenedEditorsLimit({groupId:e.id,editor:t.editor},e.id))}})),o.add(e.onDidCloseEditor(t=>{this.removeMostRecentEditor(e,t.editor)})),o.add(e.onDidActiveEditorChange(t=>{t.editor&&this.addMostRecentEditor(e,t.editor,this.editorGroupsContainer.activeGroup===e,!1)})),G.Jh.once(e.onWillDispose)(()=>(0,l.AS)(o))}onDidChangeEditorPartOptions(e){if(!(0,P.aI)(e.newPartOptions.limit,e.oldPartOptions.limit)){const o=this.editorGroupsContainer.activeGroup;let t;o.activeEditor&&(t={editor:o.activeEditor,groupId:o.id}),this.ensureOpenedEditorsLimit(t)}}addMostRecentEditor(e,o,t,d){const n=this.ensureKey(e,o),c=this.mostRecentEditorsMap.first;t||!c?this.mostRecentEditorsMap.set(n,n,c?g.Up.AsOld:void 0):(this.mostRecentEditorsMap.set(n,n,g.Up.AsOld),this.mostRecentEditorsMap.set(c,c,g.Up.AsOld)),d&&this.updateEditorResourcesMap(o,!0),this._onDidMostRecentlyActiveEditorsChange.fire()}updateEditorResourcesMap(e,o){let t,d,n;if(e instanceof x.JL?(t=e.primary.resource,d=e.primary.typeId,n=e.primary.editorId):(t=e.resource,d=e.typeId,n=e.editorId),!t)return;const c=this.toIdentifier(d,n);if(o){let a=this.editorsPerResourceCounter.get(t);a||(a=new Map,this.editorsPerResourceCounter.set(t,a)),a.set(c,(a.get(c)??0)+1)}else{const a=this.editorsPerResourceCounter.get(t);if(a){const h=a.get(c)??0;h>1?a.set(c,h-1):(a.delete(c),0===a.size&&this.editorsPerResourceCounter.delete(t))}}}removeMostRecentEditor(e,o){this.updateEditorResourcesMap(o,!1);const t=this.findKey(e,o);if(t){this.mostRecentEditorsMap.delete(t);const d=this.keyMap.get(e.id);d&&d.delete(t.editor)&&0===d.size&&this.keyMap.delete(e.id),this._onDidMostRecentlyActiveEditorsChange.fire()}}findKey(e,o){const t=this.keyMap.get(e.id);if(t)return t.get(o)}ensureKey(e,o){let t=this.keyMap.get(e.id);t||(t=new Map,this.keyMap.set(e.id,t));let d=t.get(o);return d||(d={groupId:e.id,editor:o},t.set(o,d)),d}ensureOpenedEditorsLimit(e,o){var t=this;return(0,D.A)(function*(){if(!t.editorGroupService.partOptions.limit?.enabled||"number"!=typeof t.editorGroupService.partOptions.limit.value||t.editorGroupService.partOptions.limit.value<=0)return;const d=t.editorGroupService.partOptions.limit.value;if(t.editorGroupService.partOptions.limit?.perEditorGroup)if("number"==typeof o){const n=t.editorGroupsContainer.getGroup(o);n&&(yield t.doEnsureOpenedEditorsLimit(d,n.getEditors(v.bS.MOST_RECENTLY_ACTIVE).map(c=>({editor:c,groupId:o})),e))}else for(const n of t.editorGroupsContainer.groups)yield t.ensureOpenedEditorsLimit(e,n.id);else yield t.doEnsureOpenedEditorsLimit(d,[...t.mostRecentEditorsMap.values()],e)})()}doEnsureOpenedEditorsLimit(e,o,t){var d=this;return(0,D.A)(function*(){let n;if(n=d.editorGroupService.partOptions.limit?.excludeDirty?o.filter(({editor:y})=>!(y.isDirty()&&!y.isSaving()||y.hasCapability(v.oG.Scratchpad))):o,e>=n.length)return;const c=n.reverse().filter(({editor:y,groupId:T})=>!(y.isDirty()&&!y.isSaving()||y.hasCapability(v.oG.Scratchpad)||t&&y===t.editor&&T===t.groupId||d.editorGroupsContainer.getGroup(T)?.isSticky(y)));let a=n.length-e;const h=new Map;for(const{groupId:y,editor:T}of c){let F=h.get(y);if(F||(F=[],h.set(y,F)),F.push(T),a--,0===a)break}for(const[y,T]of h){const F=d.editorGroupsContainer.getGroup(y);F&&(yield F.closeEditors(T,{preserveFocus:!0}))}})()}saveState(){this.isScoped||(this.mostRecentEditorsMap.isEmpty()?this.storageService.remove(U.STORAGE_KEY,p.YM.WORKSPACE):this.storageService.store(U.STORAGE_KEY,JSON.stringify(this.serialize()),p.YM.WORKSPACE,p.vi.MACHINE))}serialize(){const e=E.O.as(v.q5.EditorFactory),o=[...this.mostRecentEditorsMap.values()],t=new Map;return{entries:(0,u.Yc)(o.map(({editor:d,groupId:n})=>{const c=this.editorGroupsContainer.getGroup(n);if(!c)return;let a=t.get(c);a||(a=c.getEditors(v.bS.SEQUENTIAL).filter(y=>e.getEditorSerializer(y)?.canSerialize(y)),t.set(c,a));const h=a.indexOf(d);return-1!==h?{groupId:n,index:h}:void 0}))}}loadState(){var e=this;return(0,D.A)(function*(){(e.editorGroupsContainer===e.editorGroupService.mainPart||e.editorGroupsContainer===e.editorGroupService)&&(yield e.editorGroupService.whenReady);let o=!1;if(!e.isScoped){const t=e.storageService.get(U.STORAGE_KEY,p.YM.WORKSPACE);t&&(o=!0,e.deserialize(JSON.parse(t)))}if(!o){const t=e.editorGroupsContainer.getGroups(A.L0.MOST_RECENTLY_ACTIVE);for(let d=t.length-1;d>=0;d--){const n=t[d],c=n.getEditors(v.bS.MOST_RECENTLY_ACTIVE);for(let a=c.length-1;a>=0;a--)e.addMostRecentEditor(n,c[a],!0,!0)}}for(const t of e.editorGroupsContainer.groups)e.registerGroupListeners(t)})()}deserialize(e){const o=[];for(const{groupId:t,index:d}of e.entries){const n=this.editorGroupsContainer.getGroup(t);if(!n)continue;const c=n.getEditorByIndex(d);if(!c)continue;const a=this.ensureKey(n,c);o.push([a,a]),this.updateEditorResourcesMap(c,!0)}this.mostRecentEditorsMap.fromJSON(o)}};Y=U=(0,_.C)([(0,_.Q)(1,m.m),(0,_.Q)(2,L.C)],Y);var J,b=r(23838),X=r(75158),Z=r(68110),q=r(40660),w=r(10515),ee=r(56206),k=r(68473),te=r(95368),ie=r(46836),j=r(79360),oe=r(65125);let $=J=class extends l.jG{constructor(i,e,o,t,d,n,c,a,h,y,T){super(),this.editorGroupService=e,this.instantiationService=o,this.fileService=t,this.configurationService=d,this.contextService=n,this.uriIdentityService=c,this.editorResolverService=a,this.workspaceTrustRequestService=h,this.hostService=y,this.textEditorService=T,this._onDidActiveEditorChange=this._register(new G.vl),this.onDidActiveEditorChange=this._onDidActiveEditorChange.event,this._onDidVisibleEditorsChange=this._register(new G.vl),this.onDidVisibleEditorsChange=this._onDidVisibleEditorsChange.event,this._onDidEditorsChange=this._register(new G.vl),this.onDidEditorsChange=this._onDidEditorsChange.event,this._onWillOpenEditor=this._register(new G.vl),this.onWillOpenEditor=this._onWillOpenEditor.event,this._onDidCloseEditor=this._register(new G.vl),this.onDidCloseEditor=this._onDidCloseEditor.event,this._onDidOpenEditorFail=this._register(new G.vl),this.onDidOpenEditorFail=this._onDidOpenEditorFail.event,this._onDidMostRecentlyActiveEditorsChange=this._register(new G.vl),this.onDidMostRecentlyActiveEditorsChange=this._onDidMostRecentlyActiveEditorsChange.event,this.lastActiveEditor=void 0,this.activeOutOfWorkspaceWatchers=new g.fT,this.closeOnFileDelete=!1,this.editorGroupsContainer=i??e,this.editorsObserver=this._register(this.instantiationService.createInstance(Y,this.editorGroupsContainer)),this.onConfigurationUpdated(),this.registerListeners()}createScoped(i,e){return e.add(new J("main"===i?this.editorGroupService.mainPart:i,this.editorGroupService,this.instantiationService,this.fileService,this.configurationService,this.contextService,this.uriIdentityService,this.editorResolverService,this.workspaceTrustRequestService,this.hostService,this.textEditorService))}registerListeners(){this.editorGroupsContainer===this.editorGroupService.mainPart||this.editorGroupsContainer===this.editorGroupService?this.editorGroupService.whenReady.then(()=>this.onEditorGroupsReady()):this.onEditorGroupsReady(),this._register(this.editorGroupsContainer.onDidChangeActiveGroup(i=>this.handleActiveEditorChange(i))),this._register(this.editorGroupsContainer.onDidAddGroup(i=>this.registerGroupListeners(i))),this._register(this.editorsObserver.onDidMostRecentlyActiveEditorsChange(()=>this._onDidMostRecentlyActiveEditorsChange.fire())),this._register(this.onDidVisibleEditorsChange(()=>this.handleVisibleEditorsChange())),this._register(this.fileService.onDidRunOperation(i=>this.onDidRunFileOperation(i))),this._register(this.fileService.onDidFilesChange(i=>this.onDidFilesChange(i))),this._register(this.configurationService.onDidChangeConfiguration(i=>this.onConfigurationUpdated(i)))}onEditorGroupsReady(){for(const i of this.editorGroupsContainer.groups)this.registerGroupListeners(i);this.activeEditor&&(this.doHandleActiveEditorChangeEvent(),this._onDidVisibleEditorsChange.fire())}handleActiveEditorChange(i){i===this.editorGroupsContainer.activeGroup&&(!this.lastActiveEditor&&!i.activeEditor||this.doHandleActiveEditorChangeEvent())}doHandleActiveEditorChangeEvent(){this.lastActiveEditor=this.editorGroupsContainer.activeGroup.activeEditor??void 0,this._onDidActiveEditorChange.fire()}registerGroupListeners(i){const e=new l.Cm;e.add(i.onDidModelChange(o=>{this._onDidEditorsChange.fire({groupId:i.id,event:o})})),e.add(i.onDidActiveEditorChange(()=>{this.handleActiveEditorChange(i),this._onDidVisibleEditorsChange.fire()})),e.add(i.onWillOpenEditor(o=>{this._onWillOpenEditor.fire(o)})),e.add(i.onDidCloseEditor(o=>{this._onDidCloseEditor.fire(o)})),e.add(i.onDidOpenEditorFail(o=>{this._onDidOpenEditorFail.fire({editor:o,groupId:i.id})})),G.Jh.once(i.onWillDispose)(()=>{(0,l.AS)(e)})}handleVisibleEditorsChange(){const i=new g.rm;for(const e of this.visibleEditors){const o=(0,u.dM)((0,u.Yc)([v.tf.getCanonicalUri(e,{supportSideBySide:v.zX.PRIMARY}),v.tf.getCanonicalUri(e,{supportSideBySide:v.zX.SECONDARY})]),t=>t.toString());for(const t of o)this.fileService.hasProvider(t)&&!this.contextService.isInsideWorkspace(t)&&i.add(t)}for(const e of this.activeOutOfWorkspaceWatchers.keys())i.has(e)||((0,l.AS)(this.activeOutOfWorkspaceWatchers.get(e)),this.activeOutOfWorkspaceWatchers.delete(e));for(const e of i.keys())if(!this.activeOutOfWorkspaceWatchers.get(e)){const o=this.fileService.watch(e);this.activeOutOfWorkspaceWatchers.set(e,o)}}onDidRunFileOperation(i){var e=this;return(0,D.A)(function*(){i.isOperation(W.a4.MOVE)&&e.handleMovedFile(i.resource,i.target.resource),(i.isOperation(W.a4.DELETE)||i.isOperation(W.a4.MOVE))&&e.handleDeletedFile(i.resource,!1,i.target?i.target.resource:void 0)})()}onDidFilesChange(i){i.gotDeleted()&&this.handleDeletedFile(i,!0)}handleMovedFile(i,e){var o=this;return(0,D.A)(function*(){for(const t of o.editorGroupsContainer.groups){const d=[];for(const n of t.editors){const c=n.resource;if(!c||!o.uriIdentityService.extUri.isEqualOrParent(c,i))continue;let a;if(o.uriIdentityService.extUri.isEqual(i,c))a=e;else{const T=(0,Z.p4)(c.path,i.path,o.uriIdentityService.extUri.ignorePathCasing(c));a=(0,N.uJ)(e,c.path.substr(T+i.path.length+1))}const h=yield n.rename(t.id,a);if(!h)return;const y={preserveFocus:!0,pinned:t.isPinned(n),sticky:t.isSticky(n),index:t.getIndexOfEditor(n),inactive:!t.isActive(n)};(0,v.ct)(h.editor)?d.push({editor:n,replacement:h.editor,options:{...h.options,...y}}):d.push({editor:n,replacement:{...h.editor,options:{...h.editor.options,...y}}})}d.length&&o.replaceEditors(d,t)}})()}onConfigurationUpdated(i){if(i&&!i.affectsConfiguration("workbench.editor.closeOnFileDelete"))return;const e=this.configurationService.getValue();this.closeOnFileDelete="boolean"==typeof e.workbench?.editor?.closeOnFileDelete&&e.workbench.editor.closeOnFileDelete}handleDeletedFile(i,e,o){var t=this;for(const d of this.getAllNonDirtyEditors({includeUntitled:!1,supportSideBySide:!0}))(0,D.A)(function*(){const n=d.resource;if(n&&(t.closeOnFileDelete||!e)){if(o&&t.uriIdentityService.extUri.isEqualOrParent(n,o))return;let c=!1;if(c=i instanceof W.Qt?i.contains(n,W.Jx.DELETED):t.uriIdentityService.extUri.isEqualOrParent(n,i),!c)return;let a=!1;e&&t.fileService.hasProvider(n)&&(yield(0,b.wR)(100),a=yield t.fileService.exists(n)),!a&&!d.isDisposed()&&d.dispose()}})()}getAllNonDirtyEditors(i){const e=[];function o(t){t.hasCapability(v.oG.Untitled)&&!i.includeUntitled||t.isDirty()||e.push(t)}for(const t of this.editors)i.supportSideBySide&&t instanceof x.JL?(o(t.primary),o(t.secondary)):o(t);return e}get activeEditorPane(){return this.editorGroupsContainer.activeGroup?.activeEditorPane}get activeTextEditorControl(){const i=this.activeEditorPane;if(i){const e=i.getControl();if((0,f.z9)(e)||(0,f.Np)(e))return e;if((0,f.Pf)(e)&&(0,f.z9)(e.activeCodeEditor))return e.activeCodeEditor}}get activeTextEditorLanguageId(){let i;const e=this.activeTextEditorControl;return i=(0,f.Np)(e)?e.getModifiedEditor():e,i?.getModel()?.getLanguageId()}get count(){return this.editorsObserver.count}get editors(){return this.getEditors(v.bS.SEQUENTIAL).map(({editor:i})=>i)}getEditors(i,e){switch(i){case v.bS.MOST_RECENTLY_ACTIVE:return e?.excludeSticky?this.editorsObserver.editors.filter(({groupId:o,editor:t})=>!this.editorGroupsContainer.getGroup(o)?.isSticky(t)):this.editorsObserver.editors;case v.bS.SEQUENTIAL:{const o=[];for(const t of this.editorGroupsContainer.getGroups(A.L0.GRID_APPEARANCE))o.push(...t.getEditors(v.bS.SEQUENTIAL,e).map(d=>({editor:d,groupId:t.id})));return o}}}get activeEditor(){const i=this.editorGroupsContainer.activeGroup;return i?i.activeEditor??void 0:void 0}get visibleEditorPanes(){return(0,u.Yc)(this.editorGroupsContainer.groups.map(i=>i.activeEditorPane))}get visibleTextEditorControls(){return this.doGetVisibleTextEditorControls(this.visibleEditorPanes)}doGetVisibleTextEditorControls(i){const e=[];for(const o of i){const t=[];o instanceof C.z?(t.push(o.getPrimaryEditorPane()?.getControl()),t.push(o.getSecondaryEditorPane()?.getControl())):t.push(o.getControl());for(const d of t)((0,f.z9)(d)||(0,f.Np)(d))&&e.push(d)}return e}getVisibleTextEditorControls(i){return this.doGetVisibleTextEditorControls((0,u.Yc)(this.editorGroupsContainer.getGroups(i===v.bS.SEQUENTIAL?A.L0.GRID_APPEARANCE:A.L0.MOST_RECENTLY_ACTIVE).map(e=>e.activeEditorPane)))}get visibleEditors(){return(0,u.Yc)(this.editorGroupsContainer.groups.map(i=>i.activeEditor))}openEditor(i,e,o){var t=this;return(0,D.A)(function*(){let d,c,n=(0,v.ct)(i)?e:i.options;if((0,S.BS)(e)&&(o=e),!(0,v.ct)(i)){const a=yield t.editorResolverService.resolveEditor(i,o);if(a===w.HI.ABORT)return;(0,v.kc)(a)&&(d=a.editor,n=a.options,c=a.group)}if(d||(d=(0,v.ct)(i)?i:yield t.textEditorService.resolveTextEditor(i)),!c){let a;const h=t.instantiationService.invokeFunction(j.$,{editor:d,options:n},o);[c,a]=h instanceof Promise?yield h:h,a&&(n={...n,activation:a})}return c.openEditor(d,n)})()}openEditors(i,e,o){var t=this;return(0,D.A)(function*(){if(o?.validateTrust&&!(yield t.handleWorkspaceTrust(i)))return[];const d=new Map;for(const c of i){let a,h;if(!(0,v.cs)(c)){const T=yield t.editorResolverService.resolveEditor(c,e);if(T===w.HI.ABORT)continue;(0,v.kc)(T)&&(a=T,h=T.group)}if(a||(a=(0,v.cs)(c)?c:{editor:yield t.textEditorService.resolveTextEditor(c),options:c.options}),!h){const T=t.instantiationService.invokeFunction(j.$,a,e);[h]=T instanceof Promise?yield T:T}let y=d.get(h);y||(y=[],d.set(h,y)),y.push(a)}const n=[];for(const[c,a]of d)n.push(c.openEditors(a));return(0,u.Yc)(yield b.HC.settled(n))})()}handleWorkspaceTrust(i){var e=this;return(0,D.A)(function*(){const{resources:o,diffMode:t,mergeMode:d}=e.extractEditorResources(i);switch(yield e.workspaceTrustRequestService.requestOpenFilesTrust(o)){case k.h.Open:return!0;case k.h.OpenInNewWindow:return yield e.hostService.openWindow(o.map(c=>({fileUri:c})),{forceNewWindow:!0,diffMode:t,mergeMode:d}),!1;case k.h.Cancel:return!1}})()}extractEditorResources(i){const e=new g.rm;let o=!1,t=!1;for(const d of i)if((0,v.cs)(d)){const n=v.tf.getOriginalUri(d.editor,{supportSideBySide:v.zX.BOTH});I.rz.isUri(n)?e.add(n):n&&(n.primary&&e.add(n.primary),n.secondary&&e.add(n.secondary),o=d.editor instanceof M.p)}else(0,v.CD)(d)&&(I.rz.isUri(d.input1)&&e.add(d.input1.resource),I.rz.isUri(d.input2)&&e.add(d.input2.resource),I.rz.isUri(d.base)&&e.add(d.base.resource),I.rz.isUri(d.result)&&e.add(d.result.resource),t=!0),(0,v.bV)(d)?(I.rz.isUri(d.original.resource)&&e.add(d.original.resource),I.rz.isUri(d.modified.resource)&&e.add(d.modified.resource),o=!0):(0,v.iY)(d)&&e.add(d.resource);return{resources:Array.from(e.keys()),diffMode:o,mergeMode:t}}isOpened(i){return this.editorsObserver.hasEditor({resource:this.uriIdentityService.asCanonicalUri(i.resource),typeId:i.typeId,editorId:i.editorId})}isVisible(i){for(const e of this.editorGroupsContainer.groups)if(e.activeEditor?.matches(i))return!0;return!1}closeEditor({editor:i,groupId:e},o){var t=this;return(0,D.A)(function*(){yield t.editorGroupsContainer.getGroup(e)?.closeEditor(i,o)})()}closeEditors(i,e){var o=this;return(0,D.A)(function*(){const t=new Map;for(const{editor:d,groupId:n}of i){const c=o.editorGroupsContainer.getGroup(n);if(!c)continue;let a=t.get(c);a||(a=[],t.set(c,a)),a.push(d)}for(const[d,n]of t)yield d.closeEditors(n,e)})()}findEditors(i,e,o){const t=I.rz.isUri(i)?i:i.resource,d=I.rz.isUri(i)?void 0:i.typeId;if(e?.supportSideBySide!==v.zX.ANY&&e?.supportSideBySide!==v.zX.SECONDARY&&!this.editorsObserver.hasEditors(t))return I.rz.isUri(i)||(0,z.b0)(o)?[]:void 0;if((0,z.b0)(o)){const n=[];for(const c of this.editorGroupsContainer.getGroups(A.L0.MOST_RECENTLY_ACTIVE)){const a=[];if(I.rz.isUri(i))a.push(...this.findEditors(i,e,c));else{const h=this.findEditors(i,e,c);h&&a.push(h)}n.push(...a.map(h=>({editor:h,groupId:c.id})))}return n}{const n="number"==typeof o?this.editorGroupsContainer.getGroup(o):o;if(I.rz.isUri(i))return n?n.findEditors(t,e):[];{if(!n)return;const c=n.findEditors(t,e);for(const a of c)if(a.typeId===d)return a;return}}}replaceEditors(i,e){var o=this;return(0,D.A)(function*(){const t="number"==typeof e?o.editorGroupsContainer.getGroup(e):e,d=[];for(const n of i){let c;if(!(0,v.ct)(n.replacement)){const a=yield o.editorResolverService.resolveEditor(n.replacement,t);if(a===w.HI.ABORT)continue;(0,v.kc)(a)&&(c={editor:n.editor,replacement:a.editor,options:a.options,forceReplaceDirty:n.forceReplaceDirty})}c||(c={editor:n.editor,replacement:(0,A.Km)(n)?n.replacement:yield o.textEditorService.resolveTextEditor(n.replacement),options:(0,A.Km)(n)?n.options:n.replacement.options,forceReplaceDirty:n.forceReplaceDirty}),d.push(c)}return t?.replaceEditors(d)})()}save(i,e){var o=this;return(0,D.A)(function*(){Array.isArray(i)||(i=[i]);const t=o.getUniqueEditors(i),d=[],n=[];if(e?.saveAs)n.push(...t);else for(const{groupId:a,editor:h}of t)h.hasCapability(v.oG.Untitled)?n.push({groupId:a,editor:h}):d.push({groupId:a,editor:h});const c=yield b.HC.settled(d.map(({groupId:a,editor:h})=>(e?.reason===v.Mr.EXPLICIT&&o.editorGroupsContainer.getGroup(a)?.pinEditor(h),h.save(a,e))));for(const{groupId:a,editor:h}of n){if(h.isDisposed())continue;const T={pinned:!0,viewState:(yield o.openEditor(h,a))?.getViewState()},F=e?.saveAs?yield h.saveAs(a,e):yield h.save(a,e);if(c.push(F),!F)break;if(!h.matches(F)){const se=h.hasCapability(v.oG.Untitled)?o.editorGroupsContainer.groups.map(H=>H.id):[a];for(const H of se)F instanceof B.m?yield o.replaceEditors([{editor:h,replacement:F,options:T}],H):yield o.replaceEditors([{editor:h,replacement:{...F,options:T}}],H)}}return{success:c.every(a=>!!a),editors:(0,u.Yc)(c)}})()}saveAll(i){return this.save(this.getAllModifiedEditors(i),i)}revert(i,e){var o=this;return(0,D.A)(function*(){Array.isArray(i)||(i=[i]);const t=o.getUniqueEditors(i);return yield b.HC.settled(t.map(function(){var d=(0,D.A)(function*({groupId:n,editor:c}){return o.editorGroupsContainer.getGroup(n)?.pinEditor(c),c.revert(n,e)});return function(n){return d.apply(this,arguments)}}())),!t.some(({editor:d})=>d.isDirty())})()}revertAll(i){var e=this;return(0,D.A)(function*(){return e.revert(e.getAllModifiedEditors(i),i)})()}getAllModifiedEditors(i){const e=[];for(const o of this.editorGroupsContainer.getGroups(A.L0.MOST_RECENTLY_ACTIVE))for(const t of o.getEditors(v.bS.MOST_RECENTLY_ACTIVE))t.isModified()&&(("boolean"==typeof i?.includeUntitled||!i?.includeUntitled?.includeScratchpad)&&t.hasCapability(v.oG.Scratchpad)||!i?.includeUntitled&&t.hasCapability(v.oG.Untitled)||i?.excludeSticky&&o.isSticky(t)||e.push({groupId:o.id,editor:t}));return e}getUniqueEditors(i){const e=[];for(const{editor:o,groupId:t}of i)e.some(d=>d.editor.matches(o))||e.push({editor:o,groupId:t});return e}dispose(){super.dispose(),this.activeOutOfWorkspaceWatchers.forEach(i=>(0,l.AS)(i)),this.activeOutOfWorkspaceWatchers.clear()}};$=J=(0,_.C)([(0,_.Q)(1,m.m),(0,_.Q)(2,R._Y),(0,_.Q)(3,K.$),(0,_.Q)(4,s.p),(0,_.Q)(5,X.V),(0,_.Q)(6,q.J),(0,_.Q)(7,ee.Y),(0,_.Q)(8,te.ZE),(0,_.Q)(9,ie.v),(0,_.Q)(10,oe.P)],$)},79360:(Q,V,r)=>{r.d(V,{$:()=>g});var D=r(81856),_=r(86827),R=r(51627),v=r(84169),B=r(36376),x=r(19657);function g(M,C,A){const m=M.get(B.m),S=M.get(D.p),s=function K(M,C,A,m){let S;const s=(0,R.cs)(M)?M.editor:M,l=M.options;if(C&&"number"!=typeof C)S=C;else if("number"==typeof C&&C>=0)S=A.getGroup(C);else if(C===x.Sd){const u=(0,v.BD)(m);let f=A.findGroup({direction:u});(!f||G(f,s))&&(f=A.addGroup(A.activeGroup,u)),S=f}else if(C===x.eV)S=A.createAuxiliaryEditorPart().then(u=>u.activeGroup);else if(!l||"number"!=typeof l.index){const u=A.getGroups(v.L0.MOST_RECENTLY_ACTIVE);if(l?.revealIfVisible)for(const f of u)if(I(f,s)){S=f;break}if(!S&&(l?.revealIfOpened||m.getValue("workbench.editor.revealIfOpen")||(0,R.ct)(s)&&s.hasCapability(R.oG.Singleton))){let f,O;for(const z of u)if(N(z,s)&&(O||(O=z),!f&&z.isActive(s)&&(f=z)),O&&f)break;S=f||O}}if(!S){let u=A.activeGroup;if(G(u,s)){for(const f of A.getGroups(v.L0.MOST_RECENTLY_ACTIVE))if(!G(f,s)){u=f;break}S=G(u,s)?A.addGroup(u,(0,v.BD)(m)):u}else S=u}return S}(C,A,m,S);return s instanceof Promise?s.then(l=>W(l,C,A,m)):W(s,C,A,m)}function W(M,C,A,m){let S;return m.activeGroup!==M&&C.options&&!C.options.inactive&&C.options.preserveFocus&&"number"!=typeof C.options.activation&&A!==x.Sd&&(S=_.u2.ACTIVATE),[M,S]}function G(M,C){return!(!M.isLocked||N(M,C))}function I(M,C){return!!M.activeEditor&&M.activeEditor.matches(C)}function N(M,C){for(const A of M.editors)if(A.matches(C))return!0;return!1}},61649:(Q,V,r)=>{var D=r(29647),_=r(38035),R=r(52814),v=r(31093),B=r(40628),x=r(46836),g=r(51627),W=r(8472),K=r(36376),G=r(72462),I=r(24030),N=r(25552),M=r(27126),C=r(70976),A=r(40660);let m=class extends R.jG{static{this.ID="workbench.contrib.editorAutoSave"}constructor(s,l,u,f,O,z,p,L){super(),this.filesConfigurationService=s,this.hostService=l,this.editorService=u,this.editorGroupService=f,this.workingCopyService=O,this.logService=z,this.markerService=p,this.uriIdentityService=L,this.scheduledAutoSavesAfterDelay=new Map,this.lastActiveEditor=void 0,this.lastActiveGroupId=void 0,this.lastActiveEditorControlDisposable=this._register(new R.Cm),this.waitingOnConditionAutoSaveWorkingCopies=new C.fT(E=>this.uriIdentityService.extUri.getComparisonKey(E)),this.waitingOnConditionAutoSaveEditors=new C.fT(E=>this.uriIdentityService.extUri.getComparisonKey(E));for(const E of this.workingCopyService.dirtyWorkingCopies)this.onDidRegister(E);this.registerListeners()}registerListeners(){this._register(this.hostService.onDidChangeFocus(s=>this.onWindowFocusChange(s))),this._register(this.hostService.onDidChangeActiveWindow(()=>this.onActiveWindowChange())),this._register(this.editorService.onDidActiveEditorChange(()=>this.onDidActiveEditorChange())),this._register(this.filesConfigurationService.onDidChangeAutoSaveConfiguration(()=>this.onDidChangeAutoSaveConfiguration())),this._register(this.workingCopyService.onDidRegister(s=>this.onDidRegister(s))),this._register(this.workingCopyService.onDidUnregister(s=>this.onDidUnregister(s))),this._register(this.workingCopyService.onDidChangeDirty(s=>this.onDidChangeDirty(s))),this._register(this.workingCopyService.onDidChangeContent(s=>this.onDidChangeContent(s))),this._register(this.markerService.onMarkerChanged(s=>this.onConditionChanged(s,v.vq.ERRORS))),this._register(this.filesConfigurationService.onDidChangeAutoSaveDisabled(s=>this.onConditionChanged([s],v.vq.DISABLED)))}onConditionChanged(s,l){for(const u of s){const f=this.waitingOnConditionAutoSaveWorkingCopies.get(u);if(f?.condition===l)f.workingCopy.isDirty()&&this.filesConfigurationService.getAutoSaveMode(f.workingCopy.resource,f.reason).mode!==v.O6.OFF&&(this.discardAutoSave(f.workingCopy),this.logService.trace("[editor auto save] running auto save from condition change event",f.workingCopy.resource.toString(),f.workingCopy.typeId),f.workingCopy.save({reason:f.reason}));else{const O=this.waitingOnConditionAutoSaveEditors.get(u);O?.condition===l&&!O.editor.editor.isDisposed()&&O.editor.editor.isDirty()&&this.filesConfigurationService.getAutoSaveMode(O.editor.editor,O.reason).mode!==v.O6.OFF&&(this.waitingOnConditionAutoSaveEditors.delete(u),this.logService.trace(`[editor auto save] running auto save from condition change event with reason ${O.reason}`),this.editorService.save(O.editor,{reason:O.reason}))}}}onWindowFocusChange(s){s||this.maybeTriggerAutoSave(g.Mr.WINDOW_CHANGE)}onActiveWindowChange(){this.maybeTriggerAutoSave(g.Mr.WINDOW_CHANGE)}onDidActiveEditorChange(){this.lastActiveEditor&&"number"==typeof this.lastActiveGroupId&&this.maybeTriggerAutoSave(g.Mr.FOCUS_CHANGE,{groupId:this.lastActiveGroupId,editor:this.lastActiveEditor});const s=this.editorGroupService.activeGroup,l=this.lastActiveEditor=s.activeEditor??void 0;this.lastActiveGroupId=s.id,this.lastActiveEditorControlDisposable.clear();const u=this.editorService.activeEditorPane;l&&u&&this.lastActiveEditorControlDisposable.add(u.onDidBlur(()=>{this.maybeTriggerAutoSave(g.Mr.FOCUS_CHANGE,{groupId:s.id,editor:l})}))}maybeTriggerAutoSave(s,l){if(l){if(!l.editor.isDirty()||l.editor.isReadonly()||l.editor.hasCapability(g.oG.Untitled))return;const u=this.filesConfigurationService.getAutoSaveMode(l.editor,s);u.mode!==v.O6.OFF?(s===g.Mr.WINDOW_CHANGE&&(u.mode===v.O6.ON_FOCUS_CHANGE||u.mode===v.O6.ON_WINDOW_CHANGE)||s===g.Mr.FOCUS_CHANGE&&u.mode===v.O6.ON_FOCUS_CHANGE)&&(this.logService.trace(`[editor auto save] triggering auto save with reason ${s}`),this.editorService.save(l,{reason:s})):l.editor.resource&&(u.reason===v.vq.ERRORS||u.reason===v.vq.DISABLED)&&this.waitingOnConditionAutoSaveEditors.set(l.editor.resource,{editor:l,reason:s,condition:u.reason})}else this.saveAllDirtyAutoSaveables(s)}onDidChangeAutoSaveConfiguration(){let s;switch(this.filesConfigurationService.getAutoSaveMode(void 0).mode){case v.O6.ON_FOCUS_CHANGE:s=g.Mr.FOCUS_CHANGE;break;case v.O6.ON_WINDOW_CHANGE:s=g.Mr.WINDOW_CHANGE;break;case v.O6.AFTER_SHORT_DELAY:case v.O6.AFTER_LONG_DELAY:s=g.Mr.AUTO}s&&this.saveAllDirtyAutoSaveables(s)}saveAllDirtyAutoSaveables(s){for(const l of this.workingCopyService.dirtyWorkingCopies){if(l.capabilities&I.i.Untitled)continue;const u=this.filesConfigurationService.getAutoSaveMode(l.resource,s);u.mode!==v.O6.OFF?l.save({reason:s}):(u.reason===v.vq.ERRORS||u.reason===v.vq.DISABLED)&&this.waitingOnConditionAutoSaveWorkingCopies.set(l.resource,{workingCopy:l,reason:s,condition:u.reason})}}onDidRegister(s){s.isDirty()&&this.scheduleAutoSave(s)}onDidUnregister(s){this.discardAutoSave(s)}onDidChangeDirty(s){s.isDirty()?this.scheduleAutoSave(s):this.discardAutoSave(s)}onDidChangeContent(s){s.isDirty()&&this.scheduleAutoSave(s)}scheduleAutoSave(s){if(s.capabilities&I.i.Untitled)return;const l=this.filesConfigurationService.getAutoSaveConfiguration(s.resource).autoSaveDelay;if("number"!=typeof l)return;this.discardAutoSave(s),this.logService.trace(`[editor auto save] scheduling auto save after ${l}ms`,s.resource.toString(),s.typeId);const u=setTimeout(()=>{if(this.discardAutoSave(s),s.isDirty()){const f=g.Mr.AUTO,O=this.filesConfigurationService.getAutoSaveMode(s.resource,f);O.mode!==v.O6.OFF?(this.logService.trace("[editor auto save] running auto save",s.resource.toString(),s.typeId),s.save({reason:f})):(O.reason===v.vq.ERRORS||O.reason===v.vq.DISABLED)&&this.waitingOnConditionAutoSaveWorkingCopies.set(s.resource,{workingCopy:s,reason:f,condition:O.reason})}},l);this.scheduledAutoSavesAfterDelay.set(s,(0,R.s)(()=>{this.logService.trace("[editor auto save] clearing pending auto save",s.resource.toString(),s.typeId),clearTimeout(u)}))}discardAutoSave(s){(0,R.AS)(this.scheduledAutoSavesAfterDelay.get(s)),this.scheduledAutoSavesAfterDelay.delete(s),this.waitingOnConditionAutoSaveWorkingCopies.delete(s.resource),this.waitingOnConditionAutoSaveEditors.delete(s.resource)}};m=(0,_.C)([(0,_.Q)(0,B.U),(0,_.Q)(1,x.v),(0,_.Q)(2,W.I),(0,_.Q)(3,K.m),(0,_.Q)(4,G.v),(0,_.Q)(5,N.r),(0,_.Q)(6,M.D),(0,_.Q)(7,A.J)],m),(0,D.tr)(m.ID,m,D.lw.BlockRestore)},42079:(Q,V,r)=>{var D=r(88039),_=r(51627),R=r(53592),v=r(96452);D.O.as(_.q5.EditorFactory).registerFileEditorFactory({typeId:R.Io,createFileEditor:(B,x,g,W,K,G,I,N)=>N.createInstance(v.K,B,x,g,W,K,G,I),isFileEditor:B=>B instanceof v.K})},45096:(Q,V,r)=>{r.d(V,{g:()=>C});var D=r(10467),_=r(38035),R=r(21030),v=r(98747),B=r(50540),x=r(87089),g=r(19657),W=r(8472),I=(r(98039),r(79758),r(53899)),N=r(81856),M=r(35272);let C=class extends v.CL{constructor(m,S,s){super(S),this.editorService=m,this.configurationService=s,this._register(this.registerCodeEditorOpenHandler(this.doOpenCodeEditor.bind(this))),this._register(this.registerCodeEditorOpenHandler(this.doOpenCodeEditorFromDiff.bind(this)))}getActiveCodeEditor(){const m=this.editorService.activeTextEditorControl;if((0,R.z9)(m))return m;if((0,R.Np)(m))return m.getModifiedEditor();const S=this.editorService.activeEditorPane?.getControl();return(0,R.Pf)(S)&&(0,R.z9)(S.activeCodeEditor)?S.activeCodeEditor:null}doOpenCodeEditorFromDiff(m,S,s){var l=this;return(0,D.A)(function*(){const u=l.editorService.activeTextEditorControl;if(!s&&(0,R.Np)(u)&&m.options&&m.resource&&S===u.getModifiedEditor()&&u.getModel()&&(0,I.n4)(m.resource,u.getModel()?.modified.uri)){const f=u.getModifiedEditor();return(0,M.r)(m.options,f,B.ov.Smooth),f}return null})()}doOpenCodeEditor(m,S,s){var l=this;return(0,D.A)(function*(){if(!l.configurationService.getValue().workbench?.editor?.enablePreviewFromCodeNavigation&&S&&!m.options?.pinned&&!s&&!(0,I.n4)(S.getModel()?.uri,m.resource))for(const O of l.editorService.visibleEditorPanes)if((0,R.jA)(O.getControl())===S){O.group.pinEditor();break}const f=yield l.editorService.openEditor(m,s?g.Sd:g.Bn);if(f){const O=f.getControl();if((0,R.z9)(O))return O;if((0,R.Pf)(O)&&(0,R.z9)(O.activeCodeEditor))return O.activeCodeEditor}return null})()}};C=(0,_.C)([(0,_.Q)(0,W.I),(0,_.Q)(1,x.G),(0,_.Q)(2,N.p)],C)},96353:(Q,V,r)=>{r.d(V,{E:()=>O});var D=r(10467),_=r(38035),R=r(48738),v=r(88039),B=r(70976),x=r(98039),g=r(51627),W=r(95958),K=r(2744),G=r(5475),I=r(47513),N=r(97210),M=r(44819),C=r(53899),A=r(48408),m=r(40660),S=r(18438),s=r(10515),l=r(56206),u=r(52814);r(79758);let O=class extends u.jG{constructor(p,L,E,P,U){super(),this.untitledTextEditorService=p,this.instantiationService=L,this.uriIdentityService=E,this.fileService=P,this.editorResolverService=U,this.editorInputCache=new B.fT,this.fileEditorFactory=v.O.as(g.q5.EditorFactory).getFileEditorFactory(),this.registerDefaultEditor()}registerDefaultEditor(){this._register(this.editorResolverService.registerEditor("*",{id:g.Ie.id,label:g.Ie.displayName,detail:g.Ie.providerDisplayName,priority:s.C8.builtin},{},{createEditorInput:p=>({editor:this.createTextEditor(p)}),createUntitledEditorInput:p=>({editor:this.createTextEditor(p)}),createDiffEditorInput:p=>({editor:this.createTextEditor(p)})}))}resolveTextEditor(p){var L=this;return(0,D.A)(function*(){return L.createTextEditor(p)})()}createTextEditor(p){if((0,g.CD)(p))return this.createTextEditor(p.result);if((0,g.bV)(p)){const P=this.createTextEditor(p.original),U=this.createTextEditor(p.modified);return this.instantiationService.createInstance(G.p,p.label,p.description,P,U,void 0)}if((0,g.nM)(p)){const P=this.createTextEditor(p.primary),U=this.createTextEditor(p.secondary);return this.instantiationService.createInstance(I.JL,p.label,p.description,U,P)}const L=p;if(L.forceUntitled||!L.resource||L.resource.scheme===K.ny.untitled){const P={languageId:L.languageId,initialValue:L.contents,encoding:L.encoding};let U;return U=this.untitledTextEditorService.create(L.resource?.scheme===K.ny.untitled?{untitledResource:L.resource,...P}:{associatedResource:L.resource,...P}),this.createOrGetCached(U.resource,()=>this.instantiationService.createInstance(M.m,U))}const E=p;if(E.resource instanceof A.rz){const P=E.label||(0,C.P8)(E.resource),U=E.resource,Y=this.uriIdentityService.asCanonicalUri(U);return this.createOrGetCached(Y,()=>E.forceFile||this.fileService.hasProvider(Y)?this.fileEditorFactory.createFileEditor(Y,U,E.label,E.description,E.encoding,E.languageId,E.contents,this.instantiationService):this.instantiationService.createInstance(N.r,Y,E.label,E.description,E.languageId,E.contents),b=>{b instanceof M.m||(b instanceof N.r?(P&&b.setName(P),E.description&&b.setDescription(E.description),E.languageId&&b.setPreferredLanguageId(E.languageId),"string"==typeof E.contents&&b.setPreferredContents(E.contents)):(b.setPreferredResource(U),E.label&&b.setPreferredName(E.label),E.description&&b.setPreferredDescription(E.description),E.encoding&&b.setPreferredEncoding(E.encoding),E.languageId&&b.setPreferredLanguageId(E.languageId),"string"==typeof E.contents&&b.setPreferredContents(E.contents)))})}throw new Error(`ITextEditorService: Unable to create texteditor from ${JSON.stringify(p)}`)}createOrGetCached(p,L,E){let P=this.editorInputCache.get(p);return P?(E?.(P),P):(P=L(),this.editorInputCache.set(p,P),R.Jh.once(P.onWillDispose)(()=>this.editorInputCache.delete(p)),P)}};O=(0,_.C)([(0,_.Q)(0,W.g),(0,_.Q)(1,x._Y),(0,_.Q)(2,m.J),(0,_.Q)(3,S.$),(0,_.Q)(4,l.Y)],O)}}]);