var _asyncToGenerator=require("/home/runner/work/Open-Pectus/Open-Pectus/frontend/node_modules/@babel/runtime/helpers/asyncToGenerator.js").default;const sw=self,VERSION=4,resourceCacheName="vscode-resource-cache-4",rootPath=sw.location.pathname.replace(/\/service-worker.js$/,""),searchParams=new URL(location.toString()).searchParams,remoteAuthority=searchParams.get("remoteAuthority"),resourceBaseAuthority=searchParams.get("vscode-resource-base-authority"),resolveTimeout=3e4;class RequestStore{constructor(){this.map=new Map,this.requestPool=0}create(){const e=++this.requestPool;let s;const r=new Promise(i=>s=i),c={resolve:s,promise:r};this.map.set(e,c);const u=setTimeout(()=>{clearTimeout(u);const i=this.map.get(e);if(i===c)return i.resolve({status:"timeout"}),void this.map.delete(e)},3e4);return{requestId:e,promise:r}}resolve(e,s){const r=this.map.get(e);return!!r&&(r.resolve({status:"ok",value:s}),this.map.delete(e),!0)}}const resourceRequestStore=new RequestStore,localhostRequestStore=new RequestStore,unauthorized=()=>new Response("Unauthorized",{status:401}),notFound=()=>new Response("Not Found",{status:404}),methodNotAllowed=()=>new Response("Method Not Allowed",{status:405}),requestTimeout=()=>new Response("Request Timeout",{status:408});function processResourceRequest(t,e){return _processResourceRequest.apply(this,arguments)}function _processResourceRequest(){return(_processResourceRequest=_asyncToGenerator(function*(t,e){const s=yield sw.clients.get(t.clientId);if(!s)return console.error("Could not find inner client for request"),notFound();const r=getWebviewIdForClient(s);if(!r)return console.error("Could not resolve webview id"),notFound();const c="GET"===t.request.method,u=yield getOuterIframeClient(r);if(!u.length)return console.log("Could not find parent client for request"),notFound();let i;c&&(i=yield(yield caches.open(resourceCacheName)).match(t.request));const{requestId:f,promise:l}=resourceRequestStore.create();for(const o of u)o.postMessage({channel:"load-resource",id:f,scheme:e.scheme,authority:e.authority,path:e.path,query:e.query,ifNoneMatch:i?.headers.get("ETag")});return l.then(o=>((o,h)=>{if("timeout"===o.status)return requestTimeout();const n=o.value;if(304===n.status){if(h)return h.clone();throw new Error("No cache found")}if(401===n.status)return unauthorized();if(200!==n.status)return notFound();const m={"Access-Control-Allow-Origin":"*"},g=n.data.byteLength,w=t.request.headers.get("range");if(w){const d=w.match(/^bytes\=(\d+)\-(\d+)?$/g);if(d){const R=Number(d[1]),C=Number(d[2])||g-1;return new Response(n.data.slice(R,C+1),{status:206,headers:{...m,"Content-range":`bytes 0-${C}/${g}`}})}return new Response(null,{status:416,headers:{...m,"Content-range":`*/${g}`}})}const a={...m,"Content-Type":n.mime,"Content-Length":g.toString()};n.etag&&(a.ETag=n.etag,a["Cache-Control"]="no-cache"),n.mtime&&(a["Last-Modified"]=new Date(n.mtime).toUTCString());const y=new URL(t.request.url).searchParams.get("vscode-coi");"3"===y?(a["Cross-Origin-Opener-Policy"]="same-origin",a["Cross-Origin-Embedder-Policy"]="require-corp"):"2"===y?a["Cross-Origin-Embedder-Policy"]="require-corp":"1"===y&&(a["Cross-Origin-Opener-Policy"]="same-origin");const q=new Response(n.data,{status:200,headers:a});return c&&n.etag&&caches.open(resourceCacheName).then(d=>d.put(t.request,q)),q.clone()})(o,i))})).apply(this,arguments)}function processLocalhostRequest(t,e){return _processLocalhostRequest.apply(this,arguments)}function _processLocalhostRequest(){return _processLocalhostRequest=_asyncToGenerator(function*(t,e){const s=yield sw.clients.get(t.clientId);if(!s)return fetch(t.request);const r=getWebviewIdForClient(s);if(!r)return console.error("Could not resolve webview id"),fetch(t.request);const c=e.origin,p=function(){var l=_asyncToGenerator(function*(o){if("ok"!==o.status||!o.value)return fetch(t.request);const h=o.value,n=t.request.url.replace(new RegExp(`^${e.origin}(/|$)`),`${h}$1`);return new Response(null,{status:302,headers:{Location:n}})});return function(h){return l.apply(this,arguments)}}(),u=yield getOuterIframeClient(r);if(!u.length)return console.log("Could not find parent client for request"),notFound();const{requestId:i,promise:f}=localhostRequestStore.create();for(const l of u)l.postMessage({channel:"load-localhost",origin:c,id:i});return f.then(p)}),_processLocalhostRequest.apply(this,arguments)}function getWebviewIdForClient(t){return new URL(t.url).searchParams.get("id")}function getOuterIframeClient(t){return _getOuterIframeClient.apply(this,arguments)}function _getOuterIframeClient(){return(_getOuterIframeClient=_asyncToGenerator(function*(t){return(yield sw.clients.matchAll({includeUncontrolled:!0})).filter(s=>new URL(s.url).searchParams.get("id")===t)})).apply(this,arguments)}sw.addEventListener("message",function(){var t=_asyncToGenerator(function*(e){switch(e.data.channel){case"version":return void sw.clients.get(e.source.id).then(r=>{r&&r.postMessage({channel:"version",version:4})});case"did-load-resource":{const s=e.data.data;return void(resourceRequestStore.resolve(s.id,s)||console.log("Could not resolve unknown resource",s.path))}case"did-load-localhost":{const s=e.data.data;return void(localhostRequestStore.resolve(s.id,s.location)||console.log("Could not resolve unknown localhost",s.origin))}default:return void console.log("Unknown message")}});return function(e){return t.apply(this,arguments)}}()),sw.addEventListener("fetch",t=>{const e=new URL(t.request.url);if("string"==typeof resourceBaseAuthority&&"https:"===e.protocol&&e.hostname.endsWith("."+resourceBaseAuthority))switch(t.request.method){case"GET":case"HEAD":{const s=e.hostname.slice(0,e.hostname.length-(resourceBaseAuthority.length+1)),r=s.split("+",1)[0],c=s.slice(r.length+1);return t.respondWith(processResourceRequest(t,{scheme:r,authority:c,path:e.pathname,query:e.search.replace(/^\?/,"")}))}default:return t.respondWith(methodNotAllowed())}if(e.origin!==sw.origin&&e.host===remoteAuthority)switch(t.request.method){case"GET":case"HEAD":return t.respondWith(processResourceRequest(t,{path:e.pathname,scheme:e.protocol.slice(0,e.protocol.length-1),authority:e.host,query:e.search.replace(/^\?/,"")}));default:return t.respondWith(methodNotAllowed())}if(e.origin!==sw.origin&&e.host.match(/^(localhost|127.0.0.1|0.0.0.0):(\d+)$/))return t.respondWith(processLocalhostRequest(t,e))}),sw.addEventListener("install",t=>{t.waitUntil(sw.skipWaiting())}),sw.addEventListener("activate",t=>{t.waitUntil(sw.clients.claim())});