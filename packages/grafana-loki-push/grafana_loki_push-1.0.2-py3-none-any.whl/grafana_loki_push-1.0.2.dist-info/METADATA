Metadata-Version: 2.4
Name: grafana-loki-push
Version: 1.0.2
Summary: ä¸€é”®éƒ¨ç½² Grafana Loki ç³»ç»Ÿï¼Œæ”¯æŒ HTTP ç›´æ¥æ¨é€æ—¥å¿—ï¼Œæ— éœ€ Promtail
Home-page: https://github.com/wersling/grafana-loki-push
Author: SeanZou
Author-email: SeanZou <wersling@gmail.com>
Maintainer-email: SeanZou <wersling@gmail.com>
License: MIT
Project-URL: Homepage, https://github.com/wersling/grafana-loki-push
Project-URL: Documentation, https://github.com/wersling/grafana-loki-push#readme
Project-URL: Repository, https://github.com/wersling/grafana-loki-push
Project-URL: Bug Tracker, https://github.com/wersling/grafana-loki-push/issues
Project-URL: Changelog, https://github.com/wersling/grafana-loki-push/releases
Keywords: grafana,loki,logging,loguru,observability,monitoring,logs,docker,http-push,prometheus
Platform: any
Classifier: Development Status :: 4 - Beta
Classifier: Intended Audience :: Developers
Classifier: Intended Audience :: System Administrators
Classifier: License :: OSI Approved :: MIT License
Classifier: Operating System :: OS Independent
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.8
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Classifier: Topic :: Software Development :: Libraries :: Python Modules
Classifier: Topic :: System :: Logging
Classifier: Topic :: System :: Monitoring
Classifier: Topic :: System :: Systems Administration
Requires-Python: >=3.8
Description-Content-Type: text/markdown
Requires-Dist: requests>=2.31.0
Requires-Dist: loguru>=0.7.2
Requires-Dist: pyyaml>=6.0.1
Requires-Dist: click>=8.1.7
Requires-Dist: python-json-logger>=2.0.7
Provides-Extra: dev
Requires-Dist: pytest>=7.4.4; extra == "dev"
Requires-Dist: pytest-cov>=4.1.0; extra == "dev"
Requires-Dist: black>=23.12.1; extra == "dev"
Requires-Dist: flake8>=6.1.0; extra == "dev"
Requires-Dist: mypy>=1.8.0; extra == "dev"
Provides-Extra: build
Requires-Dist: setuptools>=69.0.3; extra == "build"
Requires-Dist: wheel>=0.42.0; extra == "build"
Requires-Dist: build>=1.0.0; extra == "build"
Requires-Dist: twine>=4.0.0; extra == "build"
Provides-Extra: all
Requires-Dist: pytest>=7.4.4; extra == "all"
Requires-Dist: pytest-cov>=4.1.0; extra == "all"
Requires-Dist: black>=23.12.1; extra == "all"
Requires-Dist: flake8>=6.1.0; extra == "all"
Requires-Dist: mypy>=1.8.0; extra == "all"
Requires-Dist: setuptools>=69.0.3; extra == "all"
Requires-Dist: wheel>=0.42.0; extra == "all"
Requires-Dist: build>=1.0.0; extra == "all"
Requires-Dist: twine>=4.0.0; extra == "all"
Dynamic: author
Dynamic: home-page
Dynamic: platform
Dynamic: requires-python

# ğŸš€ Grafana Loki Push - Python æ—¥å¿—å¤„ç†å™¨

[![Python 3.8+](https://img.shields.io/badge/python-3.8+-blue.svg)](https://www.python.org/downloads/)
[![MIT License](https://img.shields.io/badge/license-MIT-green.svg)](LICENSE)
[![PyPI](https://img.shields.io/pypi/v/grafana-loki-push.svg)](https://pypi.org/project/grafana-loki-push/)

ğŸ”¥ **æ ¸å¿ƒç‰¹æ€§**ï¼šæ— éœ€ Promtailï¼Œç›´æ¥é€šè¿‡ HTTP æ¨é€æ—¥å¿—åˆ° Lokiï¼å®Œç¾é›†æˆ loguruï¼Œæ”¯æŒç¨‹åºé€€å‡ºæ—¶è‡ªåŠ¨å‘é€å‰©ä½™æ—¥å¿—ã€‚

## âœ¨ ä¸»è¦ç‰¹æ€§

### ğŸ¯ ä¸€é”®é›†æˆ loguru
- **ä¸€è¡Œä»£ç **é›†æˆç°æœ‰é¡¹ç›®æ—¥å¿—ç³»ç»Ÿ
- æ”¯æŒæ‰€æœ‰ loguru æ—¥å¿—çº§åˆ«å’Œæ ¼å¼åŒ–
- è‡ªåŠ¨æå–æ—¥å¿—å­—æ®µå’Œæ ‡ç­¾

### ğŸ”„ HTTP ç›´æ¥æ¨é€
- æ— éœ€ Promtail ä¸­é—´ä»¶ï¼Œç›´æ¥æ¨é€åˆ° Loki
- æ”¯æŒæ‰¹é‡æ¨é€ï¼Œé«˜æ€§èƒ½æ—¥å¿—å¤„ç†
- è‡ªåŠ¨é‡è¯•æœºåˆ¶ï¼Œç¡®ä¿æ—¥å¿—ä¸ä¸¢å¤±

### ğŸ“¦ **ç¨‹åºé€€å‡ºè‡ªåŠ¨å‘é€**
- **å…³é”®ç‰¹æ€§**ï¼šç¨‹åºé€€å‡ºæ—¶è‡ªåŠ¨å‘é€ç¼“å­˜ä¸­çš„å‰©ä½™æ—¥å¿—
- æ”¯æŒæ­£å¸¸é€€å‡ºã€å¼‚å¸¸é€€å‡ºã€ä¿¡å·ä¸­æ–­
- ç¡®ä¿æ‰€æœ‰æ—¥å¿—éƒ½èƒ½æˆåŠŸæ¨é€åˆ° Loki

### ğŸ› ï¸ å®Œæ•´å·¥å…·é“¾
- å‘½ä»¤è¡Œå·¥å…·ï¼š`loki-deploy`
- æ”¯æŒæ—¥å¿—å¹³å°ä¸€é”®éƒ¨ç½²
- åŒ…å« Grafana å¯è§†åŒ–ç•Œé¢

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…

```bash
# ç›´æ¥é€šè¿‡ pip å®‰è£…
pip install grafana-loki-push
```

### åŸºç¡€ä½¿ç”¨

```python
from grafana_loki_push import add_loki_handler
from loguru import logger

# ä¸€è¡Œä»£ç å¯ç”¨ Loki æ—¥å¿—ï¼Œæ”¯æŒè‡ªåŠ¨é€€å‡ºå‘é€ï¼
add_loki_handler(
    service="my-app", 
    environment="production",
    auto_flush_on_exit=True  # å…³é”®ç‰¹æ€§ï¼
)

# æ­£å¸¸ä½¿ç”¨ loguru
logger.info("åº”ç”¨å¯åŠ¨")
logger.warning("è¿™æ˜¯ä¸€æ¡è­¦å‘Š")
logger.error("å‘ç”Ÿé”™è¯¯")

# ç¨‹åºé€€å‡ºæ—¶è‡ªåŠ¨å‘é€å‰©ä½™æ—¥å¿—åˆ° Loki
```

### éƒ¨ç½² Loki å¹³å°

```bash
# ä¸€é”®éƒ¨ç½² Loki + Grafanaï¼ˆéœ€è¦ Dockerï¼‰
loki-deploy deploy

# è®¿é—® Grafana: http://localhost:3000 (admin/admin123)
```

## ğŸ“– è¯¦ç»†ä½¿ç”¨æŒ‡å—

### ğŸ¯ æ–¹å¼ä¸€ï¼šä¾¿æ·å‡½æ•°ï¼ˆæ¨èï¼‰

```python
from grafana_loki_push import add_loki_handler, remove_loki_handler
from loguru import logger

# ä¸€è¡Œä»£ç æ·»åŠ  Loki è¾“å‡º
handler_id = add_loki_handler(
    service="my-app",
    environment="production",
    auto_flush_on_exit=True
)

# æ­£å¸¸ä½¿ç”¨ loguru
logger.info("Hello Loki!")
logger.warning("è¿™æ˜¯ä¸€æ¡è­¦å‘Š")
logger.error("è¿™æ˜¯ä¸€æ¡é”™è¯¯")

# ç§»é™¤handlerï¼ˆå¯é€‰ï¼‰
remove_loki_handler(handler_id)
```

### ğŸ”§ æ–¹å¼äºŒï¼šç›´æ¥ä½¿ç”¨ LokiHandler

```python
from grafana_loki_push import LokiHandler
from loguru import logger

# åˆ›å»º handler
handler = LokiHandler(
    loki_url="http://localhost:3100",
    service="my-service",
    environment="production",
    auto_flush_on_exit=True
)

# æ·»åŠ åˆ° loguru
handler_id = logger.add(handler, format="{message}")

# ä½¿ç”¨å®Œæˆåæ¸…ç†
logger.remove(handler_id)
handler.close()
```

## âš™ï¸ é«˜çº§é…ç½®

### å®Œæ•´é…ç½®å‚æ•°

```python
from grafana_loki_push import LokiHandler

handler = LokiHandler(
    # åŸºç¡€é…ç½®
    loki_url="http://localhost:3100",    # Loki æœåŠ¡åœ°å€
    service="my-service",                # æœåŠ¡åç§°
    environment="production",            # ç¯å¢ƒæ ‡è¯†
    
    # æ€§èƒ½é…ç½®
    batch_size=20,                       # æ‰¹é‡å‘é€å¤§å°
    flush_interval=3.0,                  # å‘é€é—´éš”ï¼ˆç§’ï¼‰
    max_queue_size=1000,                 # æœ€å¤§é˜Ÿåˆ—å¤§å°
    
    # åŠŸèƒ½é…ç½®
    auto_flush_on_exit=True,             # è‡ªåŠ¨é€€å‡ºå‘é€ â­
    debug=False,                         # è°ƒè¯•æ¨¡å¼
    
    # ç½‘ç»œé…ç½®
    timeout=30,                          # è¯·æ±‚è¶…æ—¶ï¼ˆç§’ï¼‰
    retry_attempts=3,                    # é‡è¯•æ¬¡æ•°
    
    # è‡ªå®šä¹‰æ ‡ç­¾
    extra_labels={                       # é¢å¤–çš„å›ºå®šæ ‡ç­¾
        "version": "1.0.0",
        "region": "us-west-1"
    }
)
```

### é…ç½®å‚æ•°è¯¦è§£

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `loki_url` | str | `http://localhost:3100` | Loki æœåŠ¡åœ°å€ |
| `service` | str | `default` | æœåŠ¡åç§°ï¼Œç”¨ä½œæ ‡ç­¾ |
| `environment` | str | `development` | ç¯å¢ƒåç§°ï¼ˆdev/test/prodï¼‰ |
| `batch_size` | int | `10` | æ‰¹é‡å‘é€çš„æ—¥å¿—æ¡æ•° |
| `flush_interval` | float | `5.0` | è‡ªåŠ¨å‘é€é—´éš”ï¼ˆç§’ï¼‰ |
| `max_queue_size` | int | `1000` | å†…å­˜é˜Ÿåˆ—æœ€å¤§å¤§å° |
| `auto_flush_on_exit` | bool | `False` | **ç¨‹åºé€€å‡ºæ—¶è‡ªåŠ¨å‘é€** â­ |
| `debug` | bool | `False` | æ˜¯å¦å¼€å¯è°ƒè¯•è¾“å‡º |
| `timeout` | int | `30` | HTTP è¯·æ±‚è¶…æ—¶æ—¶é—´ |
| `retry_attempts` | int | `3` | å¤±è´¥é‡è¯•æ¬¡æ•° |
| `extra_labels` | dict | `{}` | é¢å¤–çš„å›ºå®šæ ‡ç­¾ |

## ğŸ”„ è‡ªåŠ¨é€€å‡ºå‘é€è¯¦è§£

è¿™æ˜¯æœ¬é¡¹ç›®çš„æ ¸å¿ƒç‰¹æ€§ï¼Œç¡®ä¿ç¨‹åºé€€å‡ºæ—¶ä¸ä¸¢å¤±æ—¥å¿—ã€‚

### å¯ç”¨è‡ªåŠ¨é€€å‡ºå‘é€

```python
from grafana_loki_push import add_loki_handler
from loguru import logger

# å¯ç”¨è‡ªåŠ¨é€€å‡ºå‘é€
add_loki_handler(
    service="my-app",
    auto_flush_on_exit=True  # å…³é”®å‚æ•°ï¼
)

logger.info("ç¨‹åºå¼€å§‹æ‰§è¡Œ")
logger.info("å¤„ç†é‡è¦æ•°æ®...")

# ç¨‹åºåœ¨è¿™é‡Œå¯èƒ½ä¼šå› ä¸ºå¼‚å¸¸é€€å‡º
# ä½†å‰é¢çš„æ—¥å¿—ä¾ç„¶ä¼šè¢«å‘é€åˆ° Loki
```

### æ”¯æŒçš„é€€å‡ºæƒ…å†µ

- âœ… **æ­£å¸¸é€€å‡º**ï¼šç¨‹åºæ­£å¸¸ç»“æŸ
- âœ… **å¼‚å¸¸é€€å‡º**ï¼šæœªæ•è·çš„å¼‚å¸¸å¯¼è‡´ç¨‹åºå´©æºƒ
- âœ… **ä¿¡å·ä¸­æ–­**ï¼šSIGTERMã€SIGINTï¼ˆCtrl+Cï¼‰
- âœ… **ç³»ç»Ÿå…³é—­**ï¼šDocker å®¹å™¨åœæ­¢ã€ç³»ç»Ÿé‡å¯

### æ‰‹åŠ¨è§¦å‘å‘é€

```python
# æ‰‹åŠ¨å‘é€ç¼“å­˜çš„æ—¥å¿—
handler.flush()

# æˆ–è€…å…³é—­æ—¶è‡ªåŠ¨å‘é€
handler.close()
```

## ğŸ“Š ç»“æ„åŒ–æ—¥å¿—

### åŸºç¡€ç»“æ„åŒ–æ—¥å¿—

```python
from loguru import logger

# ä½¿ç”¨ extra å‚æ•°ä¼ é€’ç»“æ„åŒ–æ•°æ®
logger.info("ç”¨æˆ·ç™»å½•", extra={
    "user_id": "12345",
    "ip_address": "192.168.1.100",
    "user_agent": "Mozilla/5.0...",
    "session_id": "sess_abc123"
})
```

### è‡ªå®šä¹‰ Loki æ ‡ç­¾

```python
# ä½¿ç”¨ loki_labels æŒ‡å®šå“ªäº›å­—æ®µä½œä¸º Loki æ ‡ç­¾
logger.info("API è¯·æ±‚", extra={
    "endpoint": "/api/users",       # è¿™ä¸ªä¼šåœ¨æ¶ˆæ¯ä½“ä¸­
    "response_time": 120,           # è¿™ä¸ªä¹Ÿåœ¨æ¶ˆæ¯ä½“ä¸­
    "loki_labels": {                # è¿™äº›ä¼šæˆä¸º Loki æ ‡ç­¾
        "method": "GET",
        "status_code": "200",
        "api_version": "v1"
    }
})
```

### ä½¿ç”¨ bind åˆ›å»ºä¸Šä¸‹æ–‡ logger

```python
# ä¸ºç‰¹å®šæ¨¡å—åˆ›å»ºä¸“ç”¨ logger
auth_logger = logger.bind(loki_labels={"module": "auth"})
auth_logger.info("ç”¨æˆ·ç™»å½•æˆåŠŸ")
auth_logger.error("ç™»å½•å¤±è´¥")

# ä¸ºç‰¹å®šç”¨æˆ·ä¼šè¯åˆ›å»º logger
session_logger = logger.bind(
    session_id="sess_123",
    loki_labels={"module": "user_session"}
)
session_logger.info("ç”¨æˆ·è¿›å…¥é¦–é¡µ")
session_logger.info("ç”¨æˆ·æŸ¥çœ‹å•†å“")
```

## ğŸ› ï¸ å‘½ä»¤è¡Œå·¥å…·

å®‰è£…åå¯åœ¨ä»»ä½•ç›®å½•ä½¿ç”¨ï¼š

```bash
# æœåŠ¡ç®¡ç†
loki-deploy deploy          # éƒ¨ç½² Loki + Grafana
loki-deploy stop           # åœæ­¢æœåŠ¡  
loki-deploy restart        # é‡å¯æœåŠ¡
loki-deploy status         # æŸ¥çœ‹çŠ¶æ€

# æ—¥å¿—ç®¡ç†
loki-deploy logs           # æŸ¥çœ‹æœåŠ¡æ—¥å¿—
loki-deploy example        # è¿è¡Œç¤ºä¾‹
loki-deploy test           # æµ‹è¯•è¿æ¥

# å·¥å…·åŠŸèƒ½
loki-deploy push "æ¶ˆæ¯"    # æ¨é€å•æ¡æ—¥å¿—

# å¸®åŠ©ä¿¡æ¯
loki-deploy --help
grafana-loki --help        # å¤‡ç”¨å‘½ä»¤
```

è¯¦ç»†çš„éƒ¨ç½²å’Œè¿ç»´æŒ‡å—è¯·å‚è€ƒï¼š[grafana-loki-push.md](grafana-loki-push.md)

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. ç”Ÿäº§ç¯å¢ƒé…ç½®

```python
# ç”Ÿäº§ç¯å¢ƒæ¨èé…ç½®
add_loki_handler(
    service="my-production-app",
    environment="production",
    batch_size=50,                # å¢å¤§æ‰¹é‡å¤§å°
    flush_interval=2.0,           # ç¼©çŸ­å‘é€é—´éš”
    auto_flush_on_exit=True,      # å¿…é¡»å¯ç”¨
    extra_labels={
        "version": "1.2.3",
        "datacenter": "us-east-1"
    }
)
```

### 2. å¼€å‘ç¯å¢ƒé…ç½®

```python
# å¼€å‘ç¯å¢ƒé…ç½®
add_loki_handler(
    service="my-dev-app",
    environment="development",
    debug=True,                   # å¼€å¯è°ƒè¯•è¾“å‡º
    flush_interval=1.0,           # æ›´é¢‘ç¹çš„å‘é€
    auto_flush_on_exit=True
)
```

### 3. ç»“æ„åŒ–æ—¥å¿—è§„èŒƒ

```python
# æ¨èçš„æ—¥å¿—ç»“æ„
logger.info("ä¸šåŠ¡æ“ä½œ", extra={
    # ä¸šåŠ¡æ•°æ®ï¼ˆä¼šåœ¨æ—¥å¿—å†…å®¹ä¸­ï¼‰
    "business_data": {...},
    "metrics": {...},
    
    # Loki æ ‡ç­¾ï¼ˆç”¨äºæŸ¥è¯¢è¿‡æ»¤ï¼‰
    "loki_labels": {
        "operation": "user_registration",
        "module": "user_service",
        "status": "success"
    }
})
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **è¿æ¥ä¸ä¸Š Loki**
   ```python
   # æ£€æŸ¥ Loki æ˜¯å¦è¿è¡Œ
   loki-deploy status
   
   # æµ‹è¯•è¿æ¥
   loki-deploy test
   ```

2. **æ—¥å¿—å‘é€å¤±è´¥**
   ```python
   # å¼€å¯è°ƒè¯•æ¨¡å¼æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
   add_loki_handler(debug=True)
   ```

3. **ç¨‹åºé€€å‡ºæ—¶æ—¥å¿—ä¸¢å¤±**
   ```python
   # ç¡®ä¿å¯ç”¨è‡ªåŠ¨é€€å‡ºå‘é€
   add_loki_handler(auto_flush_on_exit=True)
   
   # æˆ–æ‰‹åŠ¨å‘é€
   handler.flush()
   ```

### æ—¥å¿—çº§åˆ«æ˜ å°„

| loguru çº§åˆ« | Loki æ ‡ç­¾ |
|------------|----------|
| TRACE      | trace    |
| DEBUG      | debug    |
| INFO       | info     |
| SUCCESS    | info     |
| WARNING    | warning  |
| ERROR      | error    |
| CRITICAL   | critical |

## ğŸ“¦ é¡¹ç›®ç»“æ„

```
grafana-loki-push/
â”œâ”€â”€ ğŸ“¦ æ ¸å¿ƒåŒ…
â”‚   â””â”€â”€ grafana_loki_push/
â”‚       â”œâ”€â”€ __init__.py          # åŒ…åˆå§‹åŒ–å’ŒAPIå¯¼å‡º
â”‚       â”œâ”€â”€ loki_handler.py      # Loguruå¤„ç†å™¨ï¼ˆæ ¸å¿ƒï¼‰
â”‚       â”œâ”€â”€ loki_client.py       # HTTPå®¢æˆ·ç«¯
â”‚       â”œâ”€â”€ loki_deployment.py   # éƒ¨ç½²ç®¡ç†
â”‚       â””â”€â”€ cli.py               # å‘½ä»¤è¡Œå·¥å…·
â”‚
â”œâ”€â”€ ğŸ¯ é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ config/                  # Lokiå’ŒGrafanaé…ç½®
â”‚   â”œâ”€â”€ docker-compose.yml       # Dockerç¼–æ’
â”‚   â”œâ”€â”€ setup.py                 # å®‰è£…é…ç½®
â”‚   â””â”€â”€ requirements.txt         # ä¾èµ–ç®¡ç†
â”‚
â””â”€â”€ ğŸ“š æ–‡æ¡£
    â”œâ”€â”€ README.md                # æœ¬æ–‡æ¡£ï¼ˆHandlerä½¿ç”¨æŒ‡å—ï¼‰
    â””â”€â”€ grafana-loki-push.md     # éƒ¨ç½²å’Œè¿ç»´æŒ‡å—
```

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## ğŸ“„ è®¸å¯è¯

MIT License - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

---

â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ª Starï¼

ğŸ”— **ç›¸å…³æ–‡æ¡£**ï¼š
- [éƒ¨ç½²å’Œè¿ç»´æŒ‡å—](grafana-loki-push.md) - è¯¦ç»†çš„ Loki å¹³å°éƒ¨ç½²è¯´æ˜
- [PyPI é¡µé¢](https://pypi.org/project/grafana-loki-push/) - åŒ…å‘å¸ƒä¿¡æ¯ 
