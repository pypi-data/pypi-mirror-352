import{a9 as H,aa as O,a as K,g as T,c as _,o as s,B as X,e as A,t as q,ab as Y,ac as ee,ad as te,ae,h as z,af as ne,ag as oe,R as se,O as le,r as b,i as re,v as ie,b as c,d as i,l as f,D as w,F as M,p as ce,q as de,w as S,Z as ue,k as d,E as j,S as ge,a0 as C}from"./7Q6s__oj.js";import{_ as me}from"./BBMtH9_x.js";import{_ as pe}from"./Cfl4xOKH.js";import{_ as ye}from"./CpEskasL.js";import{u as xe}from"./BnL95ZQc.js";const be={base:"inline-flex items-center",rounded:"rounded-md",font:"font-medium",size:{xs:"text-xs px-1.5 py-0.5",sm:"text-xs px-2 py-1",md:"text-sm px-2 py-1",lg:"text-sm px-2.5 py-1.5"},color:{white:{solid:"ring-1 ring-inset ring-gray-300 dark:ring-gray-700 text-gray-900 dark:text-white bg-white dark:bg-gray-900"},gray:{solid:"ring-1 ring-inset ring-gray-300 dark:ring-gray-700 text-gray-700 dark:text-gray-200 bg-gray-50 dark:bg-gray-800"},black:{solid:"text-white dark:text-gray-900 bg-gray-900 dark:bg-white"}},variant:{solid:"bg-{color}-500 dark:bg-{color}-400 text-white dark:text-gray-900",outline:"text-{color}-500 dark:text-{color}-400 ring-1 ring-inset ring-{color}-500 dark:ring-{color}-400",soft:"bg-{color}-50 dark:bg-{color}-400 dark:bg-opacity-10 text-{color}-500 dark:text-{color}-400",subtle:"bg-{color}-50 dark:bg-{color}-400 dark:bg-opacity-10 text-{color}-500 dark:text-{color}-400 ring-1 ring-inset ring-{color}-500 dark:ring-{color}-400 ring-opacity-25 dark:ring-opacity-25"},default:{size:"sm",variant:"solid",color:"primary"}},g=H(O.ui.strategy,O.ui.badge,be),fe=T({inheritAttrs:!1,props:{size:{type:String,default:()=>g.default.size,validator(o){return Object.keys(g.size).includes(o)}},color:{type:String,default:()=>g.default.color,validator(o){return[...O.ui.colors,...Object.keys(g.color)].includes(o)}},variant:{type:String,default:()=>g.default.variant,validator(o){return[...Object.keys(g.variant),...Object.values(g.color).flatMap(a=>Object.keys(a))].includes(o)}},label:{type:[String,Number],default:null},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})}},setup(o){const{ui:a,attrs:x}=ee("badge",te(o,"ui"),g),{size:m,rounded:u}=ae({ui:a,props:o}),p=z(()=>{var h,v;const y=((v=(h=a.value.color)==null?void 0:h[o.color])==null?void 0:v[o.variant])||a.value.variant[o.variant];return ne(oe(a.value.base,a.value.font,u.value,a.value.size[m.value],y==null?void 0:y.replaceAll("{color}",o.color)),o.class)});return{attrs:x,badgeClass:p}}});function _e(o,a,x,m,u,p){return s(),_("span",Y({class:o.badgeClass},o.attrs),[X(o.$slots,"default",{},()=>[A(q(o.label),1)])],16)}const he=K(fe,[["render",_e]]),ve={class:"container my-8 pb-24 flex flex-col min-h-screen"},ke={class:"pb-12 flex-grow"},we={class:"flex justify-between items-center mb-4"},Se={class:"flex gap-2"},Ce={class:"flex flex-col lg:flex-row gap-4 items-center"},ze={class:"flex flex-col sm:flex-row gap-2 sm:gap-0"},Ve={class:"flex-grow flex justify-center"},Ue={class:"flex items-center gap-2 justify-end"},Be=T({__name:"index",setup(o){xe({title:"Import Candles - Jesse"});const a=se(),x=le(),m=b([]),u=b(""),p=b([]),y=z(()=>x.backtestingExchangeNames),h=z(()=>a.forms.some(e=>!e.executing)),v=z(()=>a.forms.some(e=>e.executing)),V=b(new Set),U=b(new Set);function D(){const e=a.forms[a.forms.length-1];a.forms.push({id:j.uuid(),exchange:e.exchange,symbol:e.symbol,start_date:e.start_date,executing:!1,waiting:!1,progressbar:{current:0,estimated_remaining_seconds:0},exception:{error:"",traceback:""},alert:{message:"",type:""}})}function P(e){const t=a.forms.indexOf(e);a.forms.splice(t+1,0,{id:j.uuid(),exchange:e.exchange,symbol:e.symbol,start_date:e.start_date,executing:!1,waiting:!1,progressbar:{current:0,estimated_remaining_seconds:0},exception:{error:"",traceback:""},alert:{message:"",type:""}})}async function L(e){V.value.add(e.id),e.executing&&await $(e.id);const t=a.forms.indexOf(e);a.forms.length>1&&a.forms.splice(t,1),V.value.delete(e.id)}async function F(e){const t=await x.getExchangeSupportedSymbols(e.exchange);p.value=t,t.includes(e.symbol)||(e.symbol=t[0]),B(u.value)}function B(e){if(e.length==0||!p.value.length){m.value=[];return}const t=[];for(const l of p.value){if(t.length>50)break;l.toLowerCase().startsWith(e.toLowerCase())&&t.push(l)}m.value=t}re(()=>u.value,e=>{B(e)});function N(e){const t=a.forms.find(l=>l.id===e);t&&W(t)&&a.start(e)}function W(e){return e.exchange?e.symbol?e.symbol.includes("-")?e.start_date?!0:(C("error","Start date parameter cannot be empty"),!1):(C("error",'Symbol parameter must contain "-" character!'),!1):(C("error","Symbol parameter cannot be empty"),!1):(C("error","Exchange parameter cannot be empty"),!1)}ie(()=>{a.forms[0].exchange||(a.forms[0].exchange=y.value[0]),setTimeout(()=>{F(a.forms[0])},100)});async function $(e){U.value.add(e),await a.cancel(e),U.value.delete(e)}async function J(){const e=a.forms.filter(t=>!t.executing);await Promise.all(e.map(t=>N(t.id)))}async function R(){const e=a.forms.filter(t=>t.executing||t.waiting);await Promise.all(e.map(t=>$(t.id)))}return(e,t)=>{const l=de,E=me,G=ue,Q=he,I=ge,k=pe,Z=ye;return s(),_("div",ve,[c("div",ke,[c("div",we,[i(l,{class:"shadow-sm px-4 py-1.5",icon:"i-heroicons-plus",size:"lg",variant:"solid",label:"Add",onClick:D}),c("div",Se,[w(a).forms.length>1?(s(),_(M,{key:0},[i(l,{class:"shadow-sm px-4 py-1.5",icon:"i-heroicons-arrow-down-tray",size:"lg",variant:"outline",label:"Import All",disabled:!h.value,onClick:J},null,8,["disabled"]),i(l,{class:"shadow-sm px-4 py-1.5",icon:"i-heroicons-x-mark",variant:"outline",size:"lg",color:"rose",label:"Cancel All",disabled:!v.value,onClick:R},null,8,["disabled"])],64)):f("",!0),i(l,{class:"shadow-sm px-4 py-1.5",icon:"i-heroicons-wrench",size:"lg",variant:"outline",color:"gray",label:"Manage",to:"/candles/manage"})])]),(s(!0),_(M,null,ce(w(a).forms,n=>(s(),_("div",{key:n.id,class:"mt-4 border rounded-lg p-4 bg-white dark:border-gray-900 dark:bg-gray-800"},[c("div",Ce,[c("div",ze,[i(E,{modelValue:n.exchange,"onUpdate:modelValue":r=>n.exchange=r,class:"w-full sm:w-48",ui:{base:"sm:rounded-r-none",input:"rounded-lg sm:rounded-r-none sm:rounded-l-lg"},searchable:"",size:"lg",options:y.value,placeholder:"Select exchange...",onChange:()=>F(n)},null,8,["modelValue","onUpdate:modelValue","options","onChange"]),i(E,{modelValue:n.symbol,"onUpdate:modelValue":r=>n.symbol=r,query:u.value,"onUpdate:query":t[0]||(t[0]=r=>u.value=r),"clear-search-on-close":"",class:"w-full sm:w-64",ui:{base:"sm:rounded-none",input:"rounded-lg sm:rounded-none"},searchable:"",size:"lg",options:m.value,placeholder:"Select symbol...",onChange:t[1]||(t[1]=r=>u.value="")},{empty:S(()=>t[2]||(t[2]=[A("Start typing...")])),_:2},1032,["modelValue","onUpdate:modelValue","query","options"]),i(G,{modelValue:n.start_date,"onUpdate:modelValue":r=>n.start_date=r,type:"date",size:"lg",class:"w-full sm:w-48",ui:{base:"sm:rounded-l-none",input:"rounded-lg sm:rounded-l-none sm:rounded-r-lg"}},null,8,["modelValue","onUpdate:modelValue"])]),c("div",Ve,[n.executing?(s(),d(Q,{key:0,color:"blue",variant:"subtle"},{default:S(()=>[A(q(w(j).remainingTimeText(n.progressbar.estimated_remaining_seconds)),1)]),_:2},1024)):f("",!0)]),c("div",Ue,[n.executing?(s(),d(l,{key:1,size:"sm",variant:"soft",color:"rose",label:"Cancel",icon:"i-heroicons-x-mark",loading:U.value.has(n.id),onClick:r=>$(n.id)},null,8,["loading","onClick"])):(s(),d(l,{key:0,size:"sm",variant:"soft",label:"Import",color:"primary",icon:"i-heroicons-arrow-down-tray",onClick:r=>N(n.id)},null,8,["onClick"])),i(I,{text:"Duplicate"},{default:S(()=>[i(l,{size:"sm",variant:"link",color:"gray",icon:"i-heroicons-document-duplicate",onClick:r=>P(n)},null,8,["onClick"])]),_:2},1024),w(a).forms.length>1?(s(),d(I,{key:2,text:"Delete"},{default:S(()=>[i(l,{size:"sm",variant:"link",color:"rose",icon:"i-heroicons-trash",loading:V.value.has(n.id),onClick:r=>L(n)},null,8,["loading","onClick"])]),_:2},1024)):f("",!0)])]),c("div",null,[n.alert.type==="info"?(s(),d(k,{key:0,class:"mt-4",color:"gray",variant:"soft",icon:"i-heroicons-information-circle",title:n.alert.message},null,8,["title"])):f("",!0),n.waiting?(s(),d(k,{key:1,class:"mt-4",color:"yellow",variant:"soft",icon:"i-heroicons-clock",title:`Queued: Waiting for the current '${n.exchange}' import to finish...`},null,8,["title"])):n.executing?(s(),d(Z,{key:2,value:n.progressbar.current,indicator:"",class:"w-full mt-4"},null,8,["value"])):n.exception.error?(s(),d(k,{key:3,class:"mt-4",color:"red",variant:"soft",icon:"i-heroicons-exclamation-triangle",title:n.exception.error},null,8,["title"])):n.alert.type==="success"?(s(),d(k,{key:4,class:"mt-4",color:"green",variant:"soft",icon:"i-heroicons-check-circle",title:n.alert.message},null,8,["title"])):f("",!0)])]))),128)),t[3]||(t[3]=c("div",{class:"h-24 md:h-32"},null,-1))])])}}});export{Be as default};
