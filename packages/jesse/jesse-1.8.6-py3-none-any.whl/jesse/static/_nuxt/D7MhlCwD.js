import{_ as He}from"./DE8CG3p3.js";import{_ as Ye}from"./CuxT9SHT.js";import{g as Z,r as S,h as z,i as J,n as Je,j as Qe,c as m,o as r,k as M,l as k,d as a,m as W,b as s,t as _,F as q,p as fe,q as ye,s as Ue,v as Ce,x as Oe,y as Ge,z as $e,w as E,A as Ze,B as Te,C as Me,D as l,E as Y,G as ie,H as Le,I as Xe,J as Be,K as ce,e as ke,L as xe,M as Pe,N as G,O as ge,P as je,Q as De,R as Ke,S as et,T as tt,U as st,V as ot,W as ue,X as lt,Y as rt,Z as at,$ as nt,a0 as se,a1 as it,a2 as dt,a3 as ut,a4 as ct}from"./7Q6s__oj.js";import{r as ft,_ as mt,a as pt,b as vt,c as gt,d as bt}from"./CSfVeIpR.js";import{_ as yt}from"./Cfl4xOKH.js";import{_ as ht}from"./BBMtH9_x.js";import{T as _e,s as be,l as Re,d as Ee,_ as wt}from"./DPoTvPpU.js";import{_ as kt}from"./CZ145Uj3.js";import{u as xt}from"./BnL95ZQc.js";import"./DzT7WwRO.js";const _t={class:"w-full h-full flex flex-col"},Ct={key:0,class:"flex justify-center items-center py-8"},$t={class:"w-full relative"},Vt={key:0,class:"whitespace-pre-line select-text text-base dark:text-gray-300 w-full mb-1"},St={key:3,class:"mt-4 flex justify-center"},de=1e3,Tt=Z({__name:"Logs",props:{logs:{},sections:{},totalLogs:{}},setup(B){const d=B,v=S(""),f=S(!1),n=S(!1),i=S([]),c=S(null),t=S(1),u=S(!1),y=S(de),$=z(()=>u.value?i.value:i.value.slice(0,y.value));J(()=>d.logs,async w=>{w&&(f.value=!0,await Je(),setTimeout(()=>{i.value=w.slice(0,de),t.value=1,u.value=w.length<=de,f.value=!1},0),setTimeout(()=>{v.value=d.logs.join(`
`)},0))},{immediate:!0}),J(t,()=>{y.value=t.value*de});function g(w){const L=w.target;L.scrollHeight-L.scrollTop<=L.clientHeight+50&&h()}async function h(){n.value||u.value||(n.value=!0,setTimeout(()=>{const w=t.value*de,L=(t.value+1)*de;if(w<d.logs.length){const P=d.logs.slice(w,L);i.value=[...i.value,...P],t.value++,u.value=L>=d.logs.length}else u.value=!0;n.value=!1},0))}return(w,L)=>{const P=Qe("ULoading"),O=Ye,H=ye;return r(),m("div",_t,[f.value?(r(),m("div",Ct,[a(P,{size:"lg"})])):i.value.length?(r(),m("div",{key:2,ref_key:"logContainer",ref:c,class:W([u.value?"h-[calc(100vh-120px)]":"h-[calc(100vh-180px)]","w-full overflow-y-scroll rounded border dark:border-gray-600 bg-gray-50 dark:bg-gray-700 px-4 sm:px-6 py-2"]),onScroll:g},[s("div",$t,[u.value?(r(),m("pre",Vt,"          "+_(v.value)+`
        `,1)):(r(!0),m(q,{key:1},fe($.value,(N,I)=>(r(),m("pre",{key:0+I,class:"whitespace-pre-line select-text text-base dark:text-gray-300 w-full mb-1"},_(N),1))),128))])],34)):(r(),M(O,{key:1})),i.value.length&&!u.value?(r(),m("div",St,[a(H,{loading:n.value,class:"w-full flex justify-center",label:`(loaded ${i.value.length} / ${d.logs.length}) Load All Logs`,onClick:L[0]||(L[0]=N=>u.value=!0)},null,8,["loading","label"])])):k("",!0)])}}}),ze={width:800,height:400,priceScale:{borderColor:"rgba(197, 203, 206, 1)"},timeScale:{borderColor:"rgba(197, 203, 206, 1)",timeVisible:!0,secondsVisible:!1}},Lt={chart:{layout:{background:{color:"#ffffff"},textColor:"rgba(33, 56, 77, 1)"},grid:{vertLines:{color:"#f1f1f1",visible:!0},horzLines:{color:"#f1f1f1",visible:!0}},priceScale:{borderColor:"rgba(197, 203, 206, 0.6)"},timeScale:{borderColor:"rgba(197, 203, 206, 0.6)",timeVisible:!0,secondsVisible:!1}}},jt={chart:{layout:{background:{color:"#333333"},textColor:"#D1D5DB"},grid:{vertLines:{color:"#525252",visible:!0},horzLines:{color:"#525252",visible:!0}},priceScale:{borderColor:"#525252"},timeScale:{borderColor:"#525252",timeVisible:!0,secondsVisible:!1}}},Rt={class:"mt-2"},Et={class:"ml-2"},zt=Z({__name:"EquityCurve",props:{data:{}},setup(B){const d=Ue(),v=z(()=>d.value),f=S();let n=null,i=[];const c=B;J(c.data,$=>{}),J(v,$=>{y($)}),Ce(async()=>{await t()});async function t(){ze.width=f.value.clientWidth,n=_e(f.value,ze);for(const $ of c.data){const g=n.addLineSeries({lineWidth:2});g.setData($.data),i.push(g)}n.timeScale().fitContent(),y(v.value)}Oe(()=>{u()});function u(){n!==null&&(n.remove(),n=null),i&&(i=[])}function y($){n===null||i===null||n.applyOptions($==="light"?Lt.chart:jt.chart)}return($,g)=>(r(),m(q,null,[s("div",{ref_key:"chartContainer",ref:f,class:"rounded overflow-hidden border-2 border-gray-100 dark:border-gray-600"},null,512),s("div",Rt,[(r(!0),m(q,null,fe($.data,h=>(r(),m("span",{key:h.name,class:"text-xs mr-2 rounded bg-white dark:bg-gray-700 p-1"},[s("span",{class:"inline-block",style:Ge({backgroundColor:h.color,width:"25px",height:"10px"})},null,4),s("span",Et,_(h.name),1)]))),128))])],64))}}),Ut={class:"flex items-center justify-between"},Ot=Z({__name:"FullscreenModal",props:{modelValue:{type:Boolean,default:!1},modelModifiers:{}},emits:["update:modelValue"],setup(B){const d=$e(B,"modelValue");return(v,f)=>{const n=ye,i=Ze,c=Me;return r(),M(c,{modelValue:d.value,"onUpdate:modelValue":f[1]||(f[1]=t=>d.value=t),fullscreen:""},{default:E(()=>[a(i,{ui:{base:"h-full flex flex-col",rounded:"",divide:"divide-y divide-gray-100 dark:divide-gray-800",body:{base:"grow"}}},{header:E(()=>[s("div",Ut,[s("div",null,[Te(v.$slots,"title")]),a(n,{color:"gray",variant:"ghost",icon:"i-heroicons-x-mark-20-solid",class:"-my-1",onClick:f[0]||(f[0]=t=>d.value=!1)})])]),default:E(()=>[Te(v.$slots,"default")]),_:3})]),_:3},8,["modelValue"])}}}),Mt={class:"w-16 overflow-hidden"},Bt={class:"w-8 overflow-hidden"},Pt={key:0,class:"w-full transition-all overflow-hidden duration-300 bg-gray-50 dark:bg-gray-800"},Dt=["onClick"],Nt={class:"w-16 overflow-hidden text-center"},It={class:"w-12 overflow-hidden text-center"},Ft={class:"w-8 overflow-hidden text-center"},At={class:"p-4"},Wt={class:"mt-4"},qt={class:"w-full text-sm"},Ht={class:"w-full"},Yt={class:"w-full flex justify-between bg-gray-50 dark:bg-gray-800 py-2 px-4"},Jt={class:"w-full flex justify-between py-2 px-4"},Qt={class:"w-full flex justify-between bg-gray-50 dark:bg-gray-800 py-2 px-4"},Gt={class:"w-full flex justify-between py-2 px-4"},Zt={class:"w-full flex justify-between bg-gray-50 dark:bg-gray-800 py-2 px-4"},Xt={class:"w-full flex justify-between py-2 px-4"},Kt={class:"w-full flex justify-between bg-gray-50 dark:bg-gray-800 py-2 px-4"},es={class:"w-full flex justify-between py-2 px-4"},ts={class:"w-full flex justify-between bg-gray-50 dark:bg-gray-800 py-2 px-4"},ss={class:"w-full"},os={class:"w-full flex justify-between bg-gray-50 dark:bg-gray-800 py-2 px-4"},ls={class:"w-full flex justify-between py-2 px-4"},rs={class:"w-full flex justify-between bg-gray-50 dark:bg-gray-800 py-2 px-4"},as={key:0,class:"w-full flex justify-between py-2 px-4"},ns={key:1,class:"w-full flex justify-between bg-gray-50 dark:bg-gray-800 py-2 px-4"},is={key:2,class:"w-full flex justify-between py-2 px-4"},ds={class:"flex justify-end mt-4"},us=Z({__name:"ChartOrders",props:{trade:{}},emits:["zoom","hoverbg"],setup(B,{emit:d}){const v=d,f=S(null),n=S(!1),i=S(!1);return(c,t)=>{const u=Xe,y=ye,$=Me;return r(),m(q,null,[a(y,{variant:"ghost",color:"gray",class:"w-full flex justify-between hover:bg-gray-100 dark:hover:bg-gray-800 text-xs border-b border-gray-100 dark:border-gray-800 rounded-none p-2",onClick:t[1]||(t[1]=g=>i.value=!l(i)),onMouseover:t[2]||(t[2]=g=>v("hoverbg",c.trade.orders[0].id))},{default:E(()=>[s("div",{class:W(["w-2 transition-all duration-300",[l(i)?"rotate-90":"rotate-0"]])},t[5]||(t[5]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-4"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m8.25 4.5 7.5 7.5-7.5 7.5"})],-1)]),2),s("div",Mt,_(l(Y).roundPrice(c.trade.entry_price)),1),t[6]||(t[6]=s("div",{class:"w-1 opacity-20"},"|",-1)),s("div",{class:W(["w-16 overflow-hidden",c.trade.type.toLowerCase()==="long"?"text-green-500":"text-red-500"])},_(l(ie).round(c.trade.qty,2)),3),t[7]||(t[7]=s("div",{class:"w-1 opacity-20"},"|",-1)),s("div",{class:W([[c.trade.PNL_percentage>0?"text-green-500":"text-red-500"],"w-16 overflow-hidden text-xs"])},_(l(ie).round(c.trade.PNL_percentage,2))+"% ",3),t[8]||(t[8]=s("div",{class:"w-1 opacity-20"},"|",-1)),s("div",Bt,[a(y,{color:"gray",size:"xs",onClick:t[0]||(t[0]=Le(g=>v("zoom",c.trade.orders[0].id),["stop"]))},{default:E(()=>[a(u,{name:"i-heroicons-arrow-right"})]),_:1})])]),_:1}),l(i)?(r(),m("div",Pt,[t[13]||(t[13]=Be('<div class="flex justify-between items-center border-b-2 border-gray-200 dark:border-gray-700 px-1 py-2 text-xs"><div class="w-16 overflow-hidden italic font-bold uppercase text-center">PRICE</div><div class="w-1 opacity-20">|</div><div class="w-10 overflow-hidden italic font-bold uppercase text-center">QTY</div><div class="w-1 opacity-20">|</div><div class="w-12 overflow-hidden italic font-bold uppercase text-center">TYPE</div><div class="w-1 opacity-20">|</div><div class="w-10 overflow-hidden italic font-bold uppercase text-center">SIDE</div><div class="w-1 opacity-20">|</div><div class="w-8 overflow-hidden italic font-bold uppercase text-center"></div></div>',1)),(r(!0),m(q,null,fe(c.trade.orders,(g,h)=>(r(),m("div",{key:h,class:"w-full flex justify-between items-center hover:bg-gray-200 dark:hover:bg-gray-900 text-xs py-2 border-b border-gray-200 cursor-pointer dark:border-gray-700 px-1",onClick:w=>{f.value=g,n.value=!0}},[s("div",Nt,_(l(Y).roundPrice(g.price)),1),t[9]||(t[9]=s("div",{class:"w-1 opacity-20"},"|",-1)),s("div",{class:W(["w-10 overflow-hidden text-center",g.side==="buy"?"text-green-500":"text-red-500"])},_(l(ie).round(g.qty,2)),3),t[10]||(t[10]=s("div",{class:"w-1 opacity-20"},"|",-1)),s("div",It,_(g.type),1),t[11]||(t[11]=s("div",{class:"w-1 opacity-20"},"|",-1)),s("div",{class:W([[g.side==="buy"?"text-green-500":"text-red-500"],"w-10 overflow-hidden text-center"])},_(g.side.toUpperCase()),3),t[12]||(t[12]=s("div",{class:"w-1 opacity-20"},"|",-1)),s("div",Ft,[a(y,{color:"gray",size:"xs",onClick:Le(w=>v("zoom",g.id),["stop"])},{default:E(()=>[a(u,{name:"i-heroicons-arrow-right"})]),_:2},1032,["onClick"])])],8,Dt))),128))])):k("",!0),a($,{modelValue:l(n),"onUpdate:modelValue":t[4]||(t[4]=g=>ce(n)?n.value=g:null)},{default:E(()=>{var g,h,w,L,P,O,H,N,I,X,oe;return[s("div",At,[s("div",Wt,[s("div",qt,[t[29]||(t[29]=s("h2",{class:"text-lg mb-2 font-bold italic dark:text-white text-center"}," Trade ",-1)),s("div",Ht,[s("div",Yt,[t[14]||(t[14]=s("div",{class:"font-bold"},"Entry Price",-1)),s("div",null,_(l(Y).roundPrice(c.trade.entry_price)),1)]),s("div",Jt,[t[15]||(t[15]=s("div",{class:"font-bold"},"Exit Price",-1)),s("div",null,_(l(Y).roundPrice(c.trade.exit_price)),1)]),s("div",Qt,[t[16]||(t[16]=s("div",{class:"font-bold"},"Qty",-1)),s("div",null,_(c.trade.qty),1)]),s("div",Gt,[t[17]||(t[17]=s("div",{class:"font-bold"},"Size",-1)),s("div",null,_(l(Y).roundPrice(c.trade.size)),1)]),s("div",Zt,[t[18]||(t[18]=s("div",{class:"font-bold"},"PNL",-1)),s("div",{class:W([c.trade.PNL>0?"text-green-500":"text-red-500"])},_(l(ie).round(c.trade.PNL,2))+" ("+_(l(ie).round(c.trade.PNL_percentage,2))+"%) ",3)]),s("div",Xt,[t[19]||(t[19]=s("div",{class:"font-bold"},"Fee",-1)),s("div",null,_(l(ie).round(c.trade.fee,2)),1)]),s("div",Kt,[t[20]||(t[20]=s("div",{class:"font-bold"},"Holding Period",-1)),s("div",null,_(l(Y).secondsToHumanReadable(c.trade.holding_period)),1)]),s("div",es,[t[21]||(t[21]=s("div",{class:"font-bold"},"Opened At",-1)),s("div",null,_(new Date(c.trade.opened_at).toLocaleString()),1)]),s("div",ts,[t[22]||(t[22]=s("div",{class:"font-bold"},"Closed At",-1)),s("div",null,_(new Date(c.trade.closed_at).toLocaleString()),1)])]),t[30]||(t[30]=s("h2",{class:"text-lg font-bold italic dark:text-white mt-6 mb-2 text-center"}," Order ",-1)),s("div",ss,[s("div",os,[t[23]||(t[23]=s("div",{class:"font-bold"},"Side",-1)),s("div",{class:W([((g=l(f))==null?void 0:g.side)==="buy"?"text-green-500":"text-red-500"])},_((w=(h=l(f))==null?void 0:h.side)==null?void 0:w.toUpperCase()),3)]),s("div",ls,[t[24]||(t[24]=s("div",{class:"font-bold"},"Type",-1)),s("div",null,_((L=l(f))==null?void 0:L.type),1)]),s("div",rs,[t[25]||(t[25]=s("div",{class:"font-bold"},"Qty",-1)),s("div",null,_((P=l(f))==null?void 0:P.qty),1)]),(O=l(f))!=null&&O.created_at?(r(),m("div",as,[t[26]||(t[26]=s("div",{class:"font-bold"},"Created At",-1)),s("div",null,_(new Date((H=l(f))==null?void 0:H.created_at).toLocaleString()),1)])):k("",!0),(N=l(f))!=null&&N.executed_at?(r(),m("div",ns,[t[27]||(t[27]=s("div",{class:"font-bold"},"Executed At",-1)),s("div",null,_(new Date((I=l(f))==null?void 0:I.executed_at).toLocaleString()),1)])):k("",!0),(X=l(f))!=null&&X.canceled_at?(r(),m("div",is,[t[28]||(t[28]=s("div",{class:"font-bold"},"Canceled At",-1)),s("div",null,_(new Date((oe=l(f))==null?void 0:oe.canceled_at).toLocaleString()),1)])):k("",!0)])]),s("div",ds,[a(y,{color:"gray",block:"",onClick:t[3]||(t[3]=me=>n.value=!1)},{default:E(()=>t[31]||(t[31]=[ke(" Close ")])),_:1})])])])]}),_:1},8,["modelValue"])],64)}}}),cs={class:"w-0 sidebar whitespace-nowrap relative transition-all duration-300"},fs={key:1,class:"h-full flex justify-center items-center text-xs text-gray-500"},ms=Z({__name:"ChartSidebar",props:xe({items:{}},{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:xe(["zoom","hoverbg"],["update:modelValue"]),setup(B,{emit:d}){const v=$e(B,"modelValue"),f=d;return(n,i)=>{const c=us;return r(),m("div",cs,[s("div",{class:W([v.value?"w-96 p-2":"w-0 p-0","absolute h-full overflow-y-auto border-r-2 dark:border-gray-800 transition-all duration-300 z-0"])},[n.items.length>0?(r(),m(q,{key:0},[i[2]||(i[2]=Be('<div class="flex justify-between items-center border-b-2 p-2 text-xs dark:border-gray-800"><div class="w-2"></div><div class="w-16 overflow-hidden italic font-bold uppercase text-center">ENTRY</div><div class="w-1 opacity-20">|</div><div class="w-16 overflow-hidden italic font-bold uppercase text-center">QTY</div><div class="w-1 opacity-20">|</div><div class="w-16 overflow-hidden italic font-bold uppercase text-center">PNL</div><div class="w-1 opacity-20">|</div><div class="w-8 overflow-hidden italic font-bold uppercase text-center"></div></div>',1)),(r(!0),m(q,null,fe(n.items,(t,u)=>(r(),m("div",{key:u,class:"w-full"},[a(c,{trade:t,onZoom:i[0]||(i[0]=y=>f("zoom",y)),onHoverbg:i[1]||(i[1]=y=>f("hoverbg",y))},null,8,["trade"])]))),128))],64)):(r(),m("div",fs," No trades were executed "))],2)])}}}),ps={class:"w-full h-full flex justify-between border-2 border-gray-200 dark:border-gray-800 rounded-lg"},vs={class:"w-full flex flex-col h-full border dark:border-gray-800"},gs={key:0},bs=Z({__name:"BacktestCandlesChart",props:xe({form:{},results:{}},{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:["update:modelValue"],setup(B){const d=Ue(),v=S(2),f=$e(B,"modelValue"),n=B,i=S(),c=S([]);let t=null,u=null;const y=[],$=[],g=z(()=>Pe().params.id),h=z(()=>G.extraChartLines[g.value].find(b=>b.symbol===n.results.selectedRoute.symbol)),w=z(()=>d.value),L=z(()=>he());J(w,b=>{X(b)}),J(()=>n.results.selectedRoute.symbol,()=>{I(),setTimeout(async()=>{await P()},100)}),Ce(async()=>{setTimeout(async()=>{await P()},200)}),J(f,()=>{setTimeout(()=>{O()},300)});async function P(){var le,re,ee,D;be.width=i.value.clientWidth,be.height=i.value.clientHeight-Object.keys(h.value.charts).length*150,t=_e(i.value,be),t.applyOptions({rightPriceScale:{borderColor:w.value==="light"?"#d1d4dc":"#4b5563",minimumWidth:80},watermark:{visible:!0,fontSize:16,horzAlign:"left",vertAlign:"bottom",color:"#888",text:`${n.results.selectedRoute.symbol} • ${n.results.selectedRoute.timeframe}`}}),u=t.addCandlestickSeries();const b=G.candles[g.value].find(V=>V.symbol===n.results.selectedRoute.symbol).candles;u.setData(b),u.setMarkers(G.orders[g.value].find(V=>V.symbol===n.results.selectedRoute.symbol).orders);const x=String(b[0].open).indexOf("."),C=x===-1?0:String(b[b.length-1].open).length-x-1;v.value!==C&&(v.value=C,(v.value<0||v.value>100)&&(v.value=0),u.applyOptions({priceFormat:{type:"price",precision:v.value,minMove:Math.pow(10,-v.value).toFixed(v.value)}}));const R=(re=(le=G.lines[g.value])==null?void 0:le.find(V=>V.symbol===n.results.selectedRoute.symbol))==null?void 0:re.lines;if(R)for(const V of Object.keys(R)){const e=R[V];t.addLineSeries({lineWidth:1,title:V}).setData(e.data)}const T=(D=(ee=G.horizontalLines[g.value])==null?void 0:ee.find(V=>V.symbol===n.results.selectedRoute.symbol))==null?void 0:D.lines;if(T)for(const V of Object.keys(T)){const o=T[V];u.createPriceLine(o)}t.timeScale().fitContent();const K=new Set;Object.keys(h.value.charts).forEach((V,e)=>{const o={...be};o.width=c.value[e].clientWidth,o.height=150;const U=_e(c.value[e],o);y.push(U),Object.keys(h.value.charts[V]).forEach(F=>{var j,pe;const A=U.addLineSeries({lineWidth:1,title:F}),Q=(pe=(j=G.horizontalExtraLines[g.value])==null?void 0:j.find(ae=>ae.symbol===n.results.selectedRoute.symbol))==null?void 0:pe.lines[V];if(Q&&!K.has(V)){for(const ae of Object.keys(Q)){const ve=Q[ae];A.createPriceLine(ve)}K.add(V)}A.setData(h.value.charts[V][F].data),$.push(A)}),U.applyOptions({rightPriceScale:{borderColor:w.value==="light"?"#d1d4dc":"#4b5563",minimumWidth:80},watermark:{visible:!0,fontSize:16,horzAlign:"left",vertAlign:"bottom",color:"#888",text:V}}),U.timeScale().subscribeVisibleLogicalRangeChange(F=>{t.timeScale().setVisibleLogicalRange(F)}),e!==Object.keys(h.value.charts).length-1&&U.timeScale().applyOptions({visible:!1})}),t.subscribeCrosshairMove(V=>{const e=H(u,V);Object.keys(h.value.charts).forEach((o,U)=>{N(y[U],$[U],e)})}),Object.keys(h.value.charts).forEach((V,e)=>{y[e].subscribeCrosshairMove(o=>{const U=H($[e],o);N(t,u,U),y.forEach((F,A)=>{A!==e&&N(F,$[A],U)})})}),t.timeScale().subscribeVisibleLogicalRangeChange(V=>{y.forEach(e=>{e.timeScale().setVisibleLogicalRange(V)})}),X(w.value),y.length>0&&t.timeScale().applyOptions({visible:!1})}function O(){var b;t!==null&&(t.applyOptions({width:(b=i.value)==null?void 0:b.clientWidth}),y.forEach(x=>{var C;x.applyOptions({width:(C=i.value)==null?void 0:C.clientWidth})}))}Oe(()=>{I()});function H(b,x){return x.time&&x.seriesData.get(b)||null}function N(b,x,C){if(C){b.setCrosshairPosition(C.value,C.time,x);return}b.clearCrosshairPosition()}function I(){t!==null&&(t.remove(),t=null),u!==null&&(u=null),y.length>0&&(y.forEach(b=>{b.remove()}),y.length=0),$.length>0&&($.length=0)}function X(b){t!==null&&(t.applyOptions(b==="light"?Re.chart:Ee.chart),y.forEach(x=>{x.applyOptions(b==="light"?Re.chart:Ee.chart)}))}function oe(b){const x=G.orders[g.value].find(R=>R.symbol===n.results.selectedRoute.symbol).orders,C=x.find(R=>R.order_id===b);if(C&&t){const R=(typeof C.time=="number",C.time),T=t.timeScale(),K=x[1].time-x[0].time,le=R-K*5,re=R+K*5,ee=C.color;u==null||u.setMarkers(x.map(D=>D.order_id===b?{...D,color:"#FFA500"}:D)),T.setVisibleRange({from:le,to:re}),setTimeout(()=>{u==null||u.setMarkers(x.map(D=>D.order_id===b?{...D,color:ee}:D))},2e3)}}function me(b){const x=G.orders[g.value].find(R=>R.symbol===n.results.selectedRoute.symbol).orders,C=x.find(R=>R.order_id===b);if(C&&t){const R=C.color;u==null||u.setMarkers(x.map(T=>T.order_id===b?{...T,color:"#FFA500"}:T)),setTimeout(()=>{u==null||u.setMarkers(x.map(T=>T.order_id===b?{...T,color:R}:T))},2e3)}}function he(){return n.results.trades.filter(b=>b.symbol===n.results.selectedRoute.symbol)}return(b,x)=>(r(),m("div",ps,[a(ms,{modelValue:f.value,"onUpdate:modelValue":x[0]||(x[0]=C=>f.value=C),items:l(L),onHoverbg:x[1]||(x[1]=C=>me(C)),onZoom:x[2]||(x[2]=C=>oe(C))},null,8,["modelValue","items"]),s("div",{class:W([[f.value?"w-[calc(100%-384px)]":"w-full"],"h-full transition-all duration-300"])},[s("div",vs,[s("div",{ref_key:"chartContainer",ref:i,class:"rounded overflow-hidden flex-grow"},null,512),l(h)&&Object.keys(l(h).charts).length?(r(),m("div",gs,[(r(!0),m(q,null,fe(Object.keys(l(h).charts),C=>(r(),m("div",{key:C,ref_for:!0,ref_key:"extraChartsRef",ref:c,class:"relative border-t-[1.5px] dark:border-gray-800"}))),128))])):k("",!0)])],2)]))}}),ys={key:0,class:"flex flex-col items-center justify-center select-none mt-[10%]"},hs=["textContent"],ws={class:"mt-8"},ks={class:"mt-8"},xs={key:0,class:"mt-4"},_s={key:1,class:"mx-auto container mt-8"},Cs={key:0},$s={class:"mb-4 mt-4"},Vs={class:"flex items-center select-none flex-1 my-4"},Ss={class:"grid grid-cols-1 gap-6 mt-8"},Ts={key:1,class:"w-full mx-auto"},Ls={key:4,class:"text-yellow-500 border-yellow-400 bg-yellow-50 dark:bg-gray-700 dark:text-yellow-400 mt-16 text-center text-2xl rounded border-2 border-dashed dark:border-gray-800 py-16 select-none"},js={class:"flex justify-start"},Rs={key:0},Es={key:0},zs=["href"],Us=["href"],Os=["href"],Ms={key:5,class:"my-4"},Bs={key:1},Ps=Z({__name:"BacktestTab",props:{form:{},results:{}},setup(B){const d=B,v=S(!1),f=S(!0),n=S(!1),i=S([]),c=S([]),t=S(!1),u=S(!1),y=ge().authToken,$=S(je().public.apiBaseUrl),g=S(!1),h=z(()=>Pe().params.id),w=De(),L=ge(),P=Ke(),O=S([]),H=z(()=>L.jesseSupportedTimeframes.map(e=>({label:e,value:e}))),N=z(()=>d.form.routes.map(e=>({label:`${e.strategy} • ${e.symbol}`,value:e})));d.results.selectedRoute=d.form.routes[0],Ce(async()=>{await L.initiate(),!d.form.exchange&&L.backtestingExchangeNames.length&&(d.form.exchange=L.backtestingExchangeNames[0]),(!d.results.showResults&&d.form.exchange||!O.value.length)&&await I()});async function I(){if(d.form.exchange)try{O.value=await L.getExchangeSupportedSymbols(d.form.exchange);for(let e=0;e<d.form.routes.length;e++)O.value.includes(d.form.routes[e].symbol)||(d.form.routes[e].symbol=O.value[0]);if(d.form.data_routes.length>0)for(let e=0;e<d.form.data_routes.length;e++)O.value.includes(d.form.data_routes[e].symbol)||(d.form.data_routes[e].symbol=O.value[0])}catch(e){console.error("Error updating supported symbols:",e)}}J(()=>d.form.exchange,async(e,o)=>{e!==o&&(O.value=[],await I())});const{cancel:X,newBacktest:oe}=w;function me(e){if(c.value.length){for(let o=0;o<c.value.length;o++)se("error",c.value[o]);return}i.value=[],w.start(e)}function he(e){i.value=[],w.rerun(e)}const b=e=>{if(c.value.length){for(let o=0;o<c.value.length;o++)se("error",c.value[o]);return}i.value=[],w.startInNewTab(e)},x=z(()=>{let e=`/download/backtest/tradingview/${d.results.generalInfo.session_id}?token=${y}`;return $.value!=="/"&&(e=$.value+e),e});z(()=>{let e=`/download/backtest/full-reports/${d.results.generalInfo.session_id}?token=${y}`;return $.value!=="/"&&(e=$.value+e),e});const C=z(()=>{let e=`/download/backtest/csv/${d.results.generalInfo.session_id}?token=${y}`;return $.value!=="/"&&(e=$.value+e),e}),R=z(()=>{let e=`/download/backtest/json/${d.results.generalInfo.session_id}?token=${y}`;return $.value!=="/"&&(e=$.value+e),e}),T=z(()=>w.formattedMetrics(h.value).length>0),K=z(()=>Y.remainingTimeText(d.results.progressbar.estimated_remaining_seconds));function le(){try{i.value.length>1e6&&se("success","Copying large log file, please wait..."),setTimeout(()=>{navigator.clipboard.writeText(i.value.join(`
`)),se("success","Logs copied successfully"),u.value=!0,setTimeout(()=>{u.value=!1},3e3)},0)}catch{se("error","Failed to copy logs")}}J(()=>d.form.start_date,e=>{d.form.finish_date<e&&(d.form.finish_date=e)});async function re(){const e=w.missingCandlesErrors[h.value];e&&(P.forms.push({id:Y.uuid(),exchange:e.exchange,symbol:e.symbol,start_date:e.start_date,executing:!1,waiting:!1,progressbar:{current:0,estimated_remaining_seconds:0},exception:{error:"",traceback:""},alert:{message:"",type:""}}),await it("/candles/"),await P.start(P.forms[P.forms.length-1].id))}async function ee(){i.value.length===0?await D():n.value=!0}async function D(){v.value=!0;try{const{data:e,error:o}=await dt(`/logs/backtest/${h.value}?token=${y}`,!1);if(o.value){se("error",o.value.message),v.value=!1;return}const U=e.value;setTimeout(()=>{const A=Y.decompressData(U.content).split(`
`).map(Q=>{const j=Q.match(/\[INFO \| (.*?)\] (.*)/);return j?`[${j[1]}] ${j[2]}`:Q});i.value=A,v.value=!1,n.value=!0},0)}catch{se("error","Failed to fetch logs"),v.value=!1}}async function V(){const e=je().public.apiBaseUrl,o=ge().authToken,U=`${e}/download/backtest/log/${h.value}?token=${o}`;window.open(U,"_blank")}return(e,o)=>{const U=Tt,F=et,A=ot,Q=mt,j=ye,pe=pt,ae=yt,ne=rt,ve=ht,Ne=gt,Ve=at,te=nt,Ie=zt,Se=lt,Fe=Ot,we=kt,Ae=wt,We=vt,qe=bt;return r(),m(q,null,[a(A,{modelValue:l(n),"onUpdate:modelValue":o[0]||(o[0]=p=>ce(n)?n.value=p:null),title:"Logs"},{default:E(()=>[a(U,{logs:l(i)},null,8,["logs"])]),buttons:E(()=>[a(F,{text:"Copy",class:"inline-block",popper:{arrow:!0}},{default:E(()=>[s("button",{class:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full text-gray-400 hover:text-gray-500 dark:hover:text-gray-300 focus:outline-none",onClick:le},[l(u)?(r(),M(l(tt),{key:0,class:"h-6 w-6","aria-hidden":"true"})):k("",!0),!l(u)&&l(i).length!=0?(r(),M(l(ft),{key:1,class:"h-6 w-6","aria-hidden":"true"})):k("",!0)])]),_:1}),a(F,{text:"Download",class:"inline-block ml-2",popper:{arrow:!0}},{default:E(()=>[s("button",{class:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full text-gray-400 hover:text-gray-500 dark:hover:text-gray-300 focus:outline-none",onClick:V},[l(i).length!=0?(r(),M(l(st),{key:0,class:"h-6 w-6","aria-hidden":"true"})):k("",!0)])]),_:1})]),_:1},8,["modelValue"]),e.results.executing&&!e.results.showResults?(r(),m("div",ys,[s("div",null,[a(Q,{progress:e.results.progressbar.current},null,8,["progress"])]),e.results.exception.error?k("",!0):(r(),m("h3",{key:0,class:"mt-8 animate-pulse",textContent:_(l(K))},null,8,hs)),s("div",ws,[s("div",ks,[a(j,{color:"gray",ui:{color:{gray:{solid:"text-rose-500 dark:text-rose-400"}}},class:"w-64 flex justify-center",icon:"i-heroicons-no-symbol",size:"xl",variant:"solid",label:"Cancel",trailing:!1,onClick:o[1]||(o[1]=p=>l(X)((e._.provides[ue]||e.$route).params.id))})]),e.form.debug_mode&&e.results.exception.error?(r(),m("div",xs,[a(j,{icon:"i-heroicons-clipboard-document-list",label:"Debugging Logs",color:"gray",size:"xl",variant:"solid",trailing:!1,loading:l(v),class:"w-64 flex justify-center",onClick:ee},null,8,["loading"])])):k("",!0)]),e.results.exception.error&&e.results.executing?(r(),m("div",_s,[a(pe,{modelValue:l(t),"onUpdate:modelValue":o[2]||(o[2]=p=>ce(t)?t.value=p:null),title:e.results.exception.error,content:e.results.exception.traceback,mode:"backtest","debug-mode":e.form.debug_mode},null,8,["modelValue","title","content","debug-mode"])])):k("",!0)])):k("",!0),a(qe,null,{left:E(()=>[!e.results.executing&&!e.results.showResults?(r(),m("div",Cs,[l(w).missingCandlesErrors[l(h)]?(r(),M(ae,{key:0,icon:"i-heroicons-exclamation-triangle",color:"rose",variant:"soft",class:"mb-4"},{title:E(()=>o[24]||(o[24]=[s("h3",{class:"text-lg font-semibold"},"Missing Required Warmup Candles",-1)])),description:E(()=>[s("p",$s,[o[25]||(o[25]=ke(" Your strategy requires ")),o[26]||(o[26]=s("strong",{class:"font-bold"},"warmup candles",-1)),ke(' for "'+_(l(w).missingCandlesErrors[l(h)].symbol)+'" on "'+_(l(w).missingCandlesErrors[l(h)].exchange)+'" starting from "'+_(l(w).missingCandlesErrors[l(h)].start_date)+'". These candles are needed for proper strategy initialization. ',1)]),a(j,{label:"Import Required Candles",icon:"i-heroicons-arrow-down-tray",onClick:re})]),_:1})):k("",!0),a(ne,{class:"mb-4",title:"Exchange"}),a(ve,{modelValue:e.form.exchange,"onUpdate:modelValue":o[3]||(o[3]=p=>e.form.exchange=p),placeholder:"Select an exchange...",searchable:"",options:l(ge)().backtestingExchangeNames,size:"lg",class:"mt-2 mb-16"},null,8,["modelValue","options"]),a(Ne,{"total-routes-error":l(c),timeframes:l(H),form:e.form,results:e.results,symbols:l(O),mode:"backtest"},null,8,["total-routes-error","timeframes","form","results","symbols"]),a(ne,{class:"mt-16",title:"Duration"}),s("div",Vs,[a(Ve,{modelValue:e.form.start_date,"onUpdate:modelValue":o[4]||(o[4]=p=>e.form.start_date=p),type:"date",variant:"outline",size:"lg",class:"w-full mr-2"},null,8,["modelValue"]),a(Ve,{modelValue:e.form.finish_date,"onUpdate:modelValue":o[5]||(o[5]=p=>e.form.finish_date=p),type:"date",variant:"outline",size:"lg",class:"w-full ml-2"},null,8,["modelValue"])]),a(ne,{class:"mt-16",title:"Options"}),s("div",Ss,[a(te,{modelValue:e.form.debug_mode,"onUpdate:modelValue":o[6]||(o[6]=p=>e.form.debug_mode=p),title:"Debug Mode",description:"Logs every step of the execution. Very helpful for debugging your strategy but takes a lot longer to execute"},null,8,["modelValue"]),a(te,{modelValue:e.form.export_chart,"onUpdate:modelValue":o[7]||(o[7]=p=>e.form.export_chart=p),title:"Generate Interactive Charts",description:"Generate interactive charts for backtest results with details."},null,8,["modelValue"]),a(te,{modelValue:e.form.export_tradingview,"onUpdate:modelValue":o[8]||(o[8]=p=>e.form.export_tradingview=p),title:"Export Tradingview",description:"Exports the executed trades in a format accepted by TradingView's Pine Editor. Useful to look at the executed orders on their chart."},null,8,["modelValue"]),a(te,{modelValue:e.form.export_csv,"onUpdate:modelValue":o[9]||(o[9]=p=>e.form.export_csv=p),title:"Export CSV",description:"Exports executed trades in a CSV format"},null,8,["modelValue"]),a(te,{modelValue:e.form.export_json,"onUpdate:modelValue":o[10]||(o[10]=p=>e.form.export_json=p),title:"Export JSON",description:"Exports executed trades in a JSON format"},null,8,["modelValue"]),a(te,{modelValue:e.form.fast_mode,"onUpdate:modelValue":o[11]||(o[11]=p=>e.form.fast_mode=p),title:"Fast Mode",description:"Runs the backtest faster by using an improved algorithm. This is supposed to yield the same results; however, it's currently experimental, which is why it's an option."},null,8,["modelValue"]),a(te,{modelValue:e.form.benchmark,"onUpdate:modelValue":o[12]||(o[12]=p=>e.form.benchmark=p),title:"Benchmark",description:"If enabled, the backtest will compare the performance of the strategy against the buy and hold strategy of the market."},null,8,["modelValue"])])])):k("",!0),e.results.showResults?(r(),m("div",Ts,[s("div",null,[l(T)?(r(),M(ne,{key:0,class:"mb-4",title:"Equity Curve"})):k("",!0),l(T)?(r(),M(Ie,{key:1,data:e.results.charts.equity_curve},null,8,["data"])):k("",!0),l(T)?(r(),M(ne,{key:2,class:"mt-16 mb-4",title:"Performance"})):k("",!0),l(T)?(r(),M(Se,{key:3,data:l(w).formattedMetrics(l(h))},null,8,["data"])):k("",!0),l(T)?k("",!0):(r(),m("div",Ls," No trades were executed via this strategy! "))]),a(Fe,{modelValue:l(g),"onUpdate:modelValue":o[16]||(o[16]=p=>ce(g)?g.value=p:null)},{title:E(()=>[s("div",js,[a(ve,{modelValue:e.results.selectedRoute,"onUpdate:modelValue":o[13]||(o[13]=p=>e.results.selectedRoute=p),"value-attribute":"value",options:l(N)},null,8,["modelValue","options"]),a(j,{class:"ml-2",color:"gray",label:l(f)?"Hide Trades":"Show Trades",onClick:o[14]||(o[14]=p=>f.value=!l(f))},null,8,["label"])])]),default:E(()=>[a(bs,{modelValue:l(f),"onUpdate:modelValue":o[15]||(o[15]=p=>ce(f)?f.value=p:null),results:e.results,form:e.form},null,8,["modelValue","results","form"])]),_:1},8,["modelValue"])])):k("",!0)]),right:E(()=>[e.results.executing?k("",!0):(r(),m("div",Rs,[e.results.showResults?(r(),m("div",Es,[a(j,{class:"w-full flex justify-center",icon:"i-heroicons-arrow-path",size:"xl",variant:"solid",label:"Rerun",trailing:!1,onClick:o[17]||(o[17]=p=>he((e._.provides[ue]||e.$route).params.id))}),a(j,{class:"w-full flex justify-center mt-4",color:"green",icon:"i-heroicons-arrow-uturn-left",size:"xl",variant:"solid",label:"New session",trailing:!1,onClick:o[18]||(o[18]=p=>l(oe)((e._.provides[ue]||e.$route).params.id))}),e.form.debug_mode?(r(),M(j,{key:0,class:"w-full flex justify-center mt-4",color:"gray",icon:"i-heroicons-clipboard-document-list",size:"xl",variant:"solid",label:"Debugging Logs",loading:l(v),trailing:!1,onClick:o[19]||(o[19]=p=>ee())},null,8,["loading"])):k("",!0),e.form.export_chart?(r(),M(j,{key:1,class:"mt-4 flex justify-center items-center btn-secondary text-center",color:"gray",icon:"i-heroicons-chart-bar",size:"xl",block:"",variant:"solid",label:"View charts",trailing:!1,onClick:o[20]||(o[20]=p=>g.value=!0)})):k("",!0),e.form.export_csv&&l(T)?(r(),m("a",{key:2,href:l(C),target:"_blank",class:"flex justify-center items-center btn-secondary text-center w-full"},[a(j,{class:"w-full flex justify-center mt-4",color:"gray",icon:"i-heroicons-document-arrow-down",size:"xl",variant:"solid",label:"CSV",trailing:!1})],8,zs)):k("",!0),e.form.export_json&&l(T)?(r(),m("a",{key:3,href:l(R),target:"_blank",class:"flex justify-center items-center btn-secondary text-center w-full"},[a(j,{class:"w-full flex justify-center mt-4",color:"gray",icon:"i-heroicons-document-arrow-down",size:"xl",variant:"solid",label:"JSON",trailing:!1})],8,Us)):k("",!0),e.form.export_tradingview&&l(T)?(r(),m("a",{key:4,href:l(x),target:"_blank",class:"flex justify-center items-center btn-secondary text-center mb-4 w-full"},[a(j,{class:"w-full flex justify-center mt-4",color:"gray",icon:"i-heroicons-document-arrow-down",size:"xl",variant:"solid",label:"TradingView Pine Editor",trailing:!1})],8,Os)):k("",!0),e.results.showResults&&e.results.alert&&e.results.alert.message?(r(),m("div",Ms,[a(ae,{color:"teal",icon:"i-heroicons-check-circle",variant:"soft",title:e.results.alert.message,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"white",variant:"link"},onClose:o[21]||(o[21]=p=>e.results.alert.message="")},null,8,["title"])])):k("",!0),a(we,{class:"mt-8 mb-4",size:"lg",label:"General Info"}),a(Ae,{data:e.results.info},null,8,["data"]),a(we,{class:"mt-8 mb-4",size:"lg",label:"Routes"}),a(We,{data:e.results.routes_info,"header-items":["Symbol","Timeframe","Strategy"],header:""},null,8,["data"]),e.results.hyperparameters.length?(r(),M(we,{key:6,class:"mt-8 mb-4",size:"lg",label:"Hyperparameters"})):k("",!0),e.results.hyperparameters.length?(r(),M(Se,{key:7,data:e.results.hyperparameters},null,8,["data"])):k("",!0)])):(r(),m("div",Bs,[a(j,{class:"w-full flex justify-center",icon:"i-heroicons-bolt",size:"xl",variant:"solid",label:"Start",trailing:!1,onClick:o[22]||(o[22]=p=>me((e._.provides[ue]||e.$route).params.id))}),a(j,{class:"w-full flex justify-center mt-4",color:"gray",icon:"i-heroicons-plus",size:"xl",variant:"solid",label:"Start in a new tab",trailing:!1,onClick:o[23]||(o[23]=p=>b((e._.provides[ue]||e.$route).params.id))})]))]))]),_:1})],64)}}}),Ds={class:"w-full"},Gs=Z({__name:"[id]",setup(B){xt({title:"Backtest - Jesse"});const d=De(),v=z(()=>d.tabs),f=z(()=>ut().params.id),n=z(()=>{if(!v.value[f.value]){const i=Object.keys(v.value);if(i.length>0){const c=v.value[i[0]];return ct().push(`/backtest/${c.id}`),c}}return v.value[f.value]});return Object.keys(v.value).length===0&&d.addTab(),(i,c)=>{const t=He,u=Ps;return r(),m(q,null,[s("div",Ds,[a(t,{"current-tab":n.value?n.value.id:null,tabs:v.value,mode:"backtest",onClose:l(d).closeTab,onCancel:l(d).cancel},null,8,["current-tab","tabs","onClose","onCancel"])]),n.value?(r(),M(u,{key:0,form:n.value.form,results:n.value.results},null,8,["form","results"])):k("",!0)],64)}}});export{Gs as default};
