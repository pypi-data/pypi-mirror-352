import{r,E as K,_ as X,n as k,aR as lt,al as ut,cr as ct,M as J,cC as I,J as f,z as F,j as c,bt as dt,bG as pt,bu as ft,bd as bt,bv as mt,bq as G}from"./index.BsNfwsty.js";import{s as gt}from"./sprintf.C-r3gIuM.js";import{u as yt}from"./uniqueId.CnsyoqOK.js";import{u as It}from"./FormClearHelper.DnEPNkTs.js";import{I as ht}from"./InputInstructions.D5tQ1oer.js";import{I as Ct}from"./input.DRkDMUqN.js";import"./base-input.e4qNCPWg.js";var Q=r.forwardRef(function(t,e){var o={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return r.createElement(K,X({iconAttrs:o,iconVerticalAlign:"middle",iconViewBox:"0 0 8 8"},t,{ref:e}),r.createElement("path",{d:"M0 3v2h8V3H0z"}))});Q.displayName="Minus";var Y=r.forwardRef(function(t,e){var o={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return r.createElement(K,X({iconAttrs:o,iconVerticalAlign:"middle",iconViewBox:"0 0 8 8"},t,{ref:e}),r.createElement("path",{d:"M3 0v3H0v2h3v3h2V5h3V3H5V0H3z"}))});Y.displayName="Plus";const Tt=k("div",{target:"e1izef4y0"})(({theme:t})=>({display:"flex",flexDirection:"row",flexWrap:"nowrap",alignItems:"center",height:t.sizes.minElementHeight,borderWidth:t.sizes.borderWidth,borderStyle:"solid",borderColor:t.colors.widgetBorderColor??t.colors.bgColor,transitionDuration:"200ms",transitionProperty:"border",transitionTimingFunction:"cubic-bezier(0.2, 0.8, 0.4, 1)",borderRadius:t.radii.default,overflow:"hidden","&.focused":{borderColor:t.colors.primary},input:{MozAppearance:"textfield","&::-webkit-inner-spin-button, &::-webkit-outer-spin-button":{WebkitAppearance:"none",margin:t.spacing.none}}})),wt=k("div",{target:"e1izef4y1"})({display:"flex",flexDirection:"row",alignSelf:"stretch"}),M=k("button",{target:"e1izef4y2"})(({theme:t})=>({margin:t.spacing.none,border:"none",height:t.sizes.full,display:"flex",alignItems:"center",width:t.sizes.numberInputControlsWidth,justifyContent:"center",color:t.colors.bodyText,transition:"color 300ms, backgroundColor 300ms",backgroundColor:t.colors.secondaryBg,"&:hover:enabled, &:focus:enabled":{color:t.colors.white,backgroundColor:t.colors.primary,transition:"none",outline:"none"},"&:active":{outline:"none",border:"none"},"&:last-of-type":{borderTopRightRadius:t.radii.default,borderBottomRightRadius:t.radii.default},"&:disabled":{cursor:"not-allowed",color:t.colors.fadedText40}})),vt=k("div",{target:"e1izef4y3"})(({theme:t,clearable:e})=>({position:"absolute",marginRight:t.spacing.twoXS,left:0,right:`calc(${t.sizes.numberInputControlsWidth} * 2 + ${e?"1em":"0em"})`})),St=ut.getLogger("NumberInput");function Vt(t){return f(t)||t===""?void 0:t}const xt=t=>(t.element.dataType===I.DataType.INT?t.widgetMgr.getIntValue(t.element):t.widgetMgr.getDoubleValue(t.element))??t.element.default??null,q=({step:t,dataType:e})=>t||(e===I.DataType.INT?1:.01),W=({value:t,format:e,step:o,dataType:h})=>{if(f(t))return null;let a=Vt(e);if(f(a)&&J(o)){const l=o.toString();h===I.DataType.FLOAT&&o!==0&&l.includes(".")&&(a=`%0.${l.split(".")[1].length}f`)}if(f(a))return t.toString();try{return gt.sprintf(a,t)}catch(l){return St.warn(`Error in sprintf(${a}, ${t}): ${l}`),String(t)}},kt=(t,e,o)=>f(t)?!1:t-e>=o,Rt=(t,e,o)=>f(t)?!1:t+e<=o,Dt=({disabled:t,element:e,widgetMgr:o,width:h,theme:a,fragmentId:l})=>{var j;const{dataType:w,id:R,formId:p,default:B,format:U}=e,b=e.hasMin?e.min:-1/0,m=e.hasMax?e.max:1/0,[i,Z]=r.useState(q(e)),A=xt({element:e,widgetMgr:o}),[g,C]=r.useState(!1),[s,T]=r.useState(A),[H,v]=r.useState(W({value:A,...e,step:i})),[P,$]=r.useState(!1),D=r.useRef(null),L=r.useRef(yt("number_input_")),S=kt(s,i,b),V=Rt(s,i,m),O=ct({formId:p}),tt=O?o.allowFormEnterToSubmit(p):g,et=P&&h>a.breakpoints.hideWidgetDetails;r.useEffect(()=>{Z(q({step:e.step,dataType:e.dataType}))},[e.dataType,e.step]);const u=r.useCallback(({value:n,source:d})=>{var y;if(J(n)&&(b>n||n>m))(y=D.current)==null||y.reportValidity();else{const x=n??B??null;switch(w){case I.DataType.INT:o.setIntValue({id:R,formId:p},x,d,l);break;case I.DataType.FLOAT:o.setDoubleValue({id:R,formId:p},x,d,l);break;default:throw new Error("Invalid data type")}C(!1),T(x),v(W({value:x,dataType:w,format:U,step:i}))}},[b,m,D,o,l,i,w,R,p,B,U]),rt=r.useCallback(()=>{g&&u({value:s,source:{fromUi:!0}}),$(!1)},[g,s,u]),ot=r.useCallback(()=>{$(!0)},[]),_=r.useCallback(()=>{const{value:n}=e;e.setValue=!1,T(n??null),v(W({value:n??null,...e,step:i})),u({value:n??null,source:{fromUi:!1}})},[e,i,u]);r.useEffect(()=>{e.setValue?_():u({value:s,source:{fromUi:!1}})},[]),e.setValue&&_();const N=f(e.default)&&!t,nt=r.useCallback(()=>{const n=e.default??null;T(n),u({value:n,source:{fromUi:!0}})},[e]);It({element:e,widgetMgr:o,onFormCleared:nt});const at=n=>{const{value:d}=n.target;if(d==="")C(!0),T(null),v(null);else{let y;e.dataType===I.DataType.INT?y=parseInt(d,10):y=parseFloat(d),C(!0),T(y),v(d)}},z=r.useCallback(()=>{V&&(C(!0),u({value:(s??b)+i,source:{fromUi:!0}}))},[s,b,i,V]),E=r.useCallback(()=>{S&&(C(!0),u({value:(s??m)-i,source:{fromUi:!0}}))},[s,m,i,S]),it=r.useCallback(n=>{const{key:d}=n;switch(d){case"ArrowUp":n.preventDefault(),z();break;case"ArrowDown":n.preventDefault(),E();break}},[z,E]),st=r.useCallback(n=>{n.key==="Enter"&&(g&&u({value:s,source:{fromUi:!0}}),o.allowFormEnterToSubmit(p)&&o.submitForm(p,l))},[g,s,u,o,p,l]);return F("div",{className:"stNumberInput","data-testid":"stNumberInput",style:{width:h},children:[c(mt,{label:e.label,disabled:t,labelVisibility:dt((j=e.labelVisibility)==null?void 0:j.value),htmlFor:L.current,children:e.help&&c(pt,{children:c(ft,{content:e.help,placement:bt.TOP_RIGHT})})}),F(Tt,{className:P?"focused":"","data-testid":"stNumberInputContainer",children:[c(Ct,{type:"number",inputRef:D,value:H??"",placeholder:e.placeholder,onBlur:rt,onFocus:ot,onChange:at,onKeyPress:st,onKeyDown:it,clearable:N,clearOnEscape:N,disabled:t,"aria-label":e.label,id:L.current,overrides:{ClearIconContainer:{style:{padding:0}},ClearIcon:{props:{overrides:{Svg:{style:{color:a.colors.darkGray,padding:a.spacing.threeXS,height:a.sizes.clearIconSize,width:a.sizes.clearIconSize,":hover":{fill:a.colors.bodyText}}}}}},Input:{props:{"data-testid":"stNumberInputField",step:i,min:b,max:m,type:"number",inputMode:""},style:{lineHeight:a.lineHeights.inputWidget,paddingRight:a.spacing.sm,paddingLeft:a.spacing.sm,paddingBottom:a.spacing.sm,paddingTop:a.spacing.sm}},InputContainer:{style:()=>({borderTopRightRadius:0,borderBottomRightRadius:0})},Root:{style:{borderTopRightRadius:0,borderBottomRightRadius:0,borderLeftWidth:0,borderRightWidth:0,borderTopWidth:0,borderBottomWidth:0,paddingRight:0}}}}),h>a.breakpoints.hideNumberInputControls&&F(wt,{children:[c(M,{"data-testid":"stNumberInputStepDown",onClick:E,disabled:!S||t,tabIndex:-1,children:c(G,{content:Q,size:"xs",color:S?"inherit":"disabled"})}),c(M,{"data-testid":"stNumberInputStepUp",onClick:z,disabled:!V||t,tabIndex:-1,children:c(G,{content:Y,size:"xs",color:V?"inherit":"disabled"})})]})]}),et&&c(vt,{clearable:N,children:c(ht,{dirty:g,value:H??"",inForm:O,allowEnterToSubmit:tt})})]})},At=lt(Dt);export{At as default};
