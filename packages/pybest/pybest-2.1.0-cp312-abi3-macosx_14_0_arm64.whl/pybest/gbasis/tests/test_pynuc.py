# PyBEST: Pythonic Black-box Electronic Structure Tool
# Copyright (C) 2016-- The PyBEST Development Team
#
# This file is part of PyBEST.
#
# PyBEST is free software; you can redistribute it and/or
# modify it under the terms of the GNU General Public License
# as published by the Free Software Foundation; either version 3
# of the License, or (at your option) any later version.
#
# PyBEST is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program; if not, see <http://www.gnu.org/licenses/>
# --

import numpy as np

from pybest import context
from pybest.gbasis import compute_nuclear, get_gobasis

ref = np.array(
    [
        [
            -6.22689189e01,
            1.21250455e01,
            -6.09898632e00,
            0.00000000e00,
            8.11376562e-15,
            -2.06875457e-02,
            0.00000000e00,
            -1.83430899e-16,
            -5.64009853e-03,
            0.00000000e00,
            2.67043440e-18,
            -3.41873320e-04,
            0.00000000e00,
            -3.32403277e-03,
            -9.36028543e-01,
            -2.11498874e00,
            -2.67286628e00,
            1.24810837e-16,
            2.04984711e00,
            -9.36028543e-01,
            -2.11498874e00,
            2.67286628e00,
            1.24810837e-16,
            2.04984711e00,
        ],
        [
            1.21250455e01,
            -5.34222563e00,
            -2.80433805e00,
            0.00000000e00,
            -2.30898019e-15,
            -5.85364849e-02,
            0.00000000e00,
            1.04081771e-16,
            -5.80810845e-02,
            0.00000000e00,
            -9.48226757e-19,
            -4.23705621e-03,
            0.00000000e00,
            -4.11968788e-02,
            -6.50237288e-01,
            -1.27711857e00,
            -1.33364872e00,
            -4.44406238e-16,
            1.00932167e00,
            -6.50237288e-01,
            -1.27711857e00,
            1.33364872e00,
            -4.44406238e-16,
            1.00932167e00,
        ],
        [
            -6.09898632e00,
            -2.80433805e00,
            -8.06824267e00,
            0.00000000e00,
            -1.40192336e-15,
            -1.20197918e-01,
            0.00000000e00,
            0.00000000e00,
            -2.39800313e-01,
            0.00000000e00,
            6.57434578e-17,
            -1.14715589e-02,
            0.00000000e00,
            -1.11537916e-01,
            -2.11083211e00,
            -4.33769639e00,
            -3.11709766e00,
            9.23838964e-16,
            2.34136585e00,
            -2.11083211e00,
            -4.33769639e00,
            3.11709766e00,
            9.23838964e-16,
            2.34136585e00,
        ],
        [
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            -6.06731193e00,
            0.00000000e00,
            0.00000000e00,
            -3.02249376e00,
            0.00000000e00,
            0.00000000e00,
            -3.96299545e-15,
            0.00000000e00,
            0.00000000e00,
            -1.42720589e-01,
            0.00000000e00,
            7.75249023e-01,
            4.77889828e-01,
            1.22486422e00,
            -4.46866453e-16,
            -1.79366479e00,
            -7.75249023e-01,
            -4.77889828e-01,
            1.22486422e00,
            4.46866453e-16,
            1.79366479e00,
        ],
        [
            8.11376562e-15,
            -2.30898019e-15,
            -1.40192336e-15,
            0.00000000e00,
            -6.01774336e00,
            1.11405404e-17,
            0.00000000e00,
            -2.95625692e00,
            -1.92566339e-17,
            0.00000000e00,
            -8.35317394e-02,
            2.25939702e-15,
            0.00000000e00,
            3.89467337e-15,
            3.61672690e-16,
            3.56325057e-16,
            1.13940572e-15,
            -1.12014829e00,
            -8.68781813e-16,
            3.61672690e-16,
            3.56325057e-16,
            -1.13940572e-15,
            -1.12014829e00,
            -8.68781813e-16,
        ],
        [
            -2.06875457e-02,
            -5.85364849e-02,
            -1.20197918e-01,
            0.00000000e00,
            1.11405404e-17,
            -6.04694271e00,
            0.00000000e00,
            -1.92566339e-17,
            -2.99527504e00,
            0.00000000e00,
            -3.94427838e-15,
            -9.94979003e-02,
            0.00000000e00,
            -2.95944248e-02,
            -6.11307341e-01,
            -4.20111070e-01,
            -1.83873850e00,
            3.48696095e-16,
            2.74602545e-01,
            -6.11307341e-01,
            -4.20111070e-01,
            1.83873850e00,
            3.48696095e-16,
            2.74602545e-01,
        ],
        [
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            -3.02249376e00,
            0.00000000e00,
            0.00000000e00,
            -5.51937049e00,
            0.00000000e00,
            0.00000000e00,
            1.78784053e-15,
            0.00000000e00,
            0.00000000e00,
            -2.17744429e-01,
            0.00000000e00,
            1.68321056e00,
            1.46510852e00,
            1.93649957e-01,
            0.00000000e00,
            -1.79217364e00,
            -1.68321056e00,
            -1.46510852e00,
            1.93649957e-01,
            0.00000000e00,
            1.79217364e00,
        ],
        [
            -1.83430899e-16,
            1.04081771e-16,
            0.00000000e00,
            0.00000000e00,
            -2.95625692e00,
            -1.92566339e-17,
            0.00000000e00,
            -5.29252852e00,
            0.00000000e00,
            0.00000000e00,
            -1.03055630e-01,
            -1.01437104e-15,
            0.00000000e00,
            -1.74528355e-15,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            -2.17445802e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            -2.17445802e00,
            0.00000000e00,
        ],
        [
            -5.64009853e-03,
            -5.80810845e-02,
            -2.39800313e-01,
            0.00000000e00,
            -1.92566339e-17,
            -2.99527504e00,
            0.00000000e00,
            0.00000000e00,
            -5.42615428e00,
            0.00000000e00,
            1.77618190e-15,
            -1.24896203e-01,
            0.00000000e00,
            -5.73443995e-02,
            -1.32288949e00,
            -1.27565714e00,
            -1.87044123e00,
            0.00000000e00,
            -7.86285900e-01,
            -1.32288949e00,
            -1.27565714e00,
            1.87044123e00,
            0.00000000e00,
            -7.86285900e-01,
        ],
        [
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            -3.96299545e-15,
            0.00000000e00,
            0.00000000e00,
            1.78784053e-15,
            0.00000000e00,
            0.00000000e00,
            -8.47434139e00,
            0.00000000e00,
            0.00000000e00,
            8.28456398e-17,
            0.00000000e00,
            -7.70689572e-17,
            2.83846736e-16,
            0.00000000e00,
            1.77702817e00,
            0.00000000e00,
            7.70689572e-17,
            -2.83846736e-16,
            0.00000000e00,
            -1.77702817e00,
            0.00000000e00,
        ],
        [
            2.67043440e-18,
            -9.48226757e-19,
            6.57434578e-17,
            0.00000000e00,
            -8.35317394e-02,
            -3.94427838e-15,
            0.00000000e00,
            -1.03055630e-01,
            1.77618190e-15,
            0.00000000e00,
            -8.43726022e00,
            3.34004698e-17,
            0.00000000e00,
            -4.16882666e-17,
            5.94379038e-17,
            -2.46303461e-16,
            0.00000000e00,
            -1.38707058e00,
            0.00000000e00,
            5.94379038e-17,
            -2.46303461e-16,
            0.00000000e00,
            -1.38707058e00,
            0.00000000e00,
        ],
        [
            -3.41873320e-04,
            -4.23705621e-03,
            -1.14715589e-02,
            0.00000000e00,
            2.25939702e-15,
            -9.94979003e-02,
            0.00000000e00,
            -1.01437104e-15,
            -1.24896203e-01,
            0.00000000e00,
            3.34004698e-17,
            -8.48551242e00,
            0.00000000e00,
            4.76794257e-02,
            -7.49566580e-02,
            -3.14314167e-02,
            -1.26471385e00,
            0.00000000e00,
            -1.43355005e00,
            -7.49566580e-02,
            -3.14314167e-02,
            1.26471385e00,
            0.00000000e00,
            -1.43355005e00,
        ],
        [
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            -1.42720589e-01,
            0.00000000e00,
            0.00000000e00,
            -2.17744429e-01,
            0.00000000e00,
            0.00000000e00,
            8.28456398e-17,
            0.00000000e00,
            0.00000000e00,
            -8.62873735e00,
            0.00000000e00,
            8.82059046e-01,
            1.77884644e-01,
            1.42395773e00,
            0.00000000e00,
            -3.71863751e-01,
            -8.82059046e-01,
            -1.77884644e-01,
            1.42395773e00,
            0.00000000e00,
            3.71863751e-01,
        ],
        [
            -3.32403277e-03,
            -4.11968788e-02,
            -1.11537916e-01,
            0.00000000e00,
            3.89467337e-15,
            -2.95944248e-02,
            0.00000000e00,
            -1.74528355e-15,
            -5.73443995e-02,
            0.00000000e00,
            -4.16882666e-17,
            4.76794257e-02,
            0.00000000e00,
            -8.51730743e00,
            -5.74645531e-01,
            -1.56845225e-01,
            -4.25431158e-02,
            0.00000000e00,
            1.39011520e00,
            -5.74645531e-01,
            -1.56845225e-01,
            4.25431158e-02,
            0.00000000e00,
            1.39011520e00,
        ],
        [
            -9.36028543e-01,
            -6.50237288e-01,
            -2.11083211e00,
            7.75249023e-01,
            3.61672690e-16,
            -6.11307341e-01,
            1.68321056e00,
            0.00000000e00,
            -1.32288949e00,
            -7.70689572e-17,
            5.94379038e-17,
            -7.49566580e-02,
            8.82059046e-01,
            -5.74645531e-01,
            -2.09814084e00,
            -2.20752840e00,
            -7.20141988e-01,
            1.11198513e-15,
            5.18681287e-01,
            -3.03304724e-01,
            -1.11467207e00,
            7.34455701e-01,
            1.09790377e-16,
            1.21190608e-01,
        ],
        [
            -2.11498874e00,
            -1.27711857e00,
            -4.33769639e00,
            4.77889828e-01,
            3.56325057e-16,
            -4.20111070e-01,
            1.46510852e00,
            0.00000000e00,
            -1.27565714e00,
            2.83846736e-16,
            -2.46303461e-16,
            -3.14314167e-02,
            1.77884644e-01,
            -1.56845225e-01,
            -2.20752840e00,
            -4.38954382e00,
            -1.05292185e00,
            2.07121268e-15,
            7.53934136e-01,
            -1.11467207e00,
            -3.00866258e00,
            1.53001636e00,
            9.46944912e-16,
            4.59660344e-01,
        ],
        [
            -2.67286628e00,
            -1.33364872e00,
            -3.11709766e00,
            1.22486422e00,
            1.13940572e-15,
            -1.83873850e00,
            1.93649957e-01,
            0.00000000e00,
            -1.87044123e00,
            0.00000000e00,
            0.00000000e00,
            -1.26471385e00,
            1.42395773e00,
            -4.25431158e-02,
            -7.20141988e-01,
            -1.05292185e00,
            -6.01075410e00,
            0.00000000e00,
            6.04331338e-01,
            -7.34455701e-01,
            -1.53001636e00,
            2.04940223e00,
            0.00000000e00,
            3.12817792e-01,
        ],
        [
            1.24810837e-16,
            -4.44406238e-16,
            9.23838964e-16,
            -4.46866453e-16,
            -1.12014829e00,
            3.48696095e-16,
            0.00000000e00,
            -2.17445802e00,
            0.00000000e00,
            1.77702817e00,
            -1.38707058e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            1.11198513e-15,
            2.07121268e-15,
            0.00000000e00,
            -5.18050139e00,
            0.00000000e00,
            1.09790377e-16,
            9.46944912e-16,
            0.00000000e00,
            -3.17268725e-01,
            0.00000000e00,
        ],
        [
            2.04984711e00,
            1.00932167e00,
            2.34136585e00,
            -1.79366479e00,
            -8.68781813e-16,
            2.74602545e-01,
            -1.79217364e00,
            0.00000000e00,
            -7.86285900e-01,
            0.00000000e00,
            0.00000000e00,
            -1.43355005e00,
            -3.71863751e-01,
            1.39011520e00,
            5.18681287e-01,
            7.53934136e-01,
            6.04331338e-01,
            0.00000000e00,
            -5.64433103e00,
            1.21190608e-01,
            4.59660344e-01,
            -3.12817792e-01,
            0.00000000e00,
            -4.30777607e-01,
        ],
        [
            -9.36028543e-01,
            -6.50237288e-01,
            -2.11083211e00,
            -7.75249023e-01,
            3.61672690e-16,
            -6.11307341e-01,
            -1.68321056e00,
            0.00000000e00,
            -1.32288949e00,
            7.70689572e-17,
            5.94379038e-17,
            -7.49566580e-02,
            -8.82059046e-01,
            -5.74645531e-01,
            -3.03304724e-01,
            -1.11467207e00,
            -7.34455701e-01,
            1.09790377e-16,
            1.21190608e-01,
            -2.09814084e00,
            -2.20752840e00,
            7.20141988e-01,
            1.11198513e-15,
            5.18681287e-01,
        ],
        [
            -2.11498874e00,
            -1.27711857e00,
            -4.33769639e00,
            -4.77889828e-01,
            3.56325057e-16,
            -4.20111070e-01,
            -1.46510852e00,
            0.00000000e00,
            -1.27565714e00,
            -2.83846736e-16,
            -2.46303461e-16,
            -3.14314167e-02,
            -1.77884644e-01,
            -1.56845225e-01,
            -1.11467207e00,
            -3.00866258e00,
            -1.53001636e00,
            9.46944912e-16,
            4.59660344e-01,
            -2.20752840e00,
            -4.38954382e00,
            1.05292185e00,
            2.07121268e-15,
            7.53934136e-01,
        ],
        [
            2.67286628e00,
            1.33364872e00,
            3.11709766e00,
            1.22486422e00,
            -1.13940572e-15,
            1.83873850e00,
            1.93649957e-01,
            0.00000000e00,
            1.87044123e00,
            0.00000000e00,
            0.00000000e00,
            1.26471385e00,
            1.42395773e00,
            4.25431158e-02,
            7.34455701e-01,
            1.53001636e00,
            2.04940223e00,
            0.00000000e00,
            -3.12817792e-01,
            7.20141988e-01,
            1.05292185e00,
            -6.01075410e00,
            0.00000000e00,
            -6.04331338e-01,
        ],
        [
            1.24810837e-16,
            -4.44406238e-16,
            9.23838964e-16,
            4.46866453e-16,
            -1.12014829e00,
            3.48696095e-16,
            0.00000000e00,
            -2.17445802e00,
            0.00000000e00,
            -1.77702817e00,
            -1.38707058e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            1.09790377e-16,
            9.46944912e-16,
            0.00000000e00,
            -3.17268725e-01,
            0.00000000e00,
            1.11198513e-15,
            2.07121268e-15,
            0.00000000e00,
            -5.18050139e00,
            0.00000000e00,
        ],
        [
            2.04984711e00,
            1.00932167e00,
            2.34136585e00,
            1.79366479e00,
            -8.68781813e-16,
            2.74602545e-01,
            1.79217364e00,
            0.00000000e00,
            -7.86285900e-01,
            0.00000000e00,
            0.00000000e00,
            -1.43355005e00,
            3.71863751e-01,
            1.39011520e00,
            1.21190608e-01,
            4.59660344e-01,
            3.12817792e-01,
            0.00000000e00,
            -4.30777607e-01,
            5.18681287e-01,
            7.53934136e-01,
            -6.04331338e-01,
            0.00000000e00,
            -5.64433103e00,
        ],
    ]
)


def test_nuc():
    fn = context.get_fn("test/h2o_ccdz.xyz")
    obs = get_gobasis("cc-pvdz", fn, print_basis=False)

    nuc = compute_nuclear(obs)

    assert nuc.nbasis == nuc.nbasis1 == 24
    assert np.allclose(nuc._array, ref)
