# PyBEST: Pythonic Black-box Electronic Structure Tool
# Copyright (C) 2016-- The PyBEST Development Team
#
# This file is part of PyBEST.
#
# PyBEST is free software; you can redistribute it and/or
# modify it under the terms of the GNU General Public License
# as published by the Free Software Foundation; either version 3
# of the License, or (at your option) any later version.
#
# PyBEST is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program; if not, see <http://www.gnu.org/licenses/>
# --

import numpy as np

from pybest import context
from pybest.gbasis import compute_kinetic, get_gobasis

ref = np.array(
    [
        [
            2.92157723e01,
            -8.11980187e00,
            1.67879517e-01,
            0.00000000e00,
            -1.47825018e-15,
            2.13452415e-16,
            0.00000000e00,
            7.90526376e-17,
            1.83045913e-17,
            0.00000000e00,
            1.34472872e-31,
            0.00000000e00,
            0.00000000e00,
            2.22044605e-16,
            -1.87589472e-03,
            1.83009259e-02,
            3.59700935e-02,
            9.98068001e-17,
            -2.76073646e-02,
            -1.87589472e-03,
            1.83009259e-02,
            -3.59700935e-02,
            9.98068001e-17,
            -2.76073646e-02,
        ],
        [
            -8.11980187e00,
            2.68263143e00,
            2.39795555e-01,
            0.00000000e00,
            5.21925512e-16,
            -4.50809522e-17,
            0.00000000e00,
            -1.59326829e-17,
            -7.16344920e-18,
            0.00000000e00,
            -3.31078221e-32,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            1.78905309e-02,
            4.05186450e-02,
            1.66753926e-01,
            -3.67835457e-17,
            -1.27985111e-01,
            1.78905309e-02,
            4.05186450e-02,
            -1.66753926e-01,
            -3.67835457e-17,
            -1.27985111e-01,
        ],
        [
            1.67879517e-01,
            2.39795555e-01,
            4.53450000e-01,
            0.00000000e00,
            1.53192622e-16,
            -1.54940069e-18,
            0.00000000e00,
            0.00000000e00,
            1.21583379e-17,
            0.00000000e00,
            -2.28095732e-32,
            0.00000000e00,
            0.00000000e00,
            -5.55111512e-17,
            9.45408384e-02,
            1.36096841e-01,
            2.37305307e-01,
            -7.52134487e-17,
            -1.82133920e-01,
            9.45408384e-02,
            1.36096841e-01,
            -2.37305307e-01,
            -7.52134487e-17,
            -1.82133920e-01,
        ],
        [
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            2.03714846e00,
            0.00000000e00,
            0.00000000e00,
            3.83082787e-01,
            0.00000000e00,
            0.00000000e00,
            1.42545025e-15,
            0.00000000e00,
            0.00000000e00,
            -1.05575175e-16,
            0.00000000e00,
            -6.90423960e-02,
            -2.72250989e-02,
            -3.24203462e-01,
            2.74031442e-17,
            3.38922208e-01,
            6.90423960e-02,
            2.72250989e-02,
            -3.24203462e-01,
            -2.74031442e-17,
            -3.38922208e-01,
        ],
        [
            -1.47825018e-15,
            5.21925512e-16,
            1.53192622e-16,
            0.00000000e00,
            2.03714846e00,
            1.70866995e-32,
            0.00000000e00,
            3.83082787e-01,
            3.76758015e-33,
            0.00000000e00,
            -1.05575175e-16,
            -8.22984086e-16,
            0.00000000e00,
            -1.42545025e-15,
            -1.35771567e-17,
            -1.02934896e-17,
            -1.20310317e-16,
            1.17383907e-01,
            9.23392311e-17,
            -1.35771567e-17,
            -1.02934896e-17,
            1.20310317e-16,
            1.17383907e-01,
            9.23392311e-17,
        ],
        [
            2.13452415e-16,
            -4.50809522e-17,
            -1.54940069e-18,
            0.00000000e00,
            1.70866995e-32,
            2.03714846e00,
            0.00000000e00,
            3.76758015e-33,
            3.83082787e-01,
            0.00000000e00,
            1.42545025e-15,
            -1.21907711e-16,
            0.00000000e00,
            7.70371978e-33,
            5.29906490e-02,
            2.08955040e-02,
            3.38922208e-01,
            -2.10321553e-17,
            -1.42741882e-01,
            5.29906490e-02,
            2.08955040e-02,
            -3.38922208e-01,
            -2.10321553e-17,
            -1.42741882e-01,
        ],
        [
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            3.83082787e-01,
            0.00000000e00,
            0.00000000e00,
            6.88250000e-01,
            0.00000000e00,
            0.00000000e00,
            -3.37123058e-16,
            0.00000000e00,
            0.00000000e00,
            4.21403822e-17,
            0.00000000e00,
            -1.98392515e-01,
            -1.16941519e-01,
            -8.12971971e-02,
            0.00000000e00,
            2.81458506e-01,
            1.98392515e-01,
            1.16941519e-01,
            -8.12971971e-02,
            0.00000000e00,
            -2.81458506e-01,
        ],
        [
            7.90526376e-17,
            -1.59326829e-17,
            0.00000000e00,
            0.00000000e00,
            3.83082787e-01,
            3.76758015e-33,
            0.00000000e00,
            6.88250000e-01,
            0.00000000e00,
            0.00000000e00,
            4.21403822e-17,
            1.94638088e-16,
            0.00000000e00,
            3.37123058e-16,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            2.85419761e-01,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            2.85419761e-01,
            0.00000000e00,
        ],
        [
            1.83045913e-17,
            -7.16344920e-18,
            1.21583379e-17,
            0.00000000e00,
            3.76758015e-33,
            3.83082787e-01,
            0.00000000e00,
            0.00000000e00,
            6.88250000e-01,
            0.00000000e00,
            -3.37123058e-16,
            4.86595220e-17,
            0.00000000e00,
            -2.31111593e-33,
            1.52268008e-01,
            8.97536493e-02,
            2.81458506e-01,
            0.00000000e00,
            6.93978709e-02,
            1.52268008e-01,
            8.97536493e-02,
            -2.81458506e-01,
            0.00000000e00,
            6.93978709e-02,
        ],
        [
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            1.42545025e-15,
            0.00000000e00,
            0.00000000e00,
            -3.37123058e-16,
            0.00000000e00,
            0.00000000e00,
            4.14750000e00,
            0.00000000e00,
            0.00000000e00,
            -8.65420472e-32,
            0.00000000e00,
            -4.37579041e-18,
            -2.49277568e-17,
            0.00000000e00,
            -4.51712011e-01,
            0.00000000e00,
            4.37579041e-18,
            2.49277568e-17,
            0.00000000e00,
            4.51712011e-01,
            0.00000000e00,
        ],
        [
            1.34472872e-31,
            -3.31078221e-32,
            -2.28095732e-32,
            0.00000000e00,
            -1.05575175e-16,
            1.42545025e-15,
            0.00000000e00,
            4.21403822e-17,
            -3.37123058e-16,
            0.00000000e00,
            4.14750000e00,
            -4.99650743e-32,
            0.00000000e00,
            8.65420472e-32,
            3.35845780e-18,
            1.91322736e-17,
            0.00000000e00,
            3.46692960e-01,
            0.00000000e00,
            3.35845780e-18,
            1.91322736e-17,
            0.00000000e00,
            3.46692960e-01,
            0.00000000e00,
        ],
        [
            2.22044605e-16,
            -1.11022302e-16,
            0.00000000e00,
            0.00000000e00,
            -8.22984086e-16,
            -1.21907711e-16,
            0.00000000e00,
            1.94638088e-16,
            4.86595220e-17,
            0.00000000e00,
            -4.99650743e-32,
            4.14750000e00,
            0.00000000e00,
            -2.77555756e-17,
            1.16688183e-02,
            9.44051387e-04,
            3.26141255e-01,
            0.00000000e00,
            3.50173526e-01,
            1.16688183e-02,
            9.44051387e-04,
            -3.26141255e-01,
            0.00000000e00,
            3.50173526e-01,
        ],
        [
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            -1.05575175e-16,
            0.00000000e00,
            0.00000000e00,
            4.21403822e-17,
            0.00000000e00,
            0.00000000e00,
            -8.65420472e-32,
            0.00000000e00,
            0.00000000e00,
            4.14750000e00,
            0.00000000e00,
            -1.74156763e-01,
            -1.40899387e-02,
            -6.28582251e-01,
            0.00000000e00,
            2.96820331e-01,
            1.74156763e-01,
            1.40899387e-02,
            -6.28582251e-01,
            0.00000000e00,
            -2.96820331e-01,
        ],
        [
            0.00000000e00,
            0.00000000e00,
            -5.55111512e-17,
            0.00000000e00,
            -1.42545025e-15,
            6.16297582e-33,
            0.00000000e00,
            3.37123058e-16,
            -1.15555797e-33,
            0.00000000e00,
            8.65420472e-32,
            -1.38777878e-16,
            0.00000000e00,
            4.14750000e00,
            1.13455869e-01,
            9.17900745e-03,
            1.83639118e-01,
            0.00000000e00,
            -4.87637605e-01,
            1.13455869e-01,
            9.17900745e-03,
            -1.83639118e-01,
            0.00000000e00,
            -4.87637605e-01,
        ],
        [
            -1.87589472e-03,
            1.78905309e-02,
            9.45408384e-02,
            -6.90423960e-02,
            -1.35771567e-17,
            5.29906490e-02,
            -1.98392515e-01,
            0.00000000e00,
            1.52268008e-01,
            -4.37579041e-18,
            3.35845780e-18,
            1.16688183e-02,
            -1.74156763e-01,
            1.13455869e-01,
            3.34767200e-01,
            1.18252074e-01,
            1.40452271e-16,
            -1.92009667e-16,
            2.57786980e-17,
            -1.07448547e-02,
            2.37650461e-02,
            1.08743463e-03,
            7.90198503e-18,
            -9.88514788e-19,
        ],
        [
            1.83009259e-02,
            4.05186450e-02,
            1.36096841e-01,
            -2.72250989e-02,
            -1.02934896e-17,
            2.08955040e-02,
            -1.16941519e-01,
            0.00000000e00,
            8.97536493e-02,
            -2.49277568e-17,
            1.91322736e-17,
            9.44051387e-04,
            -1.40899387e-02,
            9.17900745e-03,
            1.18252074e-01,
            1.83000000e-01,
            8.90788944e-17,
            -1.78157789e-16,
            0.00000000e00,
            2.37650461e-02,
            7.27519820e-02,
            -5.92417319e-02,
            -4.06859679e-17,
            0.00000000e00,
        ],
        [
            3.59700935e-02,
            1.66753926e-01,
            2.37305307e-01,
            -3.24203462e-01,
            -1.20310317e-16,
            3.38922208e-01,
            -8.12971971e-02,
            0.00000000e00,
            2.81458506e-01,
            0.00000000e00,
            0.00000000e00,
            3.26141255e-01,
            -6.28582251e-01,
            1.83639118e-01,
            1.40452271e-16,
            8.90788944e-17,
            1.81750000e00,
            0.00000000e00,
            0.00000000e00,
            -1.08743463e-03,
            5.92417319e-02,
            -1.18674582e-01,
            0.00000000e00,
            0.00000000e00,
        ],
        [
            9.98068001e-17,
            -3.67835457e-17,
            -7.52134487e-17,
            2.74031442e-17,
            1.17383907e-01,
            -2.10321553e-17,
            0.00000000e00,
            2.85419761e-01,
            0.00000000e00,
            -4.51712011e-01,
            3.46692960e-01,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            -1.92009667e-16,
            -1.78157789e-16,
            0.00000000e00,
            1.81750000e00,
            0.00000000e00,
            7.90198503e-18,
            -4.06859679e-17,
            0.00000000e00,
            -1.86156383e-02,
            0.00000000e00,
        ],
        [
            -2.76073646e-02,
            -1.27985111e-01,
            -1.82133920e-01,
            3.38922208e-01,
            9.23392311e-17,
            -1.42741882e-01,
            2.81458506e-01,
            0.00000000e00,
            6.93978709e-02,
            0.00000000e00,
            0.00000000e00,
            3.50173526e-01,
            2.96820331e-01,
            -4.87637605e-01,
            2.57786980e-17,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            1.81750000e00,
            -9.88514788e-19,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            -1.86156383e-02,
        ],
        [
            -1.87589472e-03,
            1.78905309e-02,
            9.45408384e-02,
            6.90423960e-02,
            -1.35771567e-17,
            5.29906490e-02,
            1.98392515e-01,
            0.00000000e00,
            1.52268008e-01,
            4.37579041e-18,
            3.35845780e-18,
            1.16688183e-02,
            1.74156763e-01,
            1.13455869e-01,
            -1.07448547e-02,
            2.37650461e-02,
            -1.08743463e-03,
            7.90198503e-18,
            -9.88514788e-19,
            3.34767200e-01,
            1.18252074e-01,
            -1.40452271e-16,
            -1.92009667e-16,
            2.57786980e-17,
        ],
        [
            1.83009259e-02,
            4.05186450e-02,
            1.36096841e-01,
            2.72250989e-02,
            -1.02934896e-17,
            2.08955040e-02,
            1.16941519e-01,
            0.00000000e00,
            8.97536493e-02,
            2.49277568e-17,
            1.91322736e-17,
            9.44051387e-04,
            1.40899387e-02,
            9.17900745e-03,
            2.37650461e-02,
            7.27519820e-02,
            5.92417319e-02,
            -4.06859679e-17,
            0.00000000e00,
            1.18252074e-01,
            1.83000000e-01,
            -8.90788944e-17,
            -1.78157789e-16,
            0.00000000e00,
        ],
        [
            -3.59700935e-02,
            -1.66753926e-01,
            -2.37305307e-01,
            -3.24203462e-01,
            1.20310317e-16,
            -3.38922208e-01,
            -8.12971971e-02,
            0.00000000e00,
            -2.81458506e-01,
            0.00000000e00,
            0.00000000e00,
            -3.26141255e-01,
            -6.28582251e-01,
            -1.83639118e-01,
            1.08743463e-03,
            -5.92417319e-02,
            -1.18674582e-01,
            0.00000000e00,
            0.00000000e00,
            -1.40452271e-16,
            -8.90788944e-17,
            1.81750000e00,
            0.00000000e00,
            0.00000000e00,
        ],
        [
            9.98068001e-17,
            -3.67835457e-17,
            -7.52134487e-17,
            -2.74031442e-17,
            1.17383907e-01,
            -2.10321553e-17,
            0.00000000e00,
            2.85419761e-01,
            0.00000000e00,
            4.51712011e-01,
            3.46692960e-01,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            7.90198503e-18,
            -4.06859679e-17,
            0.00000000e00,
            -1.86156383e-02,
            0.00000000e00,
            -1.92009667e-16,
            -1.78157789e-16,
            0.00000000e00,
            1.81750000e00,
            0.00000000e00,
        ],
        [
            -2.76073646e-02,
            -1.27985111e-01,
            -1.82133920e-01,
            -3.38922208e-01,
            9.23392311e-17,
            -1.42741882e-01,
            -2.81458506e-01,
            0.00000000e00,
            6.93978709e-02,
            0.00000000e00,
            0.00000000e00,
            3.50173526e-01,
            -2.96820331e-01,
            -4.87637605e-01,
            -9.88514788e-19,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            -1.86156383e-02,
            2.57786980e-17,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            1.81750000e00,
        ],
    ]
)


def test_kin():
    fn = context.get_fn("test/h2o_ccdz.xyz")
    obs = get_gobasis("cc-pvdz", fn, print_basis=False)

    kin = compute_kinetic(obs)

    assert kin.nbasis == kin.nbasis1 == 24
    assert np.allclose(kin._array, ref)
