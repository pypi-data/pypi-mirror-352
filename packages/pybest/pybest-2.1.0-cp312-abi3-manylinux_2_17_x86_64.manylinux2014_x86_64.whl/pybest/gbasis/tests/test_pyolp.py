# PyBEST: Pythonic Black-box Electronic Structure Tool
# Copyright (C) 2016-- The PyBEST Development Team
#
# This file is part of PyBEST.
#
# PyBEST is free software; you can redistribute it and/or
# modify it under the terms of the GNU General Public License
# as published by the Free Software Foundation; either version 3
# of the License, or (at your option) any later version.
#
# PyBEST is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program; if not, see <http://www.gnu.org/licenses/>
# --

import numpy as np

from pybest import context
from pybest.gbasis import compute_overlap, get_gobasis

ref = np.array(
    [
        [
            1.00099808e00,
            -1.08977040e-01,
            1.94481133e-01,
            0.00000000e00,
            -2.57829318e-16,
            1.56315471e-17,
            0.00000000e00,
            2.15802029e-17,
            -1.47980650e-18,
            0.00000000e00,
            -1.71694136e-33,
            0.00000000e00,
            0.00000000e00,
            1.38777878e-17,
            3.11787250e-02,
            6.94378271e-02,
            8.64125982e-02,
            -3.96632585e-18,
            -6.63224327e-02,
            3.11787250e-02,
            6.94378271e-02,
            -8.64125982e-02,
            -3.96632585e-18,
            -6.63224327e-02,
        ],
        [
            -1.08977040e-01,
            2.58913661e-01,
            3.60564631e-01,
            0.00000000e00,
            7.65205087e-17,
            1.03526958e-17,
            0.00000000e00,
            -1.03188277e-17,
            6.01381634e-19,
            0.00000000e00,
            4.29458464e-34,
            -5.55111512e-17,
            0.00000000e00,
            5.55111512e-17,
            8.16269234e-02,
            1.64922820e-01,
            1.61666634e-01,
            5.28575514e-17,
            -1.24080570e-01,
            8.16269234e-02,
            1.64922820e-01,
            -1.61666634e-01,
            5.28575514e-17,
            -1.24080570e-01,
        ],
        [
            1.94481133e-01,
            3.60564631e-01,
            1.00000000e00,
            0.00000000e00,
            1.76020913e-16,
            -1.30881615e-18,
            0.00000000e00,
            0.00000000e00,
            2.90784214e-17,
            0.00000000e00,
            -2.10927549e-32,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            2.90009819e-01,
            6.45847815e-01,
            3.09939123e-01,
            -1.62324874e-16,
            -2.37881015e-01,
            2.90009819e-01,
            6.45847815e-01,
            -3.09939123e-01,
            -1.62324874e-16,
            -2.37881015e-01,
        ],
        [
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            4.71035900e-01,
            0.00000000e00,
            0.00000000e00,
            3.44032921e-01,
            0.00000000e00,
            0.00000000e00,
            4.86071487e-16,
            0.00000000e00,
            0.00000000e00,
            -4.01839005e-17,
            0.00000000e00,
            -8.94351202e-02,
            -5.78885101e-02,
            -1.15045863e-01,
            6.14119964e-17,
            1.89741811e-01,
            8.94351202e-02,
            5.78885101e-02,
            -1.15045863e-01,
            -6.14119964e-17,
            -1.89741811e-01,
        ],
        [
            -2.57829318e-16,
            7.65205087e-17,
            1.76020913e-16,
            0.00000000e00,
            4.71035900e-01,
            -1.44404116e-33,
            0.00000000e00,
            3.44032921e-01,
            -6.97496944e-33,
            0.00000000e00,
            -4.01839005e-17,
            -2.80633504e-16,
            0.00000000e00,
            -4.86071487e-16,
            -2.57485300e-17,
            -2.73279706e-17,
            -1.13182140e-16,
            1.32171891e-01,
            8.68682929e-17,
            -2.57485300e-17,
            -2.73279706e-17,
            1.13182140e-16,
            1.32171891e-01,
            8.68682929e-17,
        ],
        [
            1.56315471e-17,
            1.03526958e-17,
            -1.30881615e-18,
            0.00000000e00,
            -1.44404116e-33,
            4.71035900e-01,
            0.00000000e00,
            -6.97496944e-33,
            3.44032921e-01,
            0.00000000e00,
            4.86071487e-16,
            -4.64003715e-17,
            0.00000000e00,
            0.00000000e00,
            6.86422450e-02,
            4.44299430e-02,
            1.89741811e-01,
            -4.71342499e-17,
            -1.34566251e-02,
            6.86422450e-02,
            4.44299430e-02,
            -1.89741811e-01,
            -4.71342499e-17,
            -1.34566251e-02,
        ],
        [
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            3.44032921e-01,
            0.00000000e00,
            0.00000000e00,
            1.00000000e00,
            0.00000000e00,
            0.00000000e00,
            -2.61640442e-16,
            0.00000000e00,
            0.00000000e00,
            3.27050553e-17,
            0.00000000e00,
            -2.89809830e-01,
            -3.11548794e-01,
            6.52075899e-02,
            0.00000000e00,
            2.48263133e-01,
            2.89809830e-01,
            3.11548794e-01,
            6.52075899e-02,
            0.00000000e00,
            -2.48263133e-01,
        ],
        [
            2.15802029e-17,
            -1.03188277e-17,
            0.00000000e00,
            0.00000000e00,
            3.44032921e-01,
            -6.97496944e-33,
            0.00000000e00,
            1.00000000e00,
            0.00000000e00,
            0.00000000e00,
            3.27050553e-17,
            1.51058180e-16,
            0.00000000e00,
            2.61640442e-16,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            3.88673747e-01,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            3.88673747e-01,
            0.00000000e00,
        ],
        [
            -1.47980650e-18,
            6.01381634e-19,
            2.90784214e-17,
            0.00000000e00,
            -6.97496944e-33,
            3.44032921e-01,
            0.00000000e00,
            0.00000000e00,
            1.00000000e00,
            0.00000000e00,
            -2.61640442e-16,
            3.77645449e-17,
            0.00000000e00,
            3.08148791e-33,
            2.22431606e-01,
            2.39116452e-01,
            2.48263133e-01,
            0.00000000e00,
            1.98129598e-01,
            2.22431606e-01,
            2.39116452e-01,
            -2.48263133e-01,
            0.00000000e00,
            1.98129598e-01,
        ],
        [
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            4.86071487e-16,
            0.00000000e00,
            0.00000000e00,
            -2.61640442e-16,
            0.00000000e00,
            0.00000000e00,
            1.00000000e00,
            0.00000000e00,
            0.00000000e00,
            -2.92125054e-32,
            0.00000000e00,
            1.07969467e-17,
            -4.36369019e-17,
            0.00000000e00,
            -2.49637790e-01,
            0.00000000e00,
            -1.07969467e-17,
            4.36369019e-17,
            0.00000000e00,
            2.49637790e-01,
            0.00000000e00,
        ],
        [
            -1.71694136e-33,
            4.29458464e-34,
            -2.10927549e-32,
            0.00000000e00,
            -4.01839005e-17,
            4.86071487e-16,
            0.00000000e00,
            3.27050553e-17,
            -2.61640442e-16,
            0.00000000e00,
            1.00000000e00,
            -1.68658479e-32,
            0.00000000e00,
            2.92125054e-32,
            -8.28675202e-18,
            3.34917078e-17,
            0.00000000e00,
            1.91599210e-01,
            0.00000000e00,
            -8.28675202e-18,
            3.34917078e-17,
            0.00000000e00,
            1.91599210e-01,
            0.00000000e00,
        ],
        [
            0.00000000e00,
            -5.55111512e-17,
            0.00000000e00,
            0.00000000e00,
            -2.80633504e-16,
            -4.64003715e-17,
            0.00000000e00,
            1.51058180e-16,
            3.77645449e-17,
            0.00000000e00,
            -1.68658479e-32,
            1.00000000e00,
            0.00000000e00,
            0.00000000e00,
            7.55594787e-03,
            1.36176830e-03,
            1.68235595e-01,
            0.00000000e00,
            2.02737260e-01,
            7.55594787e-03,
            1.36176830e-03,
            -1.68235595e-01,
            0.00000000e00,
            2.02737260e-01,
        ],
        [
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            -4.01839005e-17,
            0.00000000e00,
            0.00000000e00,
            3.27050553e-17,
            0.00000000e00,
            0.00000000e00,
            -2.92125054e-32,
            0.00000000e00,
            0.00000000e00,
            1.00000000e00,
            0.00000000e00,
            -1.12772296e-01,
            -2.03243511e-02,
            -1.68199281e-01,
            0.00000000e00,
            2.65107304e-02,
            1.12772296e-01,
            2.03243511e-02,
            -1.68199281e-01,
            0.00000000e00,
            -2.65107304e-02,
        ],
        [
            1.38777878e-17,
            5.55111512e-17,
            0.00000000e00,
            0.00000000e00,
            -4.86071487e-16,
            0.00000000e00,
            0.00000000e00,
            2.61640442e-16,
            3.08148791e-33,
            0.00000000e00,
            2.92125054e-32,
            0.00000000e00,
            0.00000000e00,
            1.00000000e00,
            7.34664477e-02,
            1.32404672e-02,
            -1.52440782e-02,
            0.00000000e00,
            -1.79899245e-01,
            7.34664477e-02,
            1.32404672e-02,
            1.52440782e-02,
            0.00000000e00,
            -1.79899245e-01,
        ],
        [
            3.11787250e-02,
            8.16269234e-02,
            2.90009819e-01,
            -8.94351202e-02,
            -2.57485300e-17,
            6.86422450e-02,
            -2.89809830e-01,
            0.00000000e00,
            2.22431606e-01,
            1.07969467e-17,
            -8.28675202e-18,
            7.55594787e-03,
            -1.12772296e-01,
            7.34664477e-02,
            3.45314048e-01,
            4.02447362e-01,
            1.75335869e-16,
            -2.16842531e-16,
            2.07533309e-17,
            4.03561245e-02,
            1.78113410e-01,
            -9.07405897e-02,
            -1.78873072e-17,
            2.59191100e-19,
        ],
        [
            6.94378271e-02,
            1.64922820e-01,
            6.45847815e-01,
            -5.78885101e-02,
            -2.73279706e-17,
            4.44299430e-02,
            -3.11548794e-01,
            0.00000000e00,
            2.39116452e-01,
            -4.36369019e-17,
            3.34917078e-17,
            1.36176830e-03,
            -2.03243511e-02,
            1.32404672e-02,
            4.02447362e-01,
            1.00000000e00,
            2.22505918e-16,
            -4.45011835e-16,
            0.00000000e00,
            1.78113410e-01,
            6.01418388e-01,
            -1.74034840e-01,
            -1.86289727e-16,
            0.00000000e00,
        ],
        [
            8.64125982e-02,
            1.61666634e-01,
            3.09939123e-01,
            -1.15045863e-01,
            -1.13182140e-16,
            1.89741811e-01,
            6.52075899e-02,
            0.00000000e00,
            2.48263133e-01,
            0.00000000e00,
            0.00000000e00,
            1.68235595e-01,
            -1.68199281e-01,
            -1.52440782e-02,
            1.75335869e-16,
            2.22505918e-16,
            1.00000000e00,
            0.00000000e00,
            0.00000000e00,
            9.07405897e-02,
            1.74034840e-01,
            -2.44484832e-01,
            0.00000000e00,
            0.00000000e00,
        ],
        [
            -3.96632585e-18,
            5.28575514e-17,
            -1.62324874e-16,
            6.14119964e-17,
            1.32171891e-01,
            -4.71342499e-17,
            0.00000000e00,
            3.88673747e-01,
            0.00000000e00,
            -2.49637790e-01,
            1.91599210e-01,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            -2.16842531e-16,
            -4.45011835e-16,
            0.00000000e00,
            1.00000000e00,
            0.00000000e00,
            -1.78873072e-17,
            -1.86289727e-16,
            0.00000000e00,
            4.83181555e-02,
            0.00000000e00,
        ],
        [
            -6.63224327e-02,
            -1.24080570e-01,
            -2.37881015e-01,
            1.89741811e-01,
            8.68682929e-17,
            -1.34566251e-02,
            2.48263133e-01,
            0.00000000e00,
            1.98129598e-01,
            0.00000000e00,
            0.00000000e00,
            2.02737260e-01,
            2.65107304e-02,
            -1.79899245e-01,
            2.07533309e-17,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            1.00000000e00,
            2.59191100e-19,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            4.83181555e-02,
        ],
        [
            3.11787250e-02,
            8.16269234e-02,
            2.90009819e-01,
            8.94351202e-02,
            -2.57485300e-17,
            6.86422450e-02,
            2.89809830e-01,
            0.00000000e00,
            2.22431606e-01,
            -1.07969467e-17,
            -8.28675202e-18,
            7.55594787e-03,
            1.12772296e-01,
            7.34664477e-02,
            4.03561245e-02,
            1.78113410e-01,
            9.07405897e-02,
            -1.78873072e-17,
            2.59191100e-19,
            3.45314048e-01,
            4.02447362e-01,
            -1.75335869e-16,
            -2.16842531e-16,
            2.07533309e-17,
        ],
        [
            6.94378271e-02,
            1.64922820e-01,
            6.45847815e-01,
            5.78885101e-02,
            -2.73279706e-17,
            4.44299430e-02,
            3.11548794e-01,
            0.00000000e00,
            2.39116452e-01,
            4.36369019e-17,
            3.34917078e-17,
            1.36176830e-03,
            2.03243511e-02,
            1.32404672e-02,
            1.78113410e-01,
            6.01418388e-01,
            1.74034840e-01,
            -1.86289727e-16,
            0.00000000e00,
            4.02447362e-01,
            1.00000000e00,
            -2.22505918e-16,
            -4.45011835e-16,
            0.00000000e00,
        ],
        [
            -8.64125982e-02,
            -1.61666634e-01,
            -3.09939123e-01,
            -1.15045863e-01,
            1.13182140e-16,
            -1.89741811e-01,
            6.52075899e-02,
            0.00000000e00,
            -2.48263133e-01,
            0.00000000e00,
            0.00000000e00,
            -1.68235595e-01,
            -1.68199281e-01,
            1.52440782e-02,
            -9.07405897e-02,
            -1.74034840e-01,
            -2.44484832e-01,
            0.00000000e00,
            0.00000000e00,
            -1.75335869e-16,
            -2.22505918e-16,
            1.00000000e00,
            0.00000000e00,
            0.00000000e00,
        ],
        [
            -3.96632585e-18,
            5.28575514e-17,
            -1.62324874e-16,
            -6.14119964e-17,
            1.32171891e-01,
            -4.71342499e-17,
            0.00000000e00,
            3.88673747e-01,
            0.00000000e00,
            2.49637790e-01,
            1.91599210e-01,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            -1.78873072e-17,
            -1.86289727e-16,
            0.00000000e00,
            4.83181555e-02,
            0.00000000e00,
            -2.16842531e-16,
            -4.45011835e-16,
            0.00000000e00,
            1.00000000e00,
            0.00000000e00,
        ],
        [
            -6.63224327e-02,
            -1.24080570e-01,
            -2.37881015e-01,
            -1.89741811e-01,
            8.68682929e-17,
            -1.34566251e-02,
            -2.48263133e-01,
            0.00000000e00,
            1.98129598e-01,
            0.00000000e00,
            0.00000000e00,
            2.02737260e-01,
            -2.65107304e-02,
            -1.79899245e-01,
            2.59191100e-19,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            4.83181555e-02,
            2.07533309e-17,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            1.00000000e00,
        ],
    ]
)


def test_olp():
    fn = context.get_fn("test/h2o_ccdz.xyz")
    obs = get_gobasis("cc-pvdz", fn, print_basis=False)

    olp = compute_overlap(obs)

    assert olp.nbasis == olp.nbasis1 == 24
    assert np.allclose(olp._array, ref)
