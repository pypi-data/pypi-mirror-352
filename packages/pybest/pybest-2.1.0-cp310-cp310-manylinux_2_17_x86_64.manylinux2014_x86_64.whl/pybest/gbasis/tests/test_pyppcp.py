# PyBEST: Pythonic Black-box Electronic Structure Tool
# Copyright (C) 2016-- The PyBEST Development Team
#
# This file is part of PyBEST.
#
# PyBEST is free software; you can redistribute it and/or
# modify it under the terms of the GNU General Public License
# as published by the Free Software Foundation; either version 3
# of the License, or (at your option) any later version.
#
# PyBEST is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program; if not, see <http://www.gnu.org/licenses/>
# --


import numpy as np
import pytest

import pybest
from pybest import context
from pybest.gbasis import compute_ppcp, get_charges, get_gobasis

ppcp_ref = np.array(
    [
        [
            -1.16022145e05,
            -1.67449025e04,
            -1.64099354e03,
            -1.92128155e02,
            -2.74180471e01,
            -4.57391449e00,
            -8.37558711e-01,
            -5.08411362e-02,
            -6.12676625e-03,
            0.00000000e00,
            -3.67876450e-01,
            6.43961989e-02,
            0.00000000e00,
            -5.52050791e-02,
            9.66356302e-03,
            0.00000000e00,
            -1.08338963e-02,
            1.89645665e-03,
            0.00000000e00,
            -2.04334662e-03,
            3.57684639e-04,
            0.00000000e00,
            -1.12159662e-06,
            -1.37911540e-06,
            0.00000000e00,
            -2.65639259e-06,
            2.50574185e-17,
            8.22427061e-04,
            5.91471341e-05,
            -5.77365920e-04,
            -1.37985729e-04,
            -6.19554468e-04,
            2.14359892e-04,
            2.50574185e-17,
            8.22427061e-04,
            5.91471341e-05,
            -5.77365920e-04,
            1.37985729e-04,
            -6.19554468e-04,
            2.14359892e-04,
        ],
        [
            -1.67449025e04,
            -1.74132212e04,
            -4.43091217e03,
            -6.97933064e02,
            -1.08789884e02,
            -1.86682190e01,
            -3.45246880e00,
            -2.10586403e-01,
            -2.53991432e-02,
            0.00000000e00,
            -1.42992362e00,
            2.50305900e-01,
            0.00000000e00,
            -2.25760014e-01,
            3.95189384e-02,
            0.00000000e00,
            -4.47593577e-02,
            7.83505577e-03,
            0.00000000e00,
            -8.46554718e-03,
            1.48188083e-03,
            0.00000000e00,
            -3.08676793e-05,
            -3.79549037e-05,
            0.00000000e00,
            -7.31070984e-05,
            1.33028325e-16,
            3.41927522e-03,
            2.41365081e-04,
            -2.39430210e-03,
            -5.90190611e-04,
            -2.57006042e-03,
            9.02932645e-04,
            1.33028325e-16,
            3.41927522e-03,
            2.41365081e-04,
            -2.39430210e-03,
            5.90190611e-04,
            -2.57006042e-03,
            9.02932645e-04,
        ],
        [
            -1.64099354e03,
            -4.43091217e03,
            -3.96771976e03,
            -1.32565077e03,
            -2.78623004e02,
            -5.31681395e01,
            -1.02200469e01,
            -6.35430907e-01,
            -7.69025324e-02,
            0.00000000e00,
            -3.31151253e00,
            5.79675105e-01,
            0.00000000e00,
            -6.47097741e-01,
            1.13273451e-01,
            0.00000000e00,
            -1.33676806e-01,
            2.33999164e-02,
            0.00000000e00,
            -2.55670074e-02,
            4.47546478e-03,
            0.00000000e00,
            -4.04252109e-04,
            -4.97068462e-04,
            0.00000000e00,
            -9.57431832e-04,
            1.04603233e-15,
            1.04710933e-02,
            6.84521328e-04,
            -7.25869551e-03,
            -2.00562912e-03,
            -7.80093015e-03,
            2.90581003e-03,
            1.04603233e-15,
            1.04710933e-02,
            6.84521328e-04,
            -7.25869551e-03,
            2.00562912e-03,
            -7.80093015e-03,
            2.90581003e-03,
        ],
        [
            -1.92128155e02,
            -6.97933064e02,
            -1.32565077e03,
            -1.12557320e03,
            -4.41813344e02,
            -1.12600520e02,
            -2.43445499e01,
            -1.60899248e00,
            -1.96902760e-01,
            0.00000000e00,
            -2.73701647e00,
            4.79110465e-01,
            0.00000000e00,
            -1.37714235e00,
            2.41066621e-01,
            0.00000000e00,
            -3.27150847e-01,
            5.72672457e-02,
            0.00000000e00,
            -6.49219021e-02,
            1.13644777e-02,
            0.00000000e00,
            -3.47902816e-03,
            -4.27781362e-03,
            0.00000000e00,
            -8.23974008e-03,
            4.41700255e-14,
            2.77955107e-02,
            1.36601101e-03,
            -1.86634174e-02,
            -6.95152991e-03,
            -2.01271241e-02,
            8.86660262e-03,
            4.41700255e-14,
            2.77955107e-02,
            1.36601101e-03,
            -1.86634174e-02,
            6.95152991e-03,
            -2.01271241e-02,
            8.86660262e-03,
        ],
        [
            -2.74180471e01,
            -1.08789884e02,
            -2.78623004e02,
            -4.41813344e02,
            -3.66578500e02,
            -1.60052114e02,
            -4.57721471e01,
            -3.56686686e00,
            -4.50518006e-01,
            0.00000000e00,
            6.48685322e00,
            -1.13551354e00,
            0.00000000e00,
            -1.71401040e00,
            3.00034848e-01,
            0.00000000e00,
            -6.54550226e-01,
            1.14577996e-01,
            0.00000000e00,
            -1.44987010e-01,
            2.53797500e-02,
            0.00000000e00,
            -2.12825797e-02,
            -2.61690636e-02,
            0.00000000e00,
            -5.04057216e-02,
            4.41745147e-11,
            6.99731279e-02,
            5.85092477e-04,
            -4.32201165e-02,
            -2.76273876e-02,
            -4.68916724e-02,
            2.94611145e-02,
            4.41745147e-11,
            6.99731279e-02,
            5.85092477e-04,
            -4.32201165e-02,
            2.76273876e-02,
            -4.68916724e-02,
            2.94611145e-02,
        ],
        [
            -4.57391449e00,
            -1.86682190e01,
            -5.31681395e01,
            -1.12600520e02,
            -1.60052114e02,
            -1.31366370e02,
            -6.08652506e01,
            -6.85455149e00,
            -9.38303286e-01,
            0.00000000e00,
            1.34569721e01,
            -2.35562199e00,
            0.00000000e00,
            5.93951077e-01,
            -1.03967069e-01,
            0.00000000e00,
            -9.22150718e-01,
            1.61422596e-01,
            0.00000000e00,
            -2.82566289e-01,
            4.94625194e-02,
            0.00000000e00,
            -8.48949439e-02,
            -1.04386067e-01,
            0.00000000e00,
            -2.01064126e-01,
            5.62756561e-07,
            1.78157622e-01,
            -1.25481982e-02,
            -9.28964969e-02,
            -1.18040784e-01,
            -9.98316352e-02,
            1.08238440e-01,
            5.62756561e-07,
            1.78157622e-01,
            -1.25481982e-02,
            -9.28964969e-02,
            1.18040784e-01,
            -9.98316352e-02,
            1.08238440e-01,
        ],
        [
            -8.37558711e-01,
            -3.45246880e00,
            -1.02200469e01,
            -2.43445499e01,
            -4.57721471e01,
            -6.08652506e01,
            -4.97404931e01,
            -1.07595170e01,
            -1.77002234e00,
            0.00000000e00,
            8.31014047e00,
            -1.45467703e00,
            0.00000000e00,
            5.20288365e00,
            -9.08200811e-01,
            0.00000000e00,
            -3.46078419e-01,
            6.29429550e-02,
            0.00000000e00,
            -4.41067115e-01,
            7.69627017e-02,
            0.00000000e00,
            -1.49738812e-01,
            -1.81832786e-01,
            0.00000000e00,
            -3.50792947e-01,
            2.14192333e-03,
            4.48473737e-01,
            -8.35660760e-02,
            -1.89102713e-01,
            -4.60542940e-01,
            -1.76582799e-01,
            3.84134133e-01,
            2.14192333e-03,
            4.48473737e-01,
            -8.35660760e-02,
            -1.89102713e-01,
            4.60542940e-01,
            -1.76582799e-01,
            3.84134133e-01,
        ],
        [
            -5.08411362e-02,
            -2.10586403e-01,
            -6.35430907e-01,
            -1.60899248e00,
            -3.56686686e00,
            -6.85455149e00,
            -1.07595170e01,
            -9.51592785e00,
            -3.23726486e00,
            0.00000000e00,
            1.05538453e00,
            -1.84743154e-01,
            0.00000000e00,
            3.35369257e00,
            -5.68033012e-01,
            0.00000000e00,
            2.03988198e00,
            -2.75010625e-01,
            0.00000000e00,
            -8.00993873e-02,
            2.36277702e-02,
            0.00000000e00,
            1.11253199e-01,
            2.93233468e-01,
            0.00000000e00,
            5.26399390e-01,
            2.75155719e-01,
            5.84311439e-01,
            -5.68820955e-01,
            -4.95227477e-01,
            -1.87954280e00,
            -6.38607555e-02,
            1.45590150e00,
            2.75155719e-01,
            5.84311439e-01,
            -5.68820955e-01,
            -4.95227477e-01,
            1.87954280e00,
            -6.38607555e-02,
            1.45590150e00,
        ],
        [
            -6.12676625e-03,
            -2.53991432e-02,
            -7.69025324e-02,
            -1.96902760e-01,
            -4.50518006e-01,
            -9.38303286e-01,
            -1.77002234e00,
            -3.23726486e00,
            -2.42337311e00,
            0.00000000e00,
            1.47100558e-01,
            -2.57496609e-02,
            0.00000000e00,
            7.09608027e-01,
            -1.18026007e-01,
            0.00000000e00,
            1.15520461e00,
            -1.41858257e-01,
            0.00000000e00,
            4.63759630e-01,
            -5.00105007e-02,
            0.00000000e00,
            9.63389564e-02,
            2.55745401e-01,
            0.00000000e00,
            4.57519522e-01,
            -5.06601402e-02,
            -2.84150307e-01,
            -8.51312549e-01,
            -6.59090439e-01,
            -1.32482628e00,
            1.88853450e-01,
            9.97810404e-01,
            -5.06601402e-02,
            -2.84150307e-01,
            -8.51312549e-01,
            -6.59090439e-01,
            1.32482628e00,
            1.88853450e-01,
            9.97810404e-01,
        ],
        [
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            -2.90824859e02,
            0.00000000e00,
            0.00000000e00,
            -5.36752067e01,
            0.00000000e00,
            0.00000000e00,
            -4.79888127e00,
            0.00000000e00,
            0.00000000e00,
            -3.10580874e-01,
            0.00000000e00,
            0.00000000e00,
            -3.24086496e-01,
            0.00000000e00,
            0.00000000e00,
            5.33428604e-02,
            0.00000000e00,
            -1.68833994e-07,
            -1.22733875e-01,
            8.97837907e-02,
            1.80165929e-02,
            2.99732821e-01,
            3.13940611e-02,
            -2.56973910e-01,
            1.68833994e-07,
            1.22733875e-01,
            -8.97837907e-02,
            -1.80165929e-02,
            2.99732821e-01,
            -3.13940611e-02,
            2.56973910e-01,
        ],
        [
            -3.67876450e-01,
            -1.42992362e00,
            -3.31151253e00,
            -2.73701647e00,
            6.48685322e00,
            1.34569721e01,
            8.31014047e00,
            1.05538453e00,
            1.47100558e-01,
            0.00000000e00,
            -2.94281880e02,
            7.29821343e-01,
            0.00000000e00,
            -5.37411900e01,
            1.39296155e-02,
            0.00000000e00,
            -4.38345011e00,
            -8.77029383e-02,
            0.00000000e00,
            -1.87328436e-01,
            -2.60201328e-02,
            0.00000000e00,
            1.18097678e-01,
            2.57584886e-01,
            0.00000000e00,
            4.62236145e-01,
            -2.28117747e-09,
            -1.60866312e-02,
            1.29018489e-02,
            1.42598412e-02,
            3.69483789e-02,
            1.33365600e-02,
            -3.72113947e-02,
            -2.28117747e-09,
            -1.60866312e-02,
            1.29018489e-02,
            1.42598412e-02,
            -3.69483789e-02,
            1.33365600e-02,
            -3.72113947e-02,
        ],
        [
            6.43961989e-02,
            2.50305900e-01,
            5.79675105e-01,
            4.79110465e-01,
            -1.13551354e00,
            -2.35562199e00,
            -1.45467703e00,
            -1.84743154e-01,
            -2.57496609e-02,
            0.00000000e00,
            7.29821343e-01,
            -2.90999047e02,
            0.00000000e00,
            1.39296155e-02,
            -5.36785313e01,
            0.00000000e00,
            -8.77029383e-02,
            -4.77794895e00,
            0.00000000e00,
            -2.60201328e-02,
            -3.04370577e-01,
            0.00000000e00,
            -3.40172531e-01,
            4.48457828e-02,
            0.00000000e00,
            -3.23774090e-02,
            1.29930672e-07,
            9.70145676e-02,
            -7.08063183e-02,
            -1.61682044e-02,
            -2.57363717e-01,
            -3.29484067e-02,
            1.75484464e-01,
            1.29930672e-07,
            9.70145676e-02,
            -7.08063183e-02,
            -1.61682044e-02,
            2.57363717e-01,
            -3.29484067e-02,
            1.75484464e-01,
        ],
        [
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            -5.36752067e01,
            0.00000000e00,
            0.00000000e00,
            -6.23752965e01,
            0.00000000e00,
            0.00000000e00,
            -1.63168291e01,
            0.00000000e00,
            0.00000000e00,
            -1.63711840e00,
            0.00000000e00,
            0.00000000e00,
            1.50487301e00,
            0.00000000e00,
            0.00000000e00,
            -2.65647267e-01,
            0.00000000e00,
            -4.11569254e-02,
            -6.44696389e-01,
            5.36749902e-01,
            1.07171121e-01,
            1.61783295e00,
            4.59926094e-02,
            -1.47721879e00,
            4.11569254e-02,
            6.44696389e-01,
            -5.36749902e-01,
            -1.07171121e-01,
            1.61783295e00,
            -4.59926094e-02,
            1.47721879e00,
        ],
        [
            -5.52050791e-02,
            -2.25760014e-01,
            -6.47097741e-01,
            -1.37714235e00,
            -1.71401040e00,
            5.93951077e-01,
            5.20288365e00,
            3.35369257e00,
            7.09608027e-01,
            0.00000000e00,
            -5.37411900e01,
            1.39296155e-02,
            0.00000000e00,
            -6.55410975e01,
            6.57291815e-01,
            0.00000000e00,
            -1.64369784e01,
            1.12847670e-02,
            0.00000000e00,
            -1.21944130e00,
            -8.66704624e-02,
            0.00000000e00,
            -2.40668036e-02,
            -6.16127485e-01,
            0.00000000e00,
            -1.00706267e00,
            -5.05928169e-04,
            -8.62905034e-02,
            1.03917736e-01,
            8.32163053e-02,
            2.75402934e-01,
            -1.52910452e-01,
            -2.42164617e-01,
            -5.05928169e-04,
            -8.62905034e-02,
            1.03917736e-01,
            8.32163053e-02,
            -2.75402934e-01,
            -1.52910452e-01,
            -2.42164617e-01,
        ],
        [
            9.66356302e-03,
            3.95189384e-02,
            1.13273451e-01,
            2.41066621e-01,
            3.00034848e-01,
            -1.03967069e-01,
            -9.08200811e-01,
            -5.68033012e-01,
            -1.18026007e-01,
            0.00000000e00,
            1.39296155e-02,
            -5.36785313e01,
            0.00000000e00,
            6.57291815e-01,
            -6.25314213e01,
            0.00000000e00,
            1.12847670e-02,
            -1.63185630e01,
            0.00000000e00,
            -8.66704624e-02,
            -1.61653513e00,
            0.00000000e00,
            1.44477157e00,
            -3.68419815e-01,
            0.00000000e00,
            -1.20790232e-01,
            3.16507701e-02,
            5.08284022e-01,
            -4.28936584e-01,
            -9.53640570e-02,
            -1.51815874e00,
            -6.60901655e-02,
            8.73511520e-01,
            3.16507701e-02,
            5.08284022e-01,
            -4.28936584e-01,
            -9.53640570e-02,
            1.51815874e00,
            -6.60901655e-02,
            8.73511520e-01,
        ],
        [
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            -4.79888127e00,
            0.00000000e00,
            0.00000000e00,
            -1.63168291e01,
            0.00000000e00,
            0.00000000e00,
            -1.60101281e01,
            0.00000000e00,
            0.00000000e00,
            -3.99320841e00,
            0.00000000e00,
            0.00000000e00,
            3.96401730e00,
            0.00000000e00,
            0.00000000e00,
            -5.97183354e-01,
            0.00000000e00,
            -3.42377615e-01,
            3.11213644e-01,
            1.58018066e00,
            3.37563075e-01,
            3.12401475e00,
            -3.01623587e-01,
            -3.36903070e00,
            3.42377615e-01,
            -3.11213644e-01,
            -1.58018066e00,
            -3.37563075e-01,
            3.12401475e00,
            3.01623587e-01,
            3.36903070e00,
        ],
        [
            -1.08338963e-02,
            -4.47593577e-02,
            -1.33676806e-01,
            -3.27150847e-01,
            -6.54550226e-01,
            -9.22150718e-01,
            -3.46078419e-01,
            2.03988198e00,
            1.15520461e00,
            0.00000000e00,
            -4.38345011e00,
            -8.77029383e-02,
            0.00000000e00,
            -1.64369784e01,
            1.12847670e-02,
            0.00000000e00,
            -1.67787623e01,
            6.34619526e-02,
            0.00000000e00,
            -3.88020644e00,
            -3.56072133e-02,
            0.00000000e00,
            -4.77195801e-01,
            -2.29200822e00,
            0.00000000e00,
            -3.93752533e00,
            -2.54875596e-02,
            -1.36304100e-01,
            2.09439875e-01,
            2.11662815e-01,
            4.34591764e-01,
            -1.24262712e00,
            -3.52853158e-01,
            -2.54875596e-02,
            -1.36304100e-01,
            2.09439875e-01,
            2.11662815e-01,
            -4.34591764e-01,
            -1.24262712e00,
            -3.52853158e-01,
        ],
        [
            1.89645665e-03,
            7.83505577e-03,
            2.33999164e-02,
            5.72672457e-02,
            1.14577996e-01,
            1.61422596e-01,
            6.29429550e-02,
            -2.75010625e-01,
            -1.41858257e-01,
            0.00000000e00,
            -8.77029383e-02,
            -4.77794895e00,
            0.00000000e00,
            1.12847670e-02,
            -1.63185630e01,
            0.00000000e00,
            6.34619526e-02,
            -1.60179561e01,
            0.00000000e00,
            -3.56072133e-02,
            -3.98306005e00,
            0.00000000e00,
            3.93166794e00,
            -7.10006449e-01,
            0.00000000e00,
            -5.99937762e-02,
            2.65732300e-01,
            -2.19740295e-01,
            -1.23517922e00,
            -2.83422474e-01,
            -3.46300340e00,
            2.12198629e-01,
            1.30332884e00,
            2.65732300e-01,
            -2.19740295e-01,
            -1.23517922e00,
            -2.83422474e-01,
            3.46300340e00,
            2.12198629e-01,
            1.30332884e00,
        ],
        [
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            -3.10580874e-01,
            0.00000000e00,
            0.00000000e00,
            -1.63711840e00,
            0.00000000e00,
            0.00000000e00,
            -3.99320841e00,
            0.00000000e00,
            0.00000000e00,
            -3.53272732e00,
            0.00000000e00,
            0.00000000e00,
            1.43948570e00,
            0.00000000e00,
            0.00000000e00,
            -2.09058018e-01,
            0.00000000e00,
            3.58193829e-01,
            1.24182571e00,
            1.69041408e00,
            5.80248703e-01,
            7.26332419e-01,
            -5.22021597e-01,
            -1.58970563e00,
            -3.58193829e-01,
            -1.24182571e00,
            -1.69041408e00,
            -5.80248703e-01,
            7.26332419e-01,
            5.22021597e-01,
            1.58970563e00,
        ],
        [
            -2.04334662e-03,
            -8.46554718e-03,
            -2.55670074e-02,
            -6.49219021e-02,
            -1.44987010e-01,
            -2.82566289e-01,
            -4.41067115e-01,
            -8.00993873e-02,
            4.63759630e-01,
            0.00000000e00,
            -1.87328436e-01,
            -2.60201328e-02,
            0.00000000e00,
            -1.21944130e00,
            -8.66704624e-02,
            0.00000000e00,
            -3.88020644e00,
            -3.56072133e-02,
            0.00000000e00,
            -3.66674769e00,
            1.30739138e-02,
            0.00000000e00,
            -1.35541173e-01,
            -7.62737570e-01,
            0.00000000e00,
            -1.30091305e00,
            -4.19116693e-02,
            -1.22117949e-01,
            4.45891694e-02,
            1.94523826e-01,
            4.25095517e-02,
            -1.36711547e00,
            -4.04807410e-02,
            -4.19116693e-02,
            -1.22117949e-01,
            4.45891694e-02,
            1.94523826e-01,
            -4.25095517e-02,
            -1.36711547e00,
            -4.04807410e-02,
        ],
        [
            3.57684639e-04,
            1.48188083e-03,
            4.47546478e-03,
            1.13644777e-02,
            2.53797500e-02,
            4.94625194e-02,
            7.69627017e-02,
            2.36277702e-02,
            -5.00105007e-02,
            0.00000000e00,
            -2.60201328e-02,
            -3.04370577e-01,
            0.00000000e00,
            -8.66704624e-02,
            -1.61653513e00,
            0.00000000e00,
            -3.56072133e-02,
            -3.98306005e00,
            0.00000000e00,
            1.30739138e-02,
            -3.53260750e00,
            0.00000000e00,
            1.41929852e00,
            -2.59712995e-01,
            0.00000000e00,
            -3.67584224e-02,
            -2.70195846e-01,
            -9.38231515e-01,
            -1.30036826e00,
            -4.67369603e-01,
            -1.65227574e00,
            3.92801904e-01,
            -2.05969575e-01,
            -2.70195846e-01,
            -9.38231515e-01,
            -1.30036826e00,
            -4.67369603e-01,
            1.65227574e00,
            3.92801904e-01,
            -2.05969575e-01,
        ],
        [
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            -3.24086496e-01,
            0.00000000e00,
            0.00000000e00,
            1.50487301e00,
            0.00000000e00,
            0.00000000e00,
            3.96401730e00,
            0.00000000e00,
            0.00000000e00,
            1.43948570e00,
            0.00000000e00,
            0.00000000e00,
            -2.65441475e01,
            0.00000000e00,
            0.00000000e00,
            4.07330653e-01,
            0.00000000e00,
            5.17666392e-02,
            4.20197989e-02,
            -5.43834218e-01,
            -1.52202392e-01,
            -8.40285301e-01,
            2.80283728e00,
            8.96583327e-01,
            -5.17666392e-02,
            -4.20197989e-02,
            5.43834218e-01,
            1.52202392e-01,
            -8.40285301e-01,
            -2.80283728e00,
            -8.96583327e-01,
        ],
        [
            -1.12159662e-06,
            -3.08676793e-05,
            -4.04252109e-04,
            -3.47902816e-03,
            -2.12825797e-02,
            -8.48949439e-02,
            -1.49738812e-01,
            1.11253199e-01,
            9.63389564e-02,
            0.00000000e00,
            1.18097678e-01,
            -3.40172531e-01,
            0.00000000e00,
            -2.40668036e-02,
            1.44477157e00,
            0.00000000e00,
            -4.77195801e-01,
            3.93166794e00,
            0.00000000e00,
            -1.35541173e-01,
            1.41929852e00,
            0.00000000e00,
            -2.65104097e01,
            3.51519646e-01,
            0.00000000e00,
            -1.52304532e-01,
            -3.99641471e-02,
            -4.31685912e-02,
            4.24376319e-01,
            1.33830217e-01,
            9.38961392e-01,
            -2.16996770e00,
            -3.28825051e-01,
            -3.99641471e-02,
            -4.31685912e-02,
            4.24376319e-01,
            1.33830217e-01,
            -9.38961392e-01,
            -2.16996770e00,
            -3.28825051e-01,
        ],
        [
            -1.37911540e-06,
            -3.79549037e-05,
            -4.97068462e-04,
            -4.27781362e-03,
            -2.61690636e-02,
            -1.04386067e-01,
            -1.81832786e-01,
            2.93233468e-01,
            2.55745401e-01,
            0.00000000e00,
            2.57584886e-01,
            4.48457828e-02,
            0.00000000e00,
            -6.16127485e-01,
            -3.68419815e-01,
            0.00000000e00,
            -2.29200822e00,
            -7.10006449e-01,
            0.00000000e00,
            -7.62737570e-01,
            -2.59712995e-01,
            0.00000000e00,
            3.51519646e-01,
            -2.49399368e01,
            0.00000000e00,
            -1.19211119e00,
            1.58828323e-02,
            -1.52473165e-01,
            -1.31706975e-01,
            2.36621476e-02,
            -1.96800037e00,
            -1.18836752e-01,
            -2.02035701e00,
            1.58828323e-02,
            -1.52473165e-01,
            -1.31706975e-01,
            2.36621476e-02,
            1.96800037e00,
            -1.18836752e-01,
            -2.02035701e00,
        ],
        [
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            5.33428604e-02,
            0.00000000e00,
            0.00000000e00,
            -2.65647267e-01,
            0.00000000e00,
            0.00000000e00,
            -5.97183354e-01,
            0.00000000e00,
            0.00000000e00,
            -2.09058018e-01,
            0.00000000e00,
            0.00000000e00,
            4.07330653e-01,
            0.00000000e00,
            0.00000000e00,
            -2.41913980e01,
            0.00000000e00,
            -1.74141373e-01,
            2.03369883e00,
            1.56992029e00,
            1.16102904e-01,
            3.69699144e00,
            -4.12976619e-01,
            -1.75708829e00,
            1.74141373e-01,
            -2.03369883e00,
            -1.56992029e00,
            -1.16102904e-01,
            3.69699144e00,
            4.12976619e-01,
            1.75708829e00,
        ],
        [
            -2.65639259e-06,
            -7.31070984e-05,
            -9.57431832e-04,
            -8.23974008e-03,
            -5.04057216e-02,
            -2.01064126e-01,
            -3.50792947e-01,
            5.26399390e-01,
            4.57519522e-01,
            0.00000000e00,
            4.62236145e-01,
            -3.23774090e-02,
            0.00000000e00,
            -1.00706267e00,
            -1.20790232e-01,
            0.00000000e00,
            -3.93752533e00,
            -5.99937762e-02,
            0.00000000e00,
            -1.30091305e00,
            -3.67584224e-02,
            0.00000000e00,
            -1.52304532e-01,
            -1.19211119e00,
            0.00000000e00,
            -2.61235160e01,
            1.08314835e-01,
            -1.36474457e00,
            -9.01185928e-01,
            3.05393416e-02,
            -9.31544205e-01,
            -4.86685252e-02,
            2.65459379e00,
            1.08314835e-01,
            -1.36474457e00,
            -9.01185928e-01,
            3.05393416e-02,
            9.31544205e-01,
            -4.86685252e-02,
            2.65459379e00,
        ],
        [
            2.50574185e-17,
            1.33028325e-16,
            1.04603233e-15,
            4.41700255e-14,
            4.41745147e-11,
            5.62756561e-07,
            2.14192333e-03,
            2.75155719e-01,
            -5.06601402e-02,
            -1.68833994e-07,
            -2.28117747e-09,
            1.29930672e-07,
            -4.11569254e-02,
            -5.05928169e-04,
            3.16507701e-02,
            -3.42377615e-01,
            -2.54875596e-02,
            2.65732300e-01,
            3.58193829e-01,
            -4.19116693e-02,
            -2.70195846e-01,
            5.17666392e-02,
            -3.99641471e-02,
            1.58828323e-02,
            -1.74141373e-01,
            1.08314835e-01,
            -9.17385625e01,
            -1.33308733e01,
            -1.29599841e00,
            -1.43264112e-01,
            1.85878989e-01,
            -2.35906408e-01,
            -1.16387646e-01,
            1.12290753e-20,
            8.37950928e-05,
            5.82652849e-02,
            -6.29014299e-03,
            -1.04710240e-01,
            -1.61775255e-03,
            -8.15340820e-04,
        ],
        [
            8.22427061e-04,
            3.41927522e-03,
            1.04710933e-02,
            2.77955107e-02,
            6.99731279e-02,
            1.78157622e-01,
            4.48473737e-01,
            5.84311439e-01,
            -2.84150307e-01,
            -1.22733875e-01,
            -1.60866312e-02,
            9.70145676e-02,
            -6.44696389e-01,
            -8.62905034e-02,
            5.08284022e-01,
            3.11213644e-01,
            -1.36304100e-01,
            -2.19740295e-01,
            1.24182571e00,
            -1.22117949e-01,
            -9.38231515e-01,
            4.20197989e-02,
            -4.31685912e-02,
            -1.52473165e-01,
            2.03369883e00,
            -1.36474457e00,
            -1.33308733e01,
            -1.38348211e01,
            -3.49533419e00,
            -5.21063840e-01,
            -1.91191472e-01,
            2.42779512e-01,
            1.19708881e-01,
            8.37950928e-05,
            2.13077680e-02,
            2.14282608e-01,
            -3.73513044e-02,
            -4.15580426e-01,
            -2.85089524e-02,
            -1.56797734e-02,
        ],
        [
            5.91471341e-05,
            2.41365081e-04,
            6.84521328e-04,
            1.36601101e-03,
            5.85092477e-04,
            -1.25481982e-02,
            -8.35660760e-02,
            -5.68820955e-01,
            -8.51312549e-01,
            8.97837907e-02,
            1.29018489e-02,
            -7.08063183e-02,
            5.36749902e-01,
            1.03917736e-01,
            -4.28936584e-01,
            1.58018066e00,
            2.09439875e-01,
            -1.23517922e00,
            1.69041408e00,
            4.45891694e-02,
            -1.30036826e00,
            -5.43834218e-01,
            4.24376319e-01,
            -1.31706975e-01,
            1.56992029e00,
            -9.01185928e-01,
            -1.29599841e00,
            -3.49533419e00,
            -3.09417178e00,
            -9.59514038e-01,
            -6.42425050e-01,
            8.26176133e-01,
            4.00134189e-01,
            5.82652849e-02,
            2.14282608e-01,
            1.61046250e-01,
            -1.69681108e-01,
            7.71659770e-02,
            -7.18301655e-02,
            -4.26937138e-02,
        ],
        [
            -5.77365920e-04,
            -2.39430210e-03,
            -7.25869551e-03,
            -1.86634174e-02,
            -4.32201165e-02,
            -9.28964969e-02,
            -1.89102713e-01,
            -4.95227477e-01,
            -6.59090439e-01,
            1.80165929e-02,
            1.42598412e-02,
            -1.61682044e-02,
            1.07171121e-01,
            8.32163053e-02,
            -9.53640570e-02,
            3.37563075e-01,
            2.11662815e-01,
            -2.83422474e-01,
            5.80248703e-01,
            1.94523826e-01,
            -4.67369603e-01,
            -1.52202392e-01,
            1.33830217e-01,
            2.36621476e-02,
            1.16102904e-01,
            3.05393416e-02,
            -1.43264112e-01,
            -5.21063840e-01,
            -9.59514038e-01,
            -6.94089722e-01,
            -2.15801015e-01,
            2.79980487e-01,
            1.33608792e-01,
            -6.29014299e-03,
            -3.73513044e-02,
            -1.69681108e-01,
            -2.65743171e-01,
            3.19855131e-01,
            3.13294739e-02,
            1.15327037e-02,
        ],
        [
            -1.37985729e-04,
            -5.90190611e-04,
            -2.00562912e-03,
            -6.95152991e-03,
            -2.76273876e-02,
            -1.18040784e-01,
            -4.60542940e-01,
            -1.87954280e00,
            -1.32482628e00,
            2.99732821e-01,
            3.69483789e-02,
            -2.57363717e-01,
            1.61783295e00,
            2.75402934e-01,
            -1.51815874e00,
            3.12401475e00,
            4.34591764e-01,
            -3.46300340e00,
            7.26332419e-01,
            4.25095517e-02,
            -1.65227574e00,
            -8.40285301e-01,
            9.38961392e-01,
            -1.96800037e00,
            3.69699144e00,
            -9.31544205e-01,
            1.85878989e-01,
            -1.91191472e-01,
            -6.42425050e-01,
            -2.15801015e-01,
            -8.51367967e00,
            2.80648526e-01,
            1.45891625e-01,
            1.04710240e-01,
            4.15580426e-01,
            -7.71659770e-02,
            -3.19855131e-01,
            6.23544019e-01,
            -8.16730567e-02,
            -5.09493214e-02,
        ],
        [
            -6.19554468e-04,
            -2.57006042e-03,
            -7.80093015e-03,
            -2.01271241e-02,
            -4.68916724e-02,
            -9.98316352e-02,
            -1.76582799e-01,
            -6.38607555e-02,
            1.88853450e-01,
            3.13940611e-02,
            1.33365600e-02,
            -3.29484067e-02,
            4.59926094e-02,
            -1.52910452e-01,
            -6.60901655e-02,
            -3.01623587e-01,
            -1.24262712e00,
            2.12198629e-01,
            -5.22021597e-01,
            -1.36711547e00,
            3.92801904e-01,
            2.80283728e00,
            -2.16996770e00,
            -1.18836752e-01,
            -4.12976619e-01,
            -4.86685252e-02,
            -2.35906408e-01,
            2.42779512e-01,
            8.26176133e-01,
            2.79980487e-01,
            2.80648526e-01,
            -8.65318119e00,
            -1.80654802e-01,
            -1.61775255e-03,
            -2.85089524e-02,
            -7.18301655e-02,
            3.13294739e-02,
            8.16730567e-02,
            1.40155760e-01,
            3.46559098e-02,
        ],
        [
            2.14359892e-04,
            9.02932645e-04,
            2.90581003e-03,
            8.86660262e-03,
            2.94611145e-02,
            1.08238440e-01,
            3.84134133e-01,
            1.45590150e00,
            9.97810404e-01,
            -2.56973910e-01,
            -3.72113947e-02,
            1.75484464e-01,
            -1.47721879e00,
            -2.42164617e-01,
            8.73511520e-01,
            -3.36903070e00,
            -3.52853158e-01,
            1.30332884e00,
            -1.58970563e00,
            -4.04807410e-02,
            -2.05969575e-01,
            8.96583327e-01,
            -3.28825051e-01,
            -2.02035701e00,
            -1.75708829e00,
            2.65459379e00,
            -1.16387646e-01,
            1.19708881e-01,
            4.00134189e-01,
            1.33608792e-01,
            1.45891625e-01,
            -1.80654802e-01,
            -8.36464935e00,
            -8.15340820e-04,
            -1.56797734e-02,
            -4.26937138e-02,
            1.15327037e-02,
            5.09493214e-02,
            3.46559098e-02,
            1.09192614e-01,
        ],
        [
            2.50574185e-17,
            1.33028325e-16,
            1.04603233e-15,
            4.41700255e-14,
            4.41745147e-11,
            5.62756561e-07,
            2.14192333e-03,
            2.75155719e-01,
            -5.06601402e-02,
            1.68833994e-07,
            -2.28117747e-09,
            1.29930672e-07,
            4.11569254e-02,
            -5.05928169e-04,
            3.16507701e-02,
            3.42377615e-01,
            -2.54875596e-02,
            2.65732300e-01,
            -3.58193829e-01,
            -4.19116693e-02,
            -2.70195846e-01,
            -5.17666392e-02,
            -3.99641471e-02,
            1.58828323e-02,
            1.74141373e-01,
            1.08314835e-01,
            1.12290753e-20,
            8.37950928e-05,
            5.82652849e-02,
            -6.29014299e-03,
            1.04710240e-01,
            -1.61775255e-03,
            -8.15340820e-04,
            -9.17385625e01,
            -1.33308733e01,
            -1.29599841e00,
            -1.43264112e-01,
            -1.85878989e-01,
            -2.35906408e-01,
            -1.16387646e-01,
        ],
        [
            8.22427061e-04,
            3.41927522e-03,
            1.04710933e-02,
            2.77955107e-02,
            6.99731279e-02,
            1.78157622e-01,
            4.48473737e-01,
            5.84311439e-01,
            -2.84150307e-01,
            1.22733875e-01,
            -1.60866312e-02,
            9.70145676e-02,
            6.44696389e-01,
            -8.62905034e-02,
            5.08284022e-01,
            -3.11213644e-01,
            -1.36304100e-01,
            -2.19740295e-01,
            -1.24182571e00,
            -1.22117949e-01,
            -9.38231515e-01,
            -4.20197989e-02,
            -4.31685912e-02,
            -1.52473165e-01,
            -2.03369883e00,
            -1.36474457e00,
            8.37950928e-05,
            2.13077680e-02,
            2.14282608e-01,
            -3.73513044e-02,
            4.15580426e-01,
            -2.85089524e-02,
            -1.56797734e-02,
            -1.33308733e01,
            -1.38348211e01,
            -3.49533419e00,
            -5.21063840e-01,
            1.91191472e-01,
            2.42779512e-01,
            1.19708881e-01,
        ],
        [
            5.91471341e-05,
            2.41365081e-04,
            6.84521328e-04,
            1.36601101e-03,
            5.85092477e-04,
            -1.25481982e-02,
            -8.35660760e-02,
            -5.68820955e-01,
            -8.51312549e-01,
            -8.97837907e-02,
            1.29018489e-02,
            -7.08063183e-02,
            -5.36749902e-01,
            1.03917736e-01,
            -4.28936584e-01,
            -1.58018066e00,
            2.09439875e-01,
            -1.23517922e00,
            -1.69041408e00,
            4.45891694e-02,
            -1.30036826e00,
            5.43834218e-01,
            4.24376319e-01,
            -1.31706975e-01,
            -1.56992029e00,
            -9.01185928e-01,
            5.82652849e-02,
            2.14282608e-01,
            1.61046250e-01,
            -1.69681108e-01,
            -7.71659770e-02,
            -7.18301655e-02,
            -4.26937138e-02,
            -1.29599841e00,
            -3.49533419e00,
            -3.09417178e00,
            -9.59514038e-01,
            6.42425050e-01,
            8.26176133e-01,
            4.00134189e-01,
        ],
        [
            -5.77365920e-04,
            -2.39430210e-03,
            -7.25869551e-03,
            -1.86634174e-02,
            -4.32201165e-02,
            -9.28964969e-02,
            -1.89102713e-01,
            -4.95227477e-01,
            -6.59090439e-01,
            -1.80165929e-02,
            1.42598412e-02,
            -1.61682044e-02,
            -1.07171121e-01,
            8.32163053e-02,
            -9.53640570e-02,
            -3.37563075e-01,
            2.11662815e-01,
            -2.83422474e-01,
            -5.80248703e-01,
            1.94523826e-01,
            -4.67369603e-01,
            1.52202392e-01,
            1.33830217e-01,
            2.36621476e-02,
            -1.16102904e-01,
            3.05393416e-02,
            -6.29014299e-03,
            -3.73513044e-02,
            -1.69681108e-01,
            -2.65743171e-01,
            -3.19855131e-01,
            3.13294739e-02,
            1.15327037e-02,
            -1.43264112e-01,
            -5.21063840e-01,
            -9.59514038e-01,
            -6.94089722e-01,
            2.15801015e-01,
            2.79980487e-01,
            1.33608792e-01,
        ],
        [
            1.37985729e-04,
            5.90190611e-04,
            2.00562912e-03,
            6.95152991e-03,
            2.76273876e-02,
            1.18040784e-01,
            4.60542940e-01,
            1.87954280e00,
            1.32482628e00,
            2.99732821e-01,
            -3.69483789e-02,
            2.57363717e-01,
            1.61783295e00,
            -2.75402934e-01,
            1.51815874e00,
            3.12401475e00,
            -4.34591764e-01,
            3.46300340e00,
            7.26332419e-01,
            -4.25095517e-02,
            1.65227574e00,
            -8.40285301e-01,
            -9.38961392e-01,
            1.96800037e00,
            3.69699144e00,
            9.31544205e-01,
            -1.04710240e-01,
            -4.15580426e-01,
            7.71659770e-02,
            3.19855131e-01,
            6.23544019e-01,
            8.16730567e-02,
            5.09493214e-02,
            -1.85878989e-01,
            1.91191472e-01,
            6.42425050e-01,
            2.15801015e-01,
            -8.51367967e00,
            -2.80648526e-01,
            -1.45891625e-01,
        ],
        [
            -6.19554468e-04,
            -2.57006042e-03,
            -7.80093015e-03,
            -2.01271241e-02,
            -4.68916724e-02,
            -9.98316352e-02,
            -1.76582799e-01,
            -6.38607555e-02,
            1.88853450e-01,
            -3.13940611e-02,
            1.33365600e-02,
            -3.29484067e-02,
            -4.59926094e-02,
            -1.52910452e-01,
            -6.60901655e-02,
            3.01623587e-01,
            -1.24262712e00,
            2.12198629e-01,
            5.22021597e-01,
            -1.36711547e00,
            3.92801904e-01,
            -2.80283728e00,
            -2.16996770e00,
            -1.18836752e-01,
            4.12976619e-01,
            -4.86685252e-02,
            -1.61775255e-03,
            -2.85089524e-02,
            -7.18301655e-02,
            3.13294739e-02,
            -8.16730567e-02,
            1.40155760e-01,
            3.46559098e-02,
            -2.35906408e-01,
            2.42779512e-01,
            8.26176133e-01,
            2.79980487e-01,
            -2.80648526e-01,
            -8.65318119e00,
            -1.80654802e-01,
        ],
        [
            2.14359892e-04,
            9.02932645e-04,
            2.90581003e-03,
            8.86660262e-03,
            2.94611145e-02,
            1.08238440e-01,
            3.84134133e-01,
            1.45590150e00,
            9.97810404e-01,
            2.56973910e-01,
            -3.72113947e-02,
            1.75484464e-01,
            1.47721879e00,
            -2.42164617e-01,
            8.73511520e-01,
            3.36903070e00,
            -3.52853158e-01,
            1.30332884e00,
            1.58970563e00,
            -4.04807410e-02,
            -2.05969575e-01,
            -8.96583327e-01,
            -3.28825051e-01,
            -2.02035701e00,
            1.75708829e00,
            2.65459379e00,
            -8.15340820e-04,
            -1.56797734e-02,
            -4.26937138e-02,
            1.15327037e-02,
            -5.09493214e-02,
            3.46559098e-02,
            1.09192614e-01,
            -1.16387646e-01,
            1.19708881e-01,
            4.00134189e-01,
            1.33608792e-01,
            -1.45891625e-01,
            -1.80654802e-01,
            -8.36464935e00,
        ],
    ]
)


@pytest.mark.skipif(
    not pybest.gbasis.dense_ints.PYBEST_PVP_ENABLED,
    reason="pVp integrals not supported. pPCp integrals can not be calculated",
)
def test_ppcp():
    coord_file = context.get_fn("test/h2o_ccdz.xyz")
    basis = get_gobasis("cc-pvdz", coord_file, print_basis=False)
    pc_file = context.get_fn("test/water_pc.pc")
    charges = get_charges(pc_file)

    ppcp = compute_ppcp(basis, charges)

    assert ppcp.nbasis == ppcp.nbasis1 == 40
    assert np.allclose(ppcp._array, ppcp_ref)
