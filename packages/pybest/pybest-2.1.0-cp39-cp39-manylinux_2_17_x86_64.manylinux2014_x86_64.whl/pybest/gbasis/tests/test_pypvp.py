# PyBEST: Pythonic Black-box Electronic Structure Tool
# Copyright (C) 2016-- The PyBEST Development Team
#
# This file is part of PyBEST.
#
# PyBEST is free software; you can redistribute it and/or
# modify it under the terms of the GNU General Public License
# as published by the Free Software Foundation; either version 3
# of the License, or (at your option) any later version.
#
# PyBEST is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program; if not, see <http://www.gnu.org/licenses/>
# --


import numpy as np
import pytest

import pybest
from pybest import context
from pybest.gbasis import compute_pvp, get_gobasis

ref = np.array(
    [
        [
            -3.24339022e07,
            -3.55104234e06,
            -3.30030521e05,
            -3.81804949e04,
            -5.43097700e03,
            -9.05088288e02,
            -1.65678356e02,
            -1.00552200e01,
            -1.21169829e00,
            0.00000000e00,
            -6.14622872e-10,
            6.62900940e-02,
            0.00000000e00,
            0.00000000e00,
            9.94776882e-03,
            0.00000000e00,
            -1.80362984e-11,
            1.95223152e-03,
            0.00000000e00,
            0.00000000e00,
            3.68204160e-04,
            0.00000000e00,
            0.00000000e00,
            3.71397494e-08,
            0.00000000e00,
            3.61109632e-07,
            4.90504821e-15,
            1.60718176e-01,
            -1.00015964e-02,
            -1.20759207e-01,
            -7.68497630e-02,
            -1.03120603e-12,
            5.90944957e-02,
            4.90504821e-15,
            1.60718176e-01,
            -1.00015964e-02,
            -1.20759207e-01,
            7.68497630e-02,
            -1.03120603e-12,
            5.90944957e-02,
        ],
        [
            -3.55104234e06,
            -1.88940027e06,
            -3.77020521e05,
            -5.53144508e04,
            -8.44451249e03,
            -1.43949298e03,
            -2.65600099e02,
            -1.61821606e01,
            -1.95136237e00,
            0.00000000e00,
            -1.42319428e-10,
            2.57667408e-01,
            0.00000000e00,
            0.00000000e00,
            4.06811921e-02,
            0.00000000e00,
            0.00000000e00,
            8.06548511e-03,
            0.00000000e00,
            0.00000000e00,
            1.52546301e-03,
            0.00000000e00,
            0.00000000e00,
            1.02213032e-06,
            0.00000000e00,
            9.93816863e-06,
            9.64568909e-15,
            2.59457752e-01,
            -1.59692164e-02,
            -1.94428759e-01,
            -1.24009050e-01,
            2.49386415e-13,
            9.56406597e-02,
            9.64568909e-15,
            2.59457752e-01,
            -1.59692164e-02,
            -1.94428759e-01,
            1.24009050e-01,
            2.49386415e-13,
            9.56406597e-02,
        ],
        [
            -3.30030521e05,
            -3.77020521e05,
            -2.06193044e05,
            -5.52797796e04,
            -1.07252046e04,
            -1.99081314e03,
            -3.78881571e02,
            -2.34412600e01,
            -2.83447294e00,
            0.00000000e00,
            -3.94517153e-11,
            5.96723375e-01,
            0.00000000e00,
            0.00000000e00,
            1.16604828e-01,
            0.00000000e00,
            0.00000000e00,
            2.40881090e-02,
            0.00000000e00,
            -2.71580501e-13,
            4.60708839e-03,
            0.00000000e00,
            -2.72406222e-17,
            1.33861161e-05,
            0.00000000e00,
            1.30153148e-04,
            3.11075159e-14,
            3.80461764e-01,
            -2.33256465e-02,
            -2.82432786e-01,
            -1.83682929e-01,
            -8.27267617e-14,
            1.42377388e-01,
            3.11075159e-14,
            3.80461764e-01,
            -2.33256465e-02,
            -2.82432786e-01,
            1.83682929e-01,
            -8.27267617e-14,
            1.42377388e-01,
        ],
        [
            -3.81804949e04,
            -5.53144508e04,
            -5.52797796e04,
            -3.13298858e04,
            -1.00395253e04,
            -2.35144681e03,
            -4.91873534e02,
            -3.19642891e01,
            -3.89974300e00,
            0.00000000e00,
            -7.71255269e-12,
            4.93201125e-01,
            0.00000000e00,
            2.42748554e-12,
            2.48156401e-01,
            0.00000000e00,
            0.00000000e00,
            5.89514779e-02,
            0.00000000e00,
            0.00000000e00,
            1.16987075e-02,
            0.00000000e00,
            -6.68139263e-17,
            1.15202058e-04,
            0.00000000e00,
            1.12010910e-03,
            5.27500909e-13,
            5.39480958e-01,
            -3.43254506e-02,
            -3.89138887e-01,
            -2.72416848e-01,
            -3.25233369e-14,
            2.12650770e-01,
            5.27500909e-13,
            5.39480958e-01,
            -3.43254506e-02,
            -3.89138887e-01,
            2.72416848e-01,
            -3.25233369e-14,
            2.12650770e-01,
        ],
        [
            -5.43097700e03,
            -8.44451249e03,
            -1.07252046e04,
            -1.00395253e04,
            -5.87544259e03,
            -2.12348355e03,
            -5.56587355e02,
            -4.13103247e01,
            -5.17019785e00,
            0.00000000e00,
            3.44249494e-12,
            -1.16890905e00,
            0.00000000e00,
            -7.08146367e-13,
            3.08858886e-01,
            0.00000000e00,
            -2.13753818e-13,
            1.17947740e-01,
            0.00000000e00,
            0.00000000e00,
            2.61261696e-02,
            0.00000000e00,
            -1.34928521e-16,
            7.04736171e-04,
            0.00000000e00,
            6.85214666e-03,
            2.42045569e-10,
            7.76511558e-01,
            -5.70129143e-02,
            -5.18969260e-01,
            -4.42401409e-01,
            0.00000000e00,
            3.47607490e-01,
            2.42045569e-10,
            7.76511558e-01,
            -5.70129143e-02,
            -5.18969260e-01,
            4.42401409e-01,
            0.00000000e00,
            3.47607490e-01,
        ],
        [
            -9.05088288e02,
            -1.43949298e03,
            -1.99081314e03,
            -2.35144681e03,
            -2.12348355e03,
            -1.27798468e03,
            -4.95057671e02,
            -4.95275884e01,
            -6.61677749e00,
            0.00000000e00,
            2.20178825e-12,
            -2.42490094e00,
            0.00000000e00,
            -4.15380193e-14,
            -1.07035626e-01,
            0.00000000e00,
            0.00000000e00,
            1.66164669e-01,
            0.00000000e00,
            -1.97711374e-14,
            5.09181460e-02,
            0.00000000e00,
            -2.00220936e-16,
            2.81103152e-03,
            0.00000000e00,
            2.73316470e-02,
            1.97724158e-06,
            1.19727359e00,
            -1.16967589e-01,
            -6.76224591e-01,
            -8.42776943e-01,
            -6.88354560e-15,
            6.62897185e-01,
            1.97724158e-06,
            1.19727359e00,
            -1.16967589e-01,
            -6.76224591e-01,
            8.42776943e-01,
            -6.88354560e-15,
            6.62897185e-01,
        ],
        [
            -1.65678356e02,
            -2.65600099e02,
            -3.78881571e02,
            -4.91873534e02,
            -5.56587355e02,
            -4.95057671e02,
            -3.04171877e02,
            -5.19162484e01,
            -8.07165328e00,
            0.00000000e00,
            1.81284752e-12,
            -1.49745949e00,
            0.00000000e00,
            0.00000000e00,
            -9.43765398e-01,
            0.00000000e00,
            -1.42817468e-14,
            5.66097517e-02,
            0.00000000e00,
            1.62986168e-14,
            8.00763705e-02,
            0.00000000e00,
            0.00000000e00,
            4.60510933e-03,
            0.00000000e00,
            4.47754576e-02,
            6.72955827e-03,
            1.99890772e00,
            -2.85709706e-01,
            -8.65740489e-01,
            -1.81618623e00,
            0.00000000e00,
            1.41967740e00,
            6.72955827e-03,
            1.99890772e00,
            -2.85709706e-01,
            -8.65740489e-01,
            1.81618623e00,
            0.00000000e00,
            1.41967740e00,
        ],
        [
            -1.00552200e01,
            -1.61821606e01,
            -2.34412600e01,
            -3.19642891e01,
            -4.13103247e01,
            -4.95275884e01,
            -5.19162484e01,
            -2.93670549e01,
            -8.61126938e00,
            0.00000000e00,
            8.81734253e-14,
            -1.90177366e-01,
            0.00000000e00,
            0.00000000e00,
            -6.50647345e-01,
            0.00000000e00,
            0.00000000e00,
            -5.59592246e-01,
            0.00000000e00,
            0.00000000e00,
            -1.42759405e-03,
            0.00000000e00,
            0.00000000e00,
            -2.66469428e-02,
            0.00000000e00,
            -2.59088106e-01,
            9.31034959e-01,
            2.06856926e00,
            -1.19195152e00,
            -1.22448139e00,
            -4.81036839e00,
            4.38725838e-16,
            3.69143955e00,
            9.31034959e-01,
            2.06856926e00,
            -1.19195152e00,
            -1.22448139e00,
            4.81036839e00,
            4.38725838e-16,
            3.69143955e00,
        ],
        [
            -1.21169829e00,
            -1.95136237e00,
            -2.83447294e00,
            -3.89974300e00,
            -5.17019785e00,
            -6.61677749e00,
            -8.07165328e00,
            -8.61126938e00,
            -5.12358524e00,
            0.00000000e00,
            0.00000000e00,
            -2.65071756e-02,
            0.00000000e00,
            0.00000000e00,
            -1.42935731e-01,
            0.00000000e00,
            -3.62388679e-15,
            -3.34269567e-01,
            0.00000000e00,
            0.00000000e00,
            -1.15804811e-01,
            0.00000000e00,
            1.16816897e-16,
            -2.12793180e-02,
            0.00000000e00,
            -2.06898714e-01,
            -1.20057512e-01,
            -4.67390666e-01,
            -1.63084587e00,
            -1.24731157e00,
            -3.08485568e00,
            5.53906366e-16,
            2.33540725e00,
            -1.20057512e-01,
            -4.67390666e-01,
            -1.63084587e00,
            -1.24731157e00,
            3.08485568e00,
            5.53906366e-16,
            2.33540725e00,
        ],
        [
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            -3.90008201e03,
            0.00000000e00,
            0.00000000e00,
            -6.91257034e02,
            0.00000000e00,
            0.00000000e00,
            -1.00661838e02,
            0.00000000e00,
            0.00000000e00,
            -1.54466618e01,
            0.00000000e00,
            0.00000000e00,
            -2.26761871e-14,
            0.00000000e00,
            0.00000000e00,
            7.84446493e-02,
            0.00000000e00,
            -6.37388281e-07,
            -2.31068182e-01,
            6.01323539e00,
            1.76487237e00,
            1.01684008e01,
            0.00000000e00,
            -1.11135241e01,
            6.37388281e-07,
            2.31068182e-01,
            -6.01323539e00,
            -1.76487237e00,
            1.01684008e01,
            0.00000000e00,
            1.11135241e01,
        ],
        [
            -6.14622872e-10,
            -1.42319428e-10,
            -3.94517153e-11,
            -7.71255269e-12,
            3.44249494e-12,
            2.20178825e-12,
            1.81284752e-12,
            8.81734253e-14,
            0.00000000e00,
            0.00000000e00,
            -3.89961206e03,
            4.24326993e-15,
            0.00000000e00,
            -6.91248063e02,
            0.00000000e00,
            0.00000000e00,
            -1.00718311e02,
            -2.70352267e-16,
            0.00000000e00,
            -1.54634168e01,
            -7.65818038e-17,
            0.00000000e00,
            6.45069730e-02,
            1.30497786e-14,
            0.00000000e00,
            2.25752191e-14,
            -2.40384777e-22,
            -1.49963376e-15,
            1.18700027e-15,
            0.00000000e00,
            0.00000000e00,
            -4.30909372e00,
            0.00000000e00,
            -2.40384777e-22,
            -1.49963376e-15,
            1.18700027e-15,
            0.00000000e00,
            0.00000000e00,
            -4.30909372e00,
            0.00000000e00,
        ],
        [
            6.62900940e-02,
            2.57667408e-01,
            5.96723375e-01,
            4.93201125e-01,
            -1.16890905e00,
            -2.42490094e00,
            -1.49745949e00,
            -1.90177366e-01,
            -2.65071756e-02,
            0.00000000e00,
            4.24326993e-15,
            -3.89988890e03,
            0.00000000e00,
            0.00000000e00,
            -6.91253348e02,
            0.00000000e00,
            -2.70352267e-16,
            -1.00685044e02,
            0.00000000e00,
            -7.65818038e-17,
            -1.54535469e01,
            0.00000000e00,
            -2.26485266e-14,
            7.52029743e-02,
            0.00000000e00,
            6.96883811e-03,
            4.89542077e-07,
            1.79726682e-01,
            -4.62084411e00,
            -1.35828240e00,
            -1.11214623e01,
            0.00000000e00,
            4.23382564e00,
            4.89542077e-07,
            1.79726682e-01,
            -4.62084411e00,
            -1.35828240e00,
            1.11214623e01,
            0.00000000e00,
            4.23382564e00,
        ],
        [
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            -6.91257034e02,
            0.00000000e00,
            0.00000000e00,
            -4.07755938e02,
            0.00000000e00,
            0.00000000e00,
            -9.85210442e01,
            0.00000000e00,
            0.00000000e00,
            -1.37642241e01,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            -2.47197256e-01,
            0.00000000e00,
            -1.30929807e-01,
            -1.93363263e00,
            5.10498265e00,
            1.37262196e00,
            1.04503008e01,
            8.73431180e-16,
            -1.07260691e01,
            1.30929807e-01,
            1.93363263e00,
            -5.10498265e00,
            -1.37262196e00,
            1.04503008e01,
            -8.73431180e-16,
            1.07260691e01,
        ],
        [
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            2.42748554e-12,
            -7.08146367e-13,
            -4.15380193e-14,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            -6.91248063e02,
            0.00000000e00,
            0.00000000e00,
            -4.07285991e02,
            0.00000000e00,
            0.00000000e00,
            -9.84542713e01,
            6.22978848e-17,
            0.00000000e00,
            -1.38264057e01,
            6.11913842e-17,
            0.00000000e00,
            -2.69131553e-01,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            1.77890021e-15,
            8.75023670e-16,
            2.80674077e-15,
            -3.52435809e00,
            -2.17308229e-15,
            0.00000000e00,
            0.00000000e00,
            1.77890021e-15,
            8.75023670e-16,
            -2.80674077e-15,
            -3.52435809e00,
            -2.17308229e-15,
        ],
        [
            9.94776882e-03,
            4.06811921e-02,
            1.16604828e-01,
            2.48156401e-01,
            3.08858886e-01,
            -1.07035626e-01,
            -9.43765398e-01,
            -6.50647345e-01,
            -1.42935731e-01,
            0.00000000e00,
            0.00000000e00,
            -6.91253348e02,
            0.00000000e00,
            0.00000000e00,
            -4.07562822e02,
            0.00000000e00,
            6.22978848e-17,
            -9.84936052e01,
            0.00000000e00,
            6.11913842e-17,
            -1.37897764e01,
            0.00000000e00,
            0.00000000e00,
            -3.09638389e-01,
            0.00000000e00,
            1.09671483e-02,
            1.00563156e-01,
            1.49686869e00,
            -3.94992720e00,
            -1.07635988e00,
            -1.07838498e01,
            -6.89250091e-16,
            4.76762247e00,
            1.00563156e-01,
            1.49686869e00,
            -3.94992720e00,
            -1.07635988e00,
            1.07838498e01,
            -6.89250091e-16,
            4.76762247e00,
        ],
        [
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            -1.00661838e02,
            0.00000000e00,
            0.00000000e00,
            -9.85210442e01,
            0.00000000e00,
            0.00000000e00,
            -6.05600825e01,
            0.00000000e00,
            0.00000000e00,
            -1.40012658e01,
            0.00000000e00,
            0.00000000e00,
            -4.48665326e-14,
            0.00000000e00,
            0.00000000e00,
            -1.21582448e00,
            0.00000000e00,
            -1.20716984e00,
            7.51309029e-01,
            5.50402229e00,
            1.33668865e00,
            1.04709985e01,
            -1.08765188e-15,
            -1.15258637e01,
            1.20716984e00,
            -7.51309029e-01,
            -5.50402229e00,
            -1.33668865e00,
            1.04709985e01,
            1.08765188e-15,
            1.15258637e01,
        ],
        [
            -1.80362984e-11,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            -2.13753818e-13,
            0.00000000e00,
            -1.42817468e-14,
            0.00000000e00,
            -3.62388679e-15,
            0.00000000e00,
            -1.00718311e02,
            -2.70352267e-16,
            0.00000000e00,
            -9.84542713e01,
            6.22978848e-17,
            0.00000000e00,
            -6.01271038e01,
            0.00000000e00,
            0.00000000e00,
            -1.39971319e01,
            -4.20009977e-19,
            0.00000000e00,
            -8.89728063e-01,
            2.57708468e-14,
            0.00000000e00,
            4.45495880e-14,
            1.60876515e-15,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            1.82176173e-15,
            -4.60924102e00,
            -1.39988056e-15,
            1.60876515e-15,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            -1.82176173e-15,
            -4.60924102e00,
            -1.39988056e-15,
        ],
        [
            1.95223152e-03,
            8.06548511e-03,
            2.40881090e-02,
            5.89514779e-02,
            1.17947740e-01,
            1.66164669e-01,
            5.66097517e-02,
            -5.59592246e-01,
            -3.34269567e-01,
            0.00000000e00,
            -2.70352267e-16,
            -1.00685044e02,
            0.00000000e00,
            6.22978848e-17,
            -9.84936052e01,
            0.00000000e00,
            0.00000000e00,
            -6.03821585e01,
            0.00000000e00,
            -4.20009977e-19,
            -1.39995670e01,
            0.00000000e00,
            -4.47797045e-14,
            -1.04413881e00,
            0.00000000e00,
            -1.63048207e-01,
            9.30124790e-01,
            -5.56353180e-01,
            -4.29336891e00,
            -1.09877223e00,
            -1.16822538e01,
            8.33120095e-16,
            4.31310622e00,
            9.30124790e-01,
            -5.56353180e-01,
            -4.29336891e00,
            -1.09877223e00,
            1.16822538e01,
            8.33120095e-16,
            4.31310622e00,
        ],
        [
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            -1.54466618e01,
            0.00000000e00,
            0.00000000e00,
            -1.37642241e01,
            0.00000000e00,
            0.00000000e00,
            -1.40012658e01,
            0.00000000e00,
            0.00000000e00,
            -8.64681503e00,
            0.00000000e00,
            0.00000000e00,
            4.98393131e-15,
            0.00000000e00,
            0.00000000e00,
            -3.37112439e-01,
            0.00000000e00,
            1.11787214e00,
            3.15976774e00,
            4.10359125e00,
            1.32444413e00,
            2.40598191e00,
            0.00000000e00,
            -4.60822651e00,
            -1.11787214e00,
            -3.15976774e00,
            -4.10359125e00,
            -1.32444413e00,
            2.40598191e00,
            0.00000000e00,
            4.60822651e00,
        ],
        [
            0.00000000e00,
            0.00000000e00,
            -2.71580501e-13,
            0.00000000e00,
            0.00000000e00,
            -1.97711374e-14,
            1.62986168e-14,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            -1.54634168e01,
            -7.65818038e-17,
            0.00000000e00,
            -1.38264057e01,
            6.11913842e-17,
            0.00000000e00,
            -1.39971319e01,
            -4.20009977e-19,
            0.00000000e00,
            -8.63031512e00,
            0.00000000e00,
            0.00000000e00,
            -3.50919769e-01,
            -2.88057723e-15,
            0.00000000e00,
            -4.99133414e-15,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            -3.71054638e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            -3.71054638e00,
            0.00000000e00,
        ],
        [
            3.68204160e-04,
            1.52546301e-03,
            4.60708839e-03,
            1.16987075e-02,
            2.61261696e-02,
            5.09181460e-02,
            8.00763705e-02,
            -1.42759405e-03,
            -1.15804811e-01,
            0.00000000e00,
            -7.65818038e-17,
            -1.54535469e01,
            0.00000000e00,
            6.11913842e-17,
            -1.37897764e01,
            0.00000000e00,
            -4.20009977e-19,
            -1.39995670e01,
            0.00000000e00,
            0.00000000e00,
            -8.64003472e00,
            0.00000000e00,
            4.98595934e-15,
            -4.04497212e-01,
            0.00000000e00,
            6.90366510e-03,
            -8.52120464e-01,
            -2.40745540e00,
            -3.16244604e00,
            -1.06418977e00,
            -4.69973972e00,
            0.00000000e00,
            -1.61588745e-01,
            -8.52120464e-01,
            -2.40745540e00,
            -3.16244604e00,
            -1.06418977e00,
            4.69973972e00,
            0.00000000e00,
            -1.61588745e-01,
        ],
        [
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            -2.26761871e-14,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            -4.48665326e-14,
            0.00000000e00,
            0.00000000e00,
            4.98393131e-15,
            0.00000000e00,
            0.00000000e00,
            -7.92291927e01,
            0.00000000e00,
            0.00000000e00,
            3.77745409e-16,
            0.00000000e00,
            0.00000000e00,
            6.73108132e-16,
            0.00000000e00,
            4.21712867e-16,
            0.00000000e00,
            7.85450289e00,
            0.00000000e00,
            0.00000000e00,
            -6.73108132e-16,
            0.00000000e00,
            -4.21712867e-16,
            0.00000000e00,
            -7.85450289e00,
            0.00000000e00,
        ],
        [
            0.00000000e00,
            0.00000000e00,
            -2.72406222e-17,
            -6.68139263e-17,
            -1.34928521e-16,
            -2.00220936e-16,
            0.00000000e00,
            0.00000000e00,
            1.16816897e-16,
            0.00000000e00,
            6.45069730e-02,
            -2.26485266e-14,
            0.00000000e00,
            -2.69131553e-01,
            0.00000000e00,
            0.00000000e00,
            -8.89728063e-01,
            -4.47797045e-14,
            0.00000000e00,
            -3.50919769e-01,
            4.98595934e-15,
            0.00000000e00,
            -7.89696255e01,
            1.92080903e-16,
            0.00000000e00,
            -3.03560483e-16,
            0.00000000e00,
            -5.28122696e-16,
            0.00000000e00,
            -3.47411632e-16,
            0.00000000e00,
            -6.09473917e00,
            0.00000000e00,
            0.00000000e00,
            -5.28122696e-16,
            0.00000000e00,
            -3.47411632e-16,
            0.00000000e00,
            -6.09473917e00,
            0.00000000e00,
        ],
        [
            3.71397494e-08,
            1.02213032e-06,
            1.33861161e-05,
            1.15202058e-04,
            7.04736171e-04,
            2.81103152e-03,
            4.60510933e-03,
            -2.66469428e-02,
            -2.12793180e-02,
            0.00000000e00,
            1.30497786e-14,
            7.52029743e-02,
            0.00000000e00,
            0.00000000e00,
            -3.09638389e-01,
            0.00000000e00,
            2.57708468e-14,
            -1.04413881e00,
            0.00000000e00,
            -2.88057723e-15,
            -4.04497212e-01,
            0.00000000e00,
            1.92080903e-16,
            -7.93054091e01,
            0.00000000e00,
            3.53011260e-01,
            5.53104594e-02,
            -3.74156304e-01,
            -3.99981319e-01,
            -5.69962002e-02,
            -5.89726950e00,
            0.00000000e00,
            -6.03515013e00,
            5.53104594e-02,
            -3.74156304e-01,
            -3.99981319e-01,
            -5.69962002e-02,
            5.89726950e00,
            0.00000000e00,
            -6.03515013e00,
        ],
        [
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            7.84446493e-02,
            0.00000000e00,
            0.00000000e00,
            -2.47197256e-01,
            0.00000000e00,
            0.00000000e00,
            -1.21582448e00,
            0.00000000e00,
            0.00000000e00,
            -3.37112439e-01,
            0.00000000e00,
            0.00000000e00,
            3.77745409e-16,
            0.00000000e00,
            0.00000000e00,
            -7.98687905e01,
            0.00000000e00,
            -7.34755722e-01,
            5.69778124e00,
            4.56249088e00,
            3.05327381e-01,
            1.11926466e01,
            0.00000000e00,
            -5.34960566e00,
            7.34755722e-01,
            -5.69778124e00,
            -4.56249088e00,
            -3.05327381e-01,
            1.11926466e01,
            0.00000000e00,
            5.34960566e00,
        ],
        [
            3.61109632e-07,
            9.93816863e-06,
            1.30153148e-04,
            1.12010910e-03,
            6.85214666e-03,
            2.73316470e-02,
            4.47754576e-02,
            -2.59088106e-01,
            -2.06898714e-01,
            0.00000000e00,
            2.25752191e-14,
            6.96883811e-03,
            0.00000000e00,
            0.00000000e00,
            1.09671483e-02,
            0.00000000e00,
            4.45495880e-14,
            -1.63048207e-01,
            0.00000000e00,
            -4.99133414e-15,
            6.90366510e-03,
            0.00000000e00,
            -3.03560483e-16,
            3.53011260e-01,
            0.00000000e00,
            -7.93427223e01,
            4.73985034e-01,
            -3.71295092e00,
            -2.94489503e00,
            -2.25222431e-01,
            -3.30155048e00,
            0.00000000e00,
            8.54367663e00,
            4.73985034e-01,
            -3.71295092e00,
            -2.94489503e00,
            -2.25222431e-01,
            3.30155048e00,
            0.00000000e00,
            8.54367663e00,
        ],
        [
            4.90504821e-15,
            9.64568909e-15,
            3.11075159e-14,
            5.27500909e-13,
            2.42045569e-10,
            1.97724158e-06,
            6.72955827e-03,
            9.31034959e-01,
            -1.20057512e-01,
            -6.37388281e-07,
            -2.40384777e-22,
            4.89542077e-07,
            -1.30929807e-01,
            0.00000000e00,
            1.00563156e-01,
            -1.20716984e00,
            1.60876515e-15,
            9.30124790e-01,
            1.11787214e00,
            0.00000000e00,
            -8.52120464e-01,
            0.00000000e00,
            0.00000000e00,
            5.53104594e-02,
            -7.34755722e-01,
            4.73985034e-01,
            -3.34871529e02,
            -4.34067876e01,
            -4.13641201e00,
            -4.55224685e-01,
            7.24666174e-01,
            0.00000000e00,
            -5.23422205e-01,
            3.33927973e-20,
            2.56476911e-04,
            1.92817943e-01,
            -1.13455803e-02,
            -3.42132990e-01,
            0.00000000e00,
            -4.27720484e-03,
        ],
        [
            1.60718176e-01,
            2.59457752e-01,
            3.80461764e-01,
            5.39480958e-01,
            7.76511558e-01,
            1.19727359e00,
            1.99890772e00,
            2.06856926e00,
            -4.67390666e-01,
            -2.31068182e-01,
            -1.49963376e-15,
            1.79726682e-01,
            -1.93363263e00,
            0.00000000e00,
            1.49686869e00,
            7.51309029e-01,
            0.00000000e00,
            -5.56353180e-01,
            3.15976774e00,
            0.00000000e00,
            -2.40745540e00,
            6.73108132e-16,
            -5.28122696e-16,
            -3.74156304e-01,
            5.69778124e00,
            -3.71295092e00,
            -4.34067876e01,
            -3.66859791e01,
            -8.78567642e00,
            -1.29114526e00,
            -7.41567068e-01,
            1.91788691e-15,
            5.35415616e-01,
            2.56476911e-04,
            6.33430385e-02,
            6.38933857e-01,
            -2.67522346e-02,
            -1.21825722e00,
            -2.24924242e-16,
            -1.24949516e-01,
        ],
        [
            -1.00015964e-02,
            -1.59692164e-02,
            -2.33256465e-02,
            -3.43254506e-02,
            -5.70129143e-02,
            -1.16967589e-01,
            -2.85709706e-01,
            -1.19195152e00,
            -1.63084587e00,
            6.01323539e00,
            1.18700027e-15,
            -4.62084411e00,
            5.10498265e00,
            1.77890021e-15,
            -3.94992720e00,
            5.50402229e00,
            0.00000000e00,
            -4.29336891e00,
            4.10359125e00,
            0.00000000e00,
            -3.16244604e00,
            0.00000000e00,
            0.00000000e00,
            -3.99981319e-01,
            4.56249088e00,
            -2.94489503e00,
            -4.13641201e00,
            -8.78567642e00,
            -6.98299808e00,
            -2.02375096e00,
            -2.25910133e00,
            2.98497671e-15,
            1.61426121e00,
            1.92817943e-01,
            6.38933857e-01,
            5.92612951e-01,
            -2.43015484e-01,
            -7.65130640e-03,
            -2.21256078e-16,
            -4.06166024e-01,
        ],
        [
            -1.20759207e-01,
            -1.94428759e-01,
            -2.82432786e-01,
            -3.89138887e-01,
            -5.18969260e-01,
            -6.76224591e-01,
            -8.65740489e-01,
            -1.22448139e00,
            -1.24731157e00,
            1.76487237e00,
            0.00000000e00,
            -1.35828240e00,
            1.37262196e00,
            8.75023670e-16,
            -1.07635988e00,
            1.33668865e00,
            0.00000000e00,
            -1.09877223e00,
            1.32444413e00,
            0.00000000e00,
            -1.06418977e00,
            4.21712867e-16,
            -3.47411632e-16,
            -5.69962002e-02,
            3.05327381e-01,
            -2.25222431e-01,
            -4.55224685e-01,
            -1.29114526e00,
            -2.02375096e00,
            -1.28718516e00,
            -6.91390800e-01,
            1.46312987e-15,
            4.87664455e-01,
            -1.13455803e-02,
            -2.67522346e-02,
            -2.43015484e-01,
            -4.36216661e-01,
            7.29133913e-01,
            2.32452950e-16,
            -7.45876386e-02,
        ],
        [
            -7.68497630e-02,
            -1.24009050e-01,
            -1.83682929e-01,
            -2.72416848e-01,
            -4.42401409e-01,
            -8.42776943e-01,
            -1.81618623e00,
            -4.81036839e00,
            -3.08485568e00,
            1.01684008e01,
            0.00000000e00,
            -1.11214623e01,
            1.04503008e01,
            2.80674077e-15,
            -1.07838498e01,
            1.04709985e01,
            1.82176173e-15,
            -1.16822538e01,
            2.40598191e00,
            0.00000000e00,
            -4.69973972e00,
            0.00000000e00,
            0.00000000e00,
            -5.89726950e00,
            1.11926466e01,
            -3.30155048e00,
            7.24666174e-01,
            -7.41567068e-01,
            -2.25910133e00,
            -6.91390800e-01,
            -2.15823482e01,
            0.00000000e00,
            1.01959796e00,
            3.42132990e-01,
            1.21825722e00,
            7.65130640e-03,
            -7.29133913e-01,
            1.42844139e00,
            0.00000000e00,
            -5.39488638e-01,
        ],
        [
            -1.03120603e-12,
            2.49386415e-13,
            -8.27267617e-14,
            -3.25233369e-14,
            0.00000000e00,
            -6.88354560e-15,
            0.00000000e00,
            4.38725838e-16,
            5.53906366e-16,
            0.00000000e00,
            -4.30909372e00,
            0.00000000e00,
            8.73431180e-16,
            -3.52435809e00,
            -6.89250091e-16,
            -1.08765188e-15,
            -4.60924102e00,
            8.33120095e-16,
            0.00000000e00,
            -3.71054638e00,
            0.00000000e00,
            7.85450289e00,
            -6.09473917e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            1.91788691e-15,
            2.98497671e-15,
            1.46312987e-15,
            0.00000000e00,
            -2.01605514e01,
            0.00000000e00,
            0.00000000e00,
            -2.24924242e-16,
            -2.21256078e-16,
            2.32452950e-16,
            0.00000000e00,
            1.32360999e-01,
            0.00000000e00,
        ],
        [
            5.90944957e-02,
            9.56406597e-02,
            1.42377388e-01,
            2.12650770e-01,
            3.47607490e-01,
            6.62897185e-01,
            1.41967740e00,
            3.69143955e00,
            2.33540725e00,
            -1.11135241e01,
            0.00000000e00,
            4.23382564e00,
            -1.07260691e01,
            -2.17308229e-15,
            4.76762247e00,
            -1.15258637e01,
            -1.39988056e-15,
            4.31310622e00,
            -4.60822651e00,
            0.00000000e00,
            -1.61588745e-01,
            0.00000000e00,
            0.00000000e00,
            -6.03515013e00,
            -5.34960566e00,
            8.54367663e00,
            -5.23422205e-01,
            5.35415616e-01,
            1.61426121e00,
            4.87664455e-01,
            1.01959796e00,
            0.00000000e00,
            -2.09431019e01,
            -4.27720484e-03,
            -1.24949516e-01,
            -4.06166024e-01,
            -7.45876386e-02,
            5.39488638e-01,
            0.00000000e00,
            6.13928534e-01,
        ],
        [
            4.90504821e-15,
            9.64568909e-15,
            3.11075159e-14,
            5.27500909e-13,
            2.42045569e-10,
            1.97724158e-06,
            6.72955827e-03,
            9.31034959e-01,
            -1.20057512e-01,
            6.37388281e-07,
            -2.40384777e-22,
            4.89542077e-07,
            1.30929807e-01,
            0.00000000e00,
            1.00563156e-01,
            1.20716984e00,
            1.60876515e-15,
            9.30124790e-01,
            -1.11787214e00,
            0.00000000e00,
            -8.52120464e-01,
            0.00000000e00,
            0.00000000e00,
            5.53104594e-02,
            7.34755722e-01,
            4.73985034e-01,
            3.33927973e-20,
            2.56476911e-04,
            1.92817943e-01,
            -1.13455803e-02,
            3.42132990e-01,
            0.00000000e00,
            -4.27720484e-03,
            -3.34871529e02,
            -4.34067876e01,
            -4.13641201e00,
            -4.55224685e-01,
            -7.24666174e-01,
            0.00000000e00,
            -5.23422205e-01,
        ],
        [
            1.60718176e-01,
            2.59457752e-01,
            3.80461764e-01,
            5.39480958e-01,
            7.76511558e-01,
            1.19727359e00,
            1.99890772e00,
            2.06856926e00,
            -4.67390666e-01,
            2.31068182e-01,
            -1.49963376e-15,
            1.79726682e-01,
            1.93363263e00,
            0.00000000e00,
            1.49686869e00,
            -7.51309029e-01,
            0.00000000e00,
            -5.56353180e-01,
            -3.15976774e00,
            0.00000000e00,
            -2.40745540e00,
            -6.73108132e-16,
            -5.28122696e-16,
            -3.74156304e-01,
            -5.69778124e00,
            -3.71295092e00,
            2.56476911e-04,
            6.33430385e-02,
            6.38933857e-01,
            -2.67522346e-02,
            1.21825722e00,
            -2.24924242e-16,
            -1.24949516e-01,
            -4.34067876e01,
            -3.66859791e01,
            -8.78567642e00,
            -1.29114526e00,
            7.41567068e-01,
            1.91788691e-15,
            5.35415616e-01,
        ],
        [
            -1.00015964e-02,
            -1.59692164e-02,
            -2.33256465e-02,
            -3.43254506e-02,
            -5.70129143e-02,
            -1.16967589e-01,
            -2.85709706e-01,
            -1.19195152e00,
            -1.63084587e00,
            -6.01323539e00,
            1.18700027e-15,
            -4.62084411e00,
            -5.10498265e00,
            1.77890021e-15,
            -3.94992720e00,
            -5.50402229e00,
            0.00000000e00,
            -4.29336891e00,
            -4.10359125e00,
            0.00000000e00,
            -3.16244604e00,
            0.00000000e00,
            0.00000000e00,
            -3.99981319e-01,
            -4.56249088e00,
            -2.94489503e00,
            1.92817943e-01,
            6.38933857e-01,
            5.92612951e-01,
            -2.43015484e-01,
            7.65130640e-03,
            -2.21256078e-16,
            -4.06166024e-01,
            -4.13641201e00,
            -8.78567642e00,
            -6.98299808e00,
            -2.02375096e00,
            2.25910133e00,
            2.98497671e-15,
            1.61426121e00,
        ],
        [
            -1.20759207e-01,
            -1.94428759e-01,
            -2.82432786e-01,
            -3.89138887e-01,
            -5.18969260e-01,
            -6.76224591e-01,
            -8.65740489e-01,
            -1.22448139e00,
            -1.24731157e00,
            -1.76487237e00,
            0.00000000e00,
            -1.35828240e00,
            -1.37262196e00,
            8.75023670e-16,
            -1.07635988e00,
            -1.33668865e00,
            0.00000000e00,
            -1.09877223e00,
            -1.32444413e00,
            0.00000000e00,
            -1.06418977e00,
            -4.21712867e-16,
            -3.47411632e-16,
            -5.69962002e-02,
            -3.05327381e-01,
            -2.25222431e-01,
            -1.13455803e-02,
            -2.67522346e-02,
            -2.43015484e-01,
            -4.36216661e-01,
            -7.29133913e-01,
            2.32452950e-16,
            -7.45876386e-02,
            -4.55224685e-01,
            -1.29114526e00,
            -2.02375096e00,
            -1.28718516e00,
            6.91390800e-01,
            1.46312987e-15,
            4.87664455e-01,
        ],
        [
            7.68497630e-02,
            1.24009050e-01,
            1.83682929e-01,
            2.72416848e-01,
            4.42401409e-01,
            8.42776943e-01,
            1.81618623e00,
            4.81036839e00,
            3.08485568e00,
            1.01684008e01,
            0.00000000e00,
            1.11214623e01,
            1.04503008e01,
            -2.80674077e-15,
            1.07838498e01,
            1.04709985e01,
            -1.82176173e-15,
            1.16822538e01,
            2.40598191e00,
            0.00000000e00,
            4.69973972e00,
            0.00000000e00,
            0.00000000e00,
            5.89726950e00,
            1.11926466e01,
            3.30155048e00,
            -3.42132990e-01,
            -1.21825722e00,
            -7.65130640e-03,
            7.29133913e-01,
            1.42844139e00,
            0.00000000e00,
            5.39488638e-01,
            -7.24666174e-01,
            7.41567068e-01,
            2.25910133e00,
            6.91390800e-01,
            -2.15823482e01,
            0.00000000e00,
            -1.01959796e00,
        ],
        [
            -1.03120603e-12,
            2.49386415e-13,
            -8.27267617e-14,
            -3.25233369e-14,
            0.00000000e00,
            -6.88354560e-15,
            0.00000000e00,
            4.38725838e-16,
            5.53906366e-16,
            0.00000000e00,
            -4.30909372e00,
            0.00000000e00,
            -8.73431180e-16,
            -3.52435809e00,
            -6.89250091e-16,
            1.08765188e-15,
            -4.60924102e00,
            8.33120095e-16,
            0.00000000e00,
            -3.71054638e00,
            0.00000000e00,
            -7.85450289e00,
            -6.09473917e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            0.00000000e00,
            -2.24924242e-16,
            -2.21256078e-16,
            2.32452950e-16,
            0.00000000e00,
            1.32360999e-01,
            0.00000000e00,
            0.00000000e00,
            1.91788691e-15,
            2.98497671e-15,
            1.46312987e-15,
            0.00000000e00,
            -2.01605514e01,
            0.00000000e00,
        ],
        [
            5.90944957e-02,
            9.56406597e-02,
            1.42377388e-01,
            2.12650770e-01,
            3.47607490e-01,
            6.62897185e-01,
            1.41967740e00,
            3.69143955e00,
            2.33540725e00,
            1.11135241e01,
            0.00000000e00,
            4.23382564e00,
            1.07260691e01,
            -2.17308229e-15,
            4.76762247e00,
            1.15258637e01,
            -1.39988056e-15,
            4.31310622e00,
            4.60822651e00,
            0.00000000e00,
            -1.61588745e-01,
            0.00000000e00,
            0.00000000e00,
            -6.03515013e00,
            5.34960566e00,
            8.54367663e00,
            -4.27720484e-03,
            -1.24949516e-01,
            -4.06166024e-01,
            -7.45876386e-02,
            -5.39488638e-01,
            0.00000000e00,
            6.13928534e-01,
            -5.23422205e-01,
            5.35415616e-01,
            1.61426121e00,
            4.87664455e-01,
            -1.01959796e00,
            0.00000000e00,
            -2.09431019e01,
        ],
    ]
)


@pytest.mark.skipif(
    not pybest.gbasis.dense_ints.PYBEST_PVP_ENABLED,
    reason="pVp integrals not supported.",
)
def test_pvp():
    fn = context.get_fn("test/h2o_ccdz.xyz")
    obs = get_gobasis("cc-pvdz", fn, print_basis=False)

    pvp = compute_pvp(obs)

    assert pvp.nbasis == pvp.nbasis1 == 40
    assert np.allclose(pvp._array, ref)
