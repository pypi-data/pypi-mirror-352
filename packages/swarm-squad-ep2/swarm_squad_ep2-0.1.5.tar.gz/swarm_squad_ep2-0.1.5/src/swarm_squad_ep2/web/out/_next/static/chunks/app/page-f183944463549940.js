(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{2800:(e,t,s)=>{Promise.resolve().then(s.bind(s,4182))},4182:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>K});var a=s(2311),n=s(2847),r=s(7448),l=s(2560),o=s(7246),i=s(8327);let c={V1:{bg:"#3b82f6",text:"#eff6ff"},V2:{bg:"#22c55e",text:"#f0fdf4"},V3:{bg:"#f97316",text:"#fff7ed"},V4:{bg:"#8b5cf6",text:"#f5f3ff"},V5:{bg:"#ec4899",text:"#fdf2f8"}};function d(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,i.QP)((0,o.$)(t))}let m=(0,l.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),x=n.forwardRef((e,t)=>{let{className:s,variant:n,size:l,asChild:o=!1,...i}=e,c=o?r.DX:"button";return(0,a.jsx)(c,{className:d(m({variant:n,size:l,className:s})),ref:t,...i})});x.displayName="Button";var h=s(6738);let f=n.forwardRef((e,t)=>{let{className:s,children:n,...r}=e;return(0,a.jsxs)(h.bL,{ref:t,className:d("relative overflow-hidden",s),...r,children:[(0,a.jsx)(h.LM,{className:"h-full w-full rounded-[inherit]",children:n}),(0,a.jsx)(u,{}),(0,a.jsx)(h.OK,{})]})});f.displayName=h.bL.displayName;let u=n.forwardRef((e,t)=>{let{className:s,orientation:n="vertical",...r}=e;return(0,a.jsx)(h.VM,{ref:t,orientation:n,className:d("flex touch-none select-none transition-colors","vertical"===n&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===n&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...r,children:(0,a.jsx)(h.lr,{className:"relative flex-1 rounded-full bg-border"})})});u.displayName=h.VM.displayName;let p=[{id:"1",name:"VEHICLE CHANNELS",rooms:[{id:"v1",name:"Vehicle 1 Room",type:"vehicle"},{id:"v2",name:"Vehicle 2 Room",type:"vehicle"},{id:"v3",name:"Vehicle 3 Room",type:"vehicle"}]},{id:"2",name:"LLM CHANNELS",rooms:[{id:"l1",name:"LLM 1 Room",type:"llm"},{id:"l2",name:"LLM 2 Room",type:"llm"},{id:"l3",name:"LLM 3 Room",type:"llm"}]},{id:"3",name:"VEH2LLM CHANNELS",rooms:[{id:"vl1",name:"Veh1 - LLM1",type:"vl"},{id:"vl2",name:"Veh2 - LLM2",type:"vl"},{id:"vl3",name:"Veh3 - LLM3",type:"vl"}]}],g=()=>p.flatMap(e=>e.rooms),b=[{id:"v1",name:"Vehicle 1",roomId:"v1",status:"online",type:"vehicle"},{id:"v2",name:"Vehicle 2",roomId:"v2",status:"online",type:"vehicle"},{id:"v3",name:"Vehicle 3",roomId:"v3",status:"online",type:"vehicle"},{id:"l1",name:"LLM 1",roomId:"l1",status:"online",type:"llm"},{id:"l2",name:"LLM 2",roomId:"l2",status:"online",type:"llm"},{id:"l3",name:"LLM 3",roomId:"l3",status:"online",type:"llm"}];new Date().toISOString(),new Date().toISOString(),new Date().toISOString();var v=s(880),j=s(8295),y=s(1565);function N(e){let{name:t,isExpanded:s,onToggle:n}=e;return(0,a.jsxs)("button",{onClick:n,className:"flex items-center gap-1 w-full px-2 py-1 text-xs font-semibold text-muted-foreground hover:text-foreground",children:[(0,a.jsx)(y.A,{className:d("h-3 w-3 transition-transform",!s&&"-rotate-90")}),t]})}function w(e){let{currentRoomId:t,onRoomChange:s,rooms:r}=e,[l,o]=(0,n.useState)(Object.fromEntries(p.map(e=>[e.id,!0]))),i=e=>{o(t=>({...t,[e]:!t[e]}))};return(0,a.jsxs)("div",{className:"hidden md:flex w-72 border-r border-border flex-col h-screen bg-background",children:[(0,a.jsx)("div",{className:"h-14 flex items-center justify-center px-4 border-b border-border",children:(0,a.jsxs)("h2",{className:"text-base font-semibold flex items-center gap-2",children:[(0,a.jsx)(v.A,{className:"h-5 w-5"}),"Rooms"]})}),(0,a.jsx)(f,{className:"flex-1",children:(0,a.jsx)("div",{className:"p-4 space-y-4",children:p.map(e=>(0,a.jsxs)("div",{children:[(0,a.jsx)(N,{name:e.name,isExpanded:l[e.id],onToggle:()=>i(e.id)}),l[e.id]&&(0,a.jsx)("div",{className:"space-y-1 mt-1",children:e.rooms.map(e=>(0,a.jsxs)(x,{variant:t===e.id?"secondary":"ghost",className:"w-full justify-start text-sm pl-8",onClick:()=>s(e.id),children:[(0,a.jsx)(j.A,{className:"mr-3 h-4 w-4"}),e.name]},e.id))})]},e.id))})})]})}let S="http://localhost:8000";function k(){let[e,t]=(0,n.useState)([]),[s,a]=(0,n.useState)(null),[r,l]=(0,n.useState)(!0),[o,i]=(0,n.useState)(!1),[c,d]=(0,n.useState)(null),[m,x]=(0,n.useState)([]),h=(0,n.useRef)(0),f=(0,n.useCallback)(async()=>{try{let e=await fetch("".concat(S,"/rooms"));if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let t=(await e.json()).map(e=>e.id);return console.log("Fetched available rooms:",t),x(t),t}catch(t){console.error("Error fetching rooms:",t);let e=["v1","v2","v3"];return console.log("Using fallback rooms:",e),x(e),e}},[]),u=(0,n.useCallback)(async()=>{try{d(null);let e=await fetch("".concat(S,"/messages?limit=50"));if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let s=(await e.json()).filter(e=>e&&("number"==typeof e.id||"string"==typeof e.id)&&"string"==typeof e.content&&"string"==typeof e.entity_id&&"string"==typeof e.timestamp);t(e=>0===e.length?s:e),console.log("Loaded ".concat(s.length," historical messages"))}catch(e){console.error("Error fetching historical messages:",e),d(e instanceof Error?e.message:"Failed to fetch messages")}finally{l(!1)}},[]),p=(0,n.useCallback)(e=>{if(0===e.length)return console.warn("No rooms available for WebSocket connection"),null;let s="ws://localhost:8000/ws?rooms=".concat(e.join(","));console.log("Connecting to WebSocket:",s),console.log("Subscribing to rooms:",e);let n=new WebSocket(s);return n.onopen=()=>{console.log("WebSocket connected to rooms:",e),i(!0),d(null)},n.onmessage=e=>{try{let s=JSON.parse(e.data);if(console.log("Received WebSocket message:",s),s&&("string"==typeof s.content||"string"==typeof s.message)&&"string"==typeof s.entity_id&&"string"==typeof s.timestamp){h.current+=1;let e={...s,content:s.content||s.message,message_type:s.message_type||"vehicle_update",room_id:s.room_id||s.entity_id,state:s.state||{},id:s.id||"".concat(s.entity_id,"-").concat(Date.now(),"-").concat(h.current)};t(t=>{let s=[...t,e];return console.log("Total messages: ".concat(s.length," (latest from ").concat(e.entity_id,")")),s.slice(-50)})}else console.warn("Received invalid message format:",s)}catch(e){console.error("Error processing WebSocket message:",e)}},n.onerror=e=>{console.error("WebSocket error:",e),i(!1),d("WebSocket connection error")},n.onclose=t=>{console.log("WebSocket disconnected:",t.code,t.reason),i(!1),1e3!==t.code&&setTimeout(()=>{console.log("Attempting to reconnect..."),p(e)},2e3)},a(n),n},[]);return(0,n.useEffect)(()=>{let e=null;return(async()=>{let t=await f();t.length>0&&(e=p(t),u())})(),()=>{e&&e.readyState===WebSocket.OPEN&&e.close(1e3,"Component unmounting")}},[f,p,u]),{messages:e,socket:s,isLoading:r,isConnected:o,error:c,availableRooms:m}}var _=s(3119),L=s(9200);async function E(e){try{let t=await fetch("".concat("http://localhost:8000","/messages?room_id=").concat(e));if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));return t.json()}catch(e){return console.error("Error fetching messages:",e),[]}}function C(e){let{roomId:t}=e,[s,r]=(0,n.useState)([]),{messages:l,isConnected:o}=k();return(0,n.useEffect)(()=>{t&&e();async function e(){try{let e=(await E(t)).map(e=>({id:e.id,content:e.content,timestamp:e.timestamp,entity_id:e.entity_id,room_id:e.room_id,message_type:e.message_type,state:e.state}));r(e)}catch(e){console.error("Error loading messages:",e)}}},[t]),(0,n.useEffect)(()=>{if(!t||!l.length)return;let e=l.filter(e=>!!(t===e.entity_id||t===e.room_id||t.startsWith("vl")&&e.entity_id.startsWith("v")&&t.slice(2)===e.entity_id.slice(1))).map(e=>({id:e.id||"".concat(e.entity_id,"-").concat(Date.now()),content:e.content,timestamp:e.timestamp,entity_id:e.entity_id,room_id:e.room_id||t,message_type:e.message_type,state:e.state}));e.length>0&&r(t=>{let s=new Set(t.map(e=>e.id)),a=e.filter(e=>!s.has(e.id));return a.length>0?[...t,...a].sort((e,t)=>new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime()).slice(-100):t})},[l,t]),(0,a.jsxs)("div",{className:"flex flex-col h-full",children:[(0,a.jsxs)("div",{className:"px-4 py-2 text-xs flex items-center justify-center text-gray-500 border-b",children:["WebSocket:"," ",o?(0,a.jsx)("span",{className:"text-green-600",children:"Connected"}):(0,a.jsx)("span",{className:"text-red-600",children:"Disconnected"}),(0,a.jsx)("span",{className:"mx-2",children:"-"}),"Messages: ",s.length,(0,a.jsx)("span",{className:"mx-2",children:"-"}),"Room: ",t]}),(0,a.jsx)(f,{className:"flex-1",children:(0,a.jsx)("div",{className:"flex justify-center w-full mt-4",children:(0,a.jsx)("div",{className:"w-full max-w-[1500px] px-4",children:(0,a.jsx)("div",{className:"space-y-4 py-4",children:0===s.length?(0,a.jsxs)("div",{className:"text-center text-gray-500 py-8",children:["No messages yet."," ",o?"Waiting for vehicle updates...":"Connecting to WebSocket..."]}):s.map(e=>{var t,s,n;let r="vehicle_update"===e.message_type,l=r?c[e.entity_id]||{bg:"#6b7280",text:"#f9fafb"}:null;return(0,a.jsxs)("div",{className:"flex space-x-4",children:[(0,a.jsx)("div",{className:"flex-shrink-0 w-8 h-8 sm:w-12 sm:h-12 rounded-full flex items-center justify-center",style:{backgroundColor:(null==l?void 0:l.bg)||"rgb(209, 213, 219)"},children:r?(0,a.jsx)(_.A,{className:"h-4 w-4 sm:h-6 sm:w-6",style:{color:null==l?void 0:l.text}}):(0,a.jsx)(L.A,{className:"h-4 w-4 sm:h-6 sm:w-6 text-gray-500"})}),(0,a.jsxs)("div",{className:"flex-grow",children:[(0,a.jsxs)("div",{className:"flex items-baseline gap-2 flex-wrap",children:[(0,a.jsx)("span",{className:"font-semibold text-sm sm:text-base",style:{color:null==l?void 0:l.bg},children:e.entity_id}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:new Date(e.timestamp).toLocaleTimeString()})]}),(0,a.jsx)("p",{className:"mt-1 text-sm sm:text-base break-words",dangerouslySetInnerHTML:{__html:r?(t=e.content,s=e.entity_id,n=(null==l?void 0:l.bg)||"inherit",(t=t.replace(/\d+%,\s*\d+%">/,"")).replace(new RegExp("Vehicle ".concat(s)),'<span style="color: '.concat(n,'">Vehicle ').concat(s,"</span>")).replace(/\(([-\d.]+,\s*[-\d.]+)\)/g,e=>'<span style="color: '.concat(n,'">').concat(e,"</span>")).replace(/([\d.]+)(\s*km\/h)/g,(e,t,s)=>'<span style="color: '.concat(n,'">').concat(t,"</span>").concat(s)).replace(/([\d.]+)(%)/g,(e,t,s)=>'<span style="color: '.concat(n,'">').concat(t,"</span>").concat(s))):e.content}}),r&&e.state&&(0,a.jsxs)("div",{className:"mt-1 text-xs text-gray-500",children:[e.state.latitude&&e.state.longitude&&(0,a.jsxs)("span",{className:"mr-2",children:["Location: (",e.state.latitude.toFixed(4),", ",e.state.longitude.toFixed(4),")"]}),e.state.speed&&(0,a.jsxs)("span",{className:"mr-2",children:["Speed: ",e.state.speed.toFixed(1)," km/h"]}),e.state.battery&&(0,a.jsxs)("span",{children:["Battery: ",e.state.battery.toFixed(1),"%"]})]})]})]},e.id)})})})})})]})}let V=n.forwardRef((e,t)=>{let{className:s,type:n,...r}=e;return(0,a.jsx)("input",{type:n,className:d("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...r})});V.displayName="Input";var A=s(8366),R=s(6889),W=s(5510);let D=W.bL,M=W.l9,T=n.forwardRef((e,t)=>{let{className:s,align:n="center",sideOffset:r=4,...l}=e;return(0,a.jsx)(W.ZL,{children:(0,a.jsx)(W.UC,{ref:t,align:n,sideOffset:r,className:d("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...l})})});T.displayName=W.UC.displayName;var I=s(3899);let z=(0,A.default)(()=>Promise.all([s.e(326),s.e(512)]).then(s.bind(s,6512)),{loadableGenerated:{webpack:()=>[6512]},ssr:!1});function P(e){let{onEmojiSelect:t,className:s,iconClassName:n}=e,{theme:r}=(0,I.D)();return(0,a.jsxs)(D,{children:[(0,a.jsx)(M,{asChild:!0,children:(0,a.jsx)(x,{type:"button",variant:"ghost",size:"icon",className:d("h-16 w-16",s),children:(0,a.jsx)(R.A,{className:d("h-12 w-12",n)})})}),(0,a.jsx)(T,{side:"top",className:"p-0 border-none",style:{width:"320px"},children:(0,a.jsx)("div",{className:"rounded-md border border-border overflow-hidden",children:(0,a.jsx)(z,{data:async()=>(await fetch("https://cdn.jsdelivr.net/npm/@emoji-mart/data")).json(),onEmojiSelect:e=>t(e.native),theme:"dark"===r?"dark":"light",previewPosition:"none",searchPosition:"top",skinTonePosition:"none",navPosition:"top",perLine:8})})})]})}var O=s(4761),F=s(2680),H=s(3848);function U(){let[e,t]=(0,n.useState)("");return(0,a.jsxs)("form",{onSubmit:s=>{s.preventDefault(),e.trim()&&(console.log("Sending message:",e),t(""))},className:"flex items-center gap-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1 sm:gap-2",children:[(0,a.jsx)(x,{type:"button",variant:"ghost",size:"icon",className:"h-9 w-9 sm:h-10 sm:w-10",children:(0,a.jsx)(O.A,{className:"h-[18px] w-[18px] sm:h-5 sm:w-5"})}),(0,a.jsx)(x,{type:"button",variant:"ghost",size:"icon",className:"h-9 w-9 sm:h-10 sm:w-10",children:(0,a.jsx)(F.A,{className:"h-[18px] w-[18px] sm:h-5 sm:w-5"})}),(0,a.jsx)(P,{onEmojiSelect:e=>{t(t=>t+e)},className:"h-9 w-9 sm:h-10 sm:w-10",iconClassName:"!h-[18px] !w-[18px] sm:!h-5 sm:!w-5"})]}),(0,a.jsx)("div",{className:"flex-grow",children:(0,a.jsx)(V,{placeholder:"Send a message...",value:e,onChange:e=>t(e.target.value),className:"h-9 sm:h-10 text-sm sm:text-base"})}),(0,a.jsxs)(x,{type:"submit",size:"sm",className:"gap-1 sm:gap-2 h-9 sm:h-10 px-3 sm:px-4 text-sm sm:text-base",children:[(0,a.jsx)("span",{className:"hidden sm:inline",children:"Send"}),(0,a.jsx)(H.A,{className:"h-[18px] w-[18px] sm:h-5 sm:w-5"})]})]})}var B=s(9645),q=s(6650),G=s(975);function J(){let{theme:e,setTheme:t}=(0,I.D)(),[s,r]=(0,n.useState)(!1);return((0,n.useEffect)(()=>{r(!0)},[]),s)?(0,a.jsx)(x,{variant:"ghost",size:"sm",className:"flex items-center justify-center gap-2 w-full",onClick:()=>t("light"===e?"dark":"light"),children:"light"===e?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(q.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"Dark mode"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(G.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"Light mode"})]})}):(0,a.jsxs)(x,{variant:"ghost",size:"sm",className:"flex items-center justify-center gap-2 w-full",children:[(0,a.jsx)("div",{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"invisible",children:"Placeholder"})]})}function K(){let[e,t]=(0,n.useState)(""),{isConnected:s,messages:r}=k(),l=g(),o=l.find(t=>t.id===e);return(0,n.useEffect)(()=>{!e&&l.length>0&&t("v1")},[e,l]),(0,n.useEffect)(()=>{console.log("WebSocket status:",s),console.log("Total WebSocket messages:",r.length),console.log("Current room:",e),r.length>0&&console.log("Latest message:",r[r.length-1])},[s,r,e]),(0,a.jsxs)("div",{className:"flex h-screen overflow-hidden",children:[(0,a.jsx)(w,{rooms:l,currentRoomId:e,onRoomChange:t}),(0,a.jsxs)("div",{className:"flex flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex-1 flex flex-col min-w-0",children:[(0,a.jsx)("div",{className:"h-14 flex-shrink-0 flex items-center justify-center px-4 border-b border-border bg-background relative",children:(0,a.jsxs)("h2",{className:"text-base font-semibold flex items-center gap-2",children:[(0,a.jsx)(j.A,{className:"h-5 w-5"}),(null==o?void 0:o.name)||e]})}),(0,a.jsx)("div",{className:"flex-1 overflow-hidden",children:e&&(0,a.jsx)(C,{roomId:e})})]}),(0,a.jsxs)("div",{className:"w-72 border-l border-border flex flex-col",children:[(0,a.jsx)("div",{className:"h-14 flex items-center justify-center px-4 border-b border-border",children:(0,a.jsxs)("h2",{className:"text-base font-semibold flex items-center gap-2",children:[(0,a.jsx)(B.A,{className:"h-5 w-5"}),"Users"]})}),(0,a.jsx)(f,{className:"flex-1",children:(0,a.jsx)("div",{className:"p-4",children:b.filter(t=>t.roomId===e).map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-3 p-2 pl-8",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(L.A,{className:"h-4 w-4 text-foreground"}),(0,a.jsx)("div",{className:"absolute -bottom-0.5 -right-0.5 w-2 h-2 rounded-full ".concat("online"===e.status?"bg-green-500":"bg-gray-400")})]}),(0,a.jsx)("span",{className:"text-sm",children:e.name})]},e.id))})})]})]}),(0,a.jsx)("div",{className:"fixed bottom-0 left-0 right-0 border-t border-border bg-background",children:(0,a.jsxs)("div",{className:"flex h-[5.5rem] items-center",children:[(0,a.jsxs)("div",{className:"w-72 border-r border-border h-full flex flex-col items-center justify-center px-4",children:[(0,a.jsx)("h3",{className:"text-lg font-bold text-center",children:"Swarm Squad"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground text-center",children:"The Digital Dialogue"})]}),(0,a.jsx)("div",{className:"flex-1 relative px-8",children:(0,a.jsx)(U,{})}),(0,a.jsxs)("div",{className:"w-72 border-l border-border h-full flex flex-col items-center justify-center px-4 gap-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-center gap-2 ".concat(s?"text-green-500":"text-red-500"),children:[(0,a.jsx)("div",{className:"h-1 w-1 rounded-full bg-current"}),(0,a.jsx)("span",{className:"text-sm",children:s?"WS Connected":"WS Disconnected"})]}),(0,a.jsx)("div",{className:"w-full",children:(0,a.jsx)(J,{})})]})]})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[256,789,20,358],()=>t(2800)),_N_E=e.O()}]);