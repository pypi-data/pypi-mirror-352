[project]
name = "remotivelabs-topology"
description = "RemotiveLabs RemotiveTopology framework allows developers to easily create and run ECU stubs and control their behavior"
version = "0.1.0a5"
readme = "README.md"
license = "Proprietary"
license-files = ["../LICENSE"]
authors = [{ name = "Remotivelabs", email = "support@remotivelabs.com" }]
keywords = ["automotive", "autotech", "networking", "CAN"]
classifiers = [
  "Development Status :: 3 - Alpha",
  "Intended Audience :: Developers",
  "Intended Audience :: Manufacturing",
  "Intended Audience :: Science/Research",
  "License :: Other/Proprietary License",
  "Operating System :: OS Independent",
  "Programming Language :: Python",
  "Programming Language :: Python :: 3.9",
  "Programming Language :: Python :: 3.10",
  "Programming Language :: Python :: 3.11",
  "Programming Language :: Python :: 3.12",
  "Programming Language :: Python :: 3.13",
  "Topic :: Communications",
  "Topic :: Internet",
  "Topic :: Scientific/Engineering :: Information Analysis",
]

requires-python = ">=3.9,<4.0"

dependencies = [
  "pyhamcrest >= 2.1.0",
  "tenacity >= 9.0.0",
  "typing-extensions >=4.12.2",
  "remotivelabs-broker >=0.9.0b3",
]

[project.optional-dependencies]
fmu = [
  "fmpy >= 0.3.22; python_version >= '3.10'",
  "fmpy == 0.3.21; python_version < '3.10'",
  "numpy >= 2.2.1; python_version >= '3.10'",
  "numpy == 2.0.2; python_version <'3.10'",
]

[project.urls]
Homepage = "https://remotivelabs.com/"
Documentation = "https://docs.remotivelabs.com/"

[tool.poetry]
packages = [{ include = "remotivelabs", from = "src" }]

[tool.poetry.group.dev.dependencies]
ruff = "^0.11.10"
mypy = "^1.15.0"
pytest = "^8.3.3"
pytest-cov = "^5.0.0"
pytest-docker-tools = "^3.1.3"
pytest-asyncio = "^0.24.0"
types-requests = "^2.32.0.20241016"
pytest-xdist = { extras = ["psutil"], version = "^3.6.1" }
requests = "^2.32.3"
python-dotenv = "^1.0.1"
pdoc = "^15.0.1"
aiomqtt = "^2.3.0"
pytest-timeout = "^2.3.1"
aiostream = "^0.6.4"
pytest-flakefinder = "^1.1.0"
loguru = "^0.7.3"

[tool.poetry.requires-plugins]
poethepoet = ">=0.34"

[tool.poe.tasks]
docs = { cmd = """pdoc remotivelabs.topology \
                       --docformat google \
                       --favicon https://releases.remotivelabs.com/favicon.ico \
                       --logo https://releases.remotivelabs.com/remotive-labs-logo-neg.png \
                       -t docs/theme \
                       -o dist/doc""" }
format = [{ cmd = "ruff format ." }, { cmd = "ruff check --fix ." }]
ruff = [{ cmd = "ruff check ." }, { cmd = "ruff format --check --diff ." }]
mypy = [{ cmd = "mypy -p remotivelabs.topology -p tests" }]
lint = ["ruff", "mypy"]
publish = { cmd = "poetry publish --dry-run" }

[tool.poe.tasks.test]
cmd = "pytest -n logical --dist=loadfile --cov"
args = [{ name = "extra_args", positional = true, multiple = true }]

[tool.pytest.ini_options]
asyncio_mode = "auto"
asyncio_default_fixture_loop_scope = "function"
consider_namespace_packages = true
testpaths = ["tests"]
timeout_func_only = true

[tool.ruff]
line-length = 140

[tool.ruff.lint]
select = [
  "ARG",
  "B034",
  "C901",
  "E",
  "EXE",
  "F",
  "FA",
  "I",
  "N",
  "UP032",
  "RET",
  "W",
  "PL",
]
ignore = ['PLR2004']

[tool.ruff.lint.extend-per-file-ignores]
"__init__.py" = ["F401"]

[tool.mypy]
python_version = "3.10"
namespace_packages = true
explicit_package_bases = true
mypy_path = "src, tests"
packages = ["remotivelabs.topology", "tests"]
# See https://mypy.readthedocs.io/en/stable/config_file.html
disallow_untyped_calls = false
check_untyped_defs = true
warn_return_any = true
warn_unused_ignores = true
hide_error_codes = false

[[tool.mypy.overrides]]
module = [
  "pytest_docker_tools",
  "pytest_docker_tools.wrappers",
  "fmpy",
  "numpy",
]
ignore_missing_imports = true

[build-system]
requires = ["poetry-core"]
build-backend = "poetry.core.masonry.api"
